// ../browser-message-broker/dist/Module.js
var T = /* @__PURE__ */ new Map();
var p = class {
  constructor(e, s) {
    this.type = "reqRep";
    this.settings = {};
    this.name = "";
    this.name = e, this.settings = s;
  }
  async request(e) {
    return i.Request(this.name, e, this.settings.enableBroadcast);
  }
  reply(e) {
    return i.Reply(this.name, e, this.settings.enableBroadcast).dispose;
  }
  dispose() {
    i.requestListeners.delete(this.name), T.delete(this.name);
  }
  static getOrCreate(e, s) {
    if (!s) {
      let n = T.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.enableBroadcast || false, s.enableCaching || false, s.trace || false);
    let t = new p(e, s);
    return T.set(e, t), t;
  }
};
var S = "broadcast-sync";
var R = "browser-message-broker";
function B(d) {
  return d.channelName === S;
}
function k(d) {
  return d.senderId != null && d.targetId == null;
}
function q(d) {
  return d.senderId != null && d.targetId != null;
}
var l = Math.random().toString(36).substring(2, 9);
function M(d, e = 1) {
  let s;
  return (...t) => {
    clearTimeout(s), s = setTimeout(() => {
      d(...t);
    }, e);
  };
}
var b = /* @__PURE__ */ new Map();
var w = class {
  constructor() {
    this.trace = false;
    this.senderId = l;
    this.state = /* @__PURE__ */ new Map();
    this.subscribers = /* @__PURE__ */ new Map();
    this.braodcasts = /* @__PURE__ */ new Set();
    this.__bcChannel = new BroadcastChannel(R);
    this.__nextMessageAwaters = /* @__PURE__ */ new Map();
    this.broadcastedRequests = /* @__PURE__ */ new Map();
    this.requestListeners = /* @__PURE__ */ new Map();
    this.__bcChannel.onmessage = this.handleBroadcast.bind(this), this.__bcChannel.onmessageerror = this.handleBroadcastError.bind(this), setTimeout(() => {
      this.__sendBrokerState(void 0, void 0);
    }, 0), this.sendBrokerState = M(this.__sendBrokerState.bind(this), 2);
  }
  log(e, s, ...t) {
    (this.trace || b.get(s)?.trace) && console.log(`[${globalThis.constructor.name}(${this.senderId})-${s}] ${e}`, t);
  }
  ConfigureChannel(e, s, t, n) {
    b.set(e, { enableBroadcast: s, enableCaching: t, trace: n }), t && this.state.set(e, void 0), s && this.braodcasts.add(e);
  }
  handleBroadcastError(e) {
    throw Error("BROADCAST FAILED: " + e.data);
  }
  __sendBrokerState(e, s) {
    let t = Array.from(this.braodcasts.keys());
    s && s.length > 0 && (t = t.filter((o) => s.includes(o)));
    let n = {};
    for (let o of this.state)
      !o[1] || !t.includes(o[0]) || (n[o[0]] = o[1]);
    let r = { id: l, availableState: n, broadcasts: t }, a = { channelName: S, senderCtx: globalThis.constructor.name, senderId: l, targetId: e, msg: r, channelType: "sync" };
    this.__bcChannel.postMessage(a), e == null ? this.log("Broadcast sync requested", "", { brokerState: r }) : this.log("Broadcast sync responded", "", { targetId: e, brokerState: r });
  }
  handleBroadcastSync(e) {
    if (k(e))
      return this.sendBrokerState(e.senderId, e.msg.broadcasts);
    if (q(e))
      for (let s of Object.entries(e.msg.availableState))
        this.braodcasts.has(s[0]) && this.state.has(s[0]) && this.state.get(s[0]) == null && this.__notifySubscribers(s[0], s[1], e.senderId), this.log("Broadcast sync responce handled", "", e.msg);
  }
  handleBroadcast(e) {
    if (this.log("Broadcast received", e.data.channelName, e.data), e.data.targetId != null && e.data.targetId !== l) {
      this.log("Broadcast ignored (different targetId)", e.data.channelName);
      return;
    }
    if (B(e.data))
      return this.handleBroadcastSync(e.data);
    switch (e.data.channelType) {
      case "pubSub":
        this.__notifySubscribers(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "req":
        this.bridgeRequest(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "rep":
        let s = this.broadcastedRequests.get(e.data.channelName);
        if (!s)
          return;
        s.resolve(e.data.msg), this.broadcastedRequests.delete(e.data.channelName);
        break;
    }
    this.log("Broadcast handled", e.data.channelName, e.data);
  }
  __configureBroadcast(e) {
    if (!e.channelName)
      throw new Error("Invalid subscription");
    this.braodcasts.add(e.channelName);
    let s = e.dispose;
    e.dispose = () => {
      s(), this.braodcasts.delete(e.channelName);
    }, e.isBroadcast = true, this.sendBrokerState();
  }
  GetState(e) {
    if (e)
      return this.state.get(e);
  }
  async Broadcast(e, s, t) {
    this._broadcast(e, s, "pubSub", t);
  }
  async _broadcast(e, s, t, n) {
    let r = b.get(e);
    this.log(`Message broadcasted (${t}) to ${n || "all brokers"}`, e, s);
    let a = await Promise.resolve(s), o = { channelName: e, senderCtx: globalThis.constructor.name, senderId: l, targetId: n, msg: a, channelType: t };
    r?.enableCaching && this.state.set(e, s), this.__bcChannel.postMessage(o);
  }
  async Publish(e, s, t) {
    this.log("Message published", e, s), await this.__notifySubscribers(e, s, l), this.braodcasts.has(e) && this._broadcast(e, s, "pubSub", t);
  }
  async nextMessage(e) {
    let s = this.__nextMessageAwaters.get(e);
    if (s)
      return s.promise;
    let t = { promise: void 0, resolve: void 0 };
    return t.promise = new Promise((n) => {
      t.resolve = n;
    }), this.__nextMessageAwaters.set(e, t), t.promise;
  }
  Subscribe(e, s, t = false, n = true) {
    let r = b.get(e), a = false;
    r && (t = r.enableBroadcast || false, n = r.enableCaching || true);
    let o = this.subscribers.get(e) || [], c = s;
    o.push(c), this.subscribers.set(e, o);
    let u = { channelName: e, isCached: false, dispose: () => {
      let g = this.subscribers.get(e);
      if (g == null)
        return;
      let h = g.indexOf(c);
      h !== -1 && g.splice(h, 1);
    }, publish: (g, h) => this.Publish(e, g, h), isDisposed: false };
    return t && this.__configureBroadcast(u), n && this.state.set(e, void 0), u;
  }
  bridgeRequest(e, s, t) {
    let n = this.requestListeners.get(e);
    return n ? n.handler(s, t) : Promise.resolve(void 0);
  }
  Request(e, s, t = false, n) {
    if (t) {
      this._broadcast(e, s, "req", n);
      let r = this.broadcastedRequests.get(e);
      r && r.resolve(void 0);
      let a, c = { promise: new Promise((u) => a = u), resolve: a };
      return this.broadcastedRequests.set(e, c), c.promise;
    } else {
      let r = this.requestListeners.get(e);
      return r ? r.handler(s) : Promise.resolve(void 0);
    }
  }
  Reply(e, s, t = false) {
    if (t) {
      let o = s;
      s = (c, u) => this._broadcast(e, o(c), "rep", u);
    }
    let n = this.requestListeners, r = { channelName: e, get isDisposed() {
      return n.has(e);
    }, isBroadcast: t, handler: s, dispose: void 0 };
    r.dispose = () => {
      r.isDisposed = true, this.requestListeners.get(e) === r && this.requestListeners.delete(e);
    };
    let a = this.requestListeners.get(e);
    return a && (a.isDisposed = true, console.warn("Request listener has been replaced: " + e)), this.requestListeners.set(e, r), r;
  }
  async __notifySubscribers(e, s, t) {
    let n = this.subscribers.get(e) || [], r = [];
    for (let a of n)
      !a || (r.push(Promise.resolve(a(s, t))), this.log("Handler called", e, a));
    await Promise.all(r), this.state.has(e) && this.state.set(e, s), this.__handleAwaiter(e, s), this.log("Message handled", e, s, this);
  }
  __handleAwaiter(e, s) {
    let t = this.__nextMessageAwaters.get(e);
    !t || (t.resolve(s), this.__nextMessageAwaters.delete(e));
  }
};
globalThis.BrowserMessageBroker = globalThis.BrowserMessageBroker || new w();
var i = globalThis.BrowserMessageBroker;
var m = /* @__PURE__ */ new Map();
var f = class {
  constructor(e, s) {
    this.type = "pubSub";
    this.dispose = () => {
      i.subscribers.delete(this.name), m.delete(this.name);
    };
    this.name = "";
    this.settings = {};
    this.name = e, this.settings = s;
  }
  static getOrCreate(e, s) {
    if (!s) {
      let n = m.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.enableBroadcast || false, s.enableCaching || false, s.trace || false);
    let t = new f(e, s);
    return m.set(e, t), t;
  }
  async send(e, s) {
    i.Publish(this.name, e, s);
  }
  static async publish(e, s, t) {
    i.Publish(e, s, t);
  }
  static async broadcast(e, s, t) {
    i.Broadcast(e, s, t);
  }
  subscribe(e) {
    return i.Subscribe(this.name, e, this.settings.enableBroadcast, this.settings.enableCaching).dispose;
  }
  getState() {
    return i.GetState(this.name);
  }
  static GetState(e) {
    return i.GetState(e);
  }
  nextMessage() {
    return i.nextMessage(this.name);
  }
  static nextMessage(e) {
    return i.nextMessage(e);
  }
};

// suite/WebWorker/constants.ts
var PUB_SUB_REQUEST_SUBSCRIPTION_KEY = "testReq";
var PUB_SUB_RESPONSE_SUBSCRIPTION_KEY = "testResp";
var REQ_REP_CHANNEL_NAME = "reqRepChannel";

// suite/WebWorker/testWorker.ts
f.getOrCreate(PUB_SUB_REQUEST_SUBSCRIPTION_KEY, {
  enableBroadcast: true
}).subscribe((_) => {
  f.broadcast(PUB_SUB_RESPONSE_SUBSCRIPTION_KEY, { payload: "response" });
});
p.getOrCreate(REQ_REP_CHANNEL_NAME, {
  enableBroadcast: true
}).reply((req) => {
  return { payload: req.payload + "response" };
});
postMessage("ready");
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUmVxUmVwQ2hhbm5lbC50cyIsICIuLi8uLi8uLi9icm93c2VyLW1lc3NhZ2UtYnJva2VyL3NyYy9Ccm9rZXIudHMiLCAiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUHViU3ViQ2hhbm5lbC50cyIsICJjb25zdGFudHMudHMiLCAidGVzdFdvcmtlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XHJcbmltcG9ydCB7IENoYW5uZWxTZXR0aW5ncywgSVJlcVJlcENoYW5uZWwgfSBmcm9tIFwiLi9UeXBlc1wiO1xyXG5cclxuY29uc3QgcmVxUmVwQ2hhbm5lbHMgPSBuZXcgTWFwPHN0cmluZywgUmVxUmVwQ2hhbm5lbD4oKTtcclxuXHJcbmV4cG9ydCBjbGFzcyBSZXFSZXBDaGFubmVsPFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj5cclxuICBpbXBsZW1lbnRzIElSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+XHJcbntcclxuICBhc3luYyByZXF1ZXN0KG1zZz86IFRSZXEpOiBQcm9taXNlPFRSZXAgfCB1bmRlZmluZWQ+IHtcclxuICAgIHJldHVybiBCTUIuUmVxdWVzdDxUUmVwPihcclxuICAgICAgdGhpcy5uYW1lLFxyXG4gICAgICBtc2csXHJcbiAgICAgIHRoaXMuc2V0dGluZ3MuZW5hYmxlQnJvYWRjYXN0XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmVwbHkoaGFuZGxlcjogKHJlcTogVFJlcSkgPT4gVFJlcCB8IFByb21pc2U8VFJlcD4pIHtcclxuICAgIHJldHVybiBCTUIuUmVwbHk8VFJlcSwgVFJlcD4oXHJcbiAgICAgIHRoaXMubmFtZSxcclxuICAgICAgaGFuZGxlcixcclxuICAgICAgdGhpcy5zZXR0aW5ncy5lbmFibGVCcm9hZGNhc3RcclxuICAgICkuZGlzcG9zZTtcclxuICB9XHJcblxyXG4gIHJlYWRvbmx5IHR5cGU6IFwicmVxUmVwXCIgPSBcInJlcVJlcFwiO1xyXG5cclxuICBzZXR0aW5nczogQ2hhbm5lbFNldHRpbmdzID0ge307XHJcblxyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICBCTUIucmVxdWVzdExpc3RlbmVycy5kZWxldGUodGhpcy5uYW1lKTtcclxuICAgIHJlcVJlcENoYW5uZWxzLmRlbGV0ZSh0aGlzLm5hbWUpO1xyXG4gIH1cclxuXHJcbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nID0gXCJcIjtcclxuXHJcbiAgc3RhdGljIGdldE9yQ3JlYXRlPFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj4oXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBzZXR0aW5ncz86IENoYW5uZWxTZXR0aW5nc1xyXG4gICk6IFJlcVJlcENoYW5uZWw8VFJlcSwgVFJlcD4ge1xyXG4gICAgaWYgKCFzZXR0aW5ncykge1xyXG4gICAgICBjb25zdCBjID0gcmVxUmVwQ2hhbm5lbHMuZ2V0KG5hbWUpO1xyXG4gICAgICBpZiAoIWMpIHRocm93IEVycm9yKFwiQ2FuJ3QgZmluZCBjaGFubmVsIHNldHRpbmdzXCIpO1xyXG4gICAgICByZXR1cm4gYyBhcyBSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+O1xyXG4gICAgfVxyXG5cclxuICAgIEJNQi5Db25maWd1cmVDaGFubmVsKFxyXG4gICAgICBuYW1lLFxyXG4gICAgICBzZXR0aW5ncy5lbmFibGVCcm9hZGNhc3QgfHwgZmFsc2UsXHJcbiAgICAgIHNldHRpbmdzLmVuYWJsZUNhY2hpbmcgfHwgZmFsc2UsXHJcbiAgICAgIHNldHRpbmdzLnRyYWNlIHx8IGZhbHNlXHJcbiAgICApO1xyXG4gICAgY29uc3QgY2hhbm5lbCA9IG5ldyBSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+KFxyXG4gICAgICBuYW1lLFxyXG4gICAgICBzZXR0aW5nc1xyXG4gICAgKTtcclxuICAgIHJlcVJlcENoYW5uZWxzLnNldChuYW1lLCBjaGFubmVsKTtcclxuICAgIHJldHVybiBjaGFubmVsO1xyXG4gIH1cclxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgc2V0dGluZ3M6IENoYW5uZWxTZXR0aW5nc1xyXG4gICkge1xyXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcclxuICB9XHJcbn1cclxuIiwgImltcG9ydCB7XHJcbiAgQ2hhbm5lbFR5cGUsXHJcbiAgSUJyb2FkY2FzdEVudmVsb3BlLFxyXG4gIElCcm9hZGNhc3RTeW5jRW52ZWxvcGUsXHJcbiAgSUJyb2tlcixcclxuICBJQnJva2VyU3RhdGUsXHJcbiAgQ2hhbm5lbFNldHRpbmdzLFxyXG4gIFJlcVN1YnNjcmlwdGlvbixcclxuICBTdWJzY3JpcHRpb24sXHJcbiAgVEhhbmRsZXIsXHJcbn0gZnJvbSBcIi4vVHlwZXNcIjtcclxuXHJcbmNvbnN0IEJST0FEQ0FTVF9TWU5DID0gXCJicm9hZGNhc3Qtc3luY1wiO1xyXG5jb25zdCBCUk9XU0VSX01FU1NBR0VfQlJPS0VSID0gXCJicm93c2VyLW1lc3NhZ2UtYnJva2VyXCI7XHJcblxyXG5mdW5jdGlvbiBpc0Jyb2FkY2FzdFN5bmMoXHJcbiAgZTogSUJyb2FkY2FzdEVudmVsb3BlXHJcbik6IGUgaXMgSUJyb2FkY2FzdFN5bmNFbnZlbG9wZSB7XHJcbiAgcmV0dXJuIGUuY2hhbm5lbE5hbWUgPT09IEJST0FEQ0FTVF9TWU5DO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc1N5bmNSZXEoZTogSUJyb2FkY2FzdEVudmVsb3BlKSB7XHJcbiAgcmV0dXJuIGUuc2VuZGVySWQgIT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0SWQgPT0gdW5kZWZpbmVkO1xyXG59XHJcbmZ1bmN0aW9uIGlzU3luY1Jlc3AoZTogSUJyb2FkY2FzdEVudmVsb3BlKSB7XHJcbiAgcmV0dXJuIGUuc2VuZGVySWQgIT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0SWQgIT0gdW5kZWZpbmVkO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgc2VuZGVySWQgPSBNYXRoLnJhbmRvbSgpXHJcbiAgLnRvU3RyaW5nKDM2KVxyXG4gIC5zdWJzdHJpbmcoMiwgOSk7XHJcblxyXG5mdW5jdGlvbiBkZWJvdW5jZTxUIGV4dGVuZHMgRnVuY3Rpb24+KFxyXG4gIGZ1bmM6IFQsXHJcbiAgdGltZW91dCA9IDFcclxuKSB7XHJcbiAgbGV0IHRpbWVyOiBudW1iZXI7XHJcbiAgcmV0dXJuICguLi5hcmdzOiB1bmtub3duW10pID0+IHtcclxuICAgIGNsZWFyVGltZW91dCh0aW1lcik7XHJcbiAgICB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBmdW5jKC4uLmFyZ3MpO1xyXG4gICAgfSwgdGltZW91dCk7XHJcbiAgfTtcclxufVxyXG5cclxuY29uc3QgY2hhbm5lbFNldHRpbmdzID0gbmV3IE1hcDxzdHJpbmcsIENoYW5uZWxTZXR0aW5ncz4oKTtcclxuXHJcbmNsYXNzIEJyb2tlciBpbXBsZW1lbnRzIElCcm9rZXIge1xyXG4gIHRyYWNlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgc2VuZGVySWQgPSBzZW5kZXJJZDtcclxuICBzdGF0ZSA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XHJcbiAgc3Vic2NyaWJlcnMgPSBuZXcgTWFwPHN0cmluZywgVEhhbmRsZXJbXT4oKTtcclxuICBicmFvZGNhc3RzID0gbmV3IFNldDxzdHJpbmc+KCk7XHJcbiAgcHJpdmF0ZSBfX2JjQ2hhbm5lbCA9IG5ldyBCcm9hZGNhc3RDaGFubmVsKFxyXG4gICAgQlJPV1NFUl9NRVNTQUdFX0JST0tFUlxyXG4gICk7XHJcblxyXG4gIHByaXZhdGUgbG9nKFxyXG4gICAgbWVzc2FnZTogc3RyaW5nLFxyXG4gICAgY2hhbm5lbDogc3RyaW5nLFxyXG4gICAgLi4uZGF0YTogdW5rbm93bltdXHJcbiAgKSB7XHJcbiAgICBpZiAodGhpcy50cmFjZSB8fCBjaGFubmVsU2V0dGluZ3MuZ2V0KGNoYW5uZWwpPy50cmFjZSlcclxuICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgYFske2dsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZX0oJHt0aGlzLnNlbmRlcklkfSktJHtjaGFubmVsfV0gJHttZXNzYWdlfWAsXHJcbiAgICAgICAgZGF0YVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICB0aGlzLl9fYmNDaGFubmVsLm9ubWVzc2FnZSA9XHJcbiAgICAgIHRoaXMuaGFuZGxlQnJvYWRjYXN0LmJpbmQodGhpcyk7XHJcbiAgICB0aGlzLl9fYmNDaGFubmVsLm9ubWVzc2FnZWVycm9yID1cclxuICAgICAgdGhpcy5oYW5kbGVCcm9hZGNhc3RFcnJvci5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLl9fc2VuZEJyb2tlclN0YXRlKHVuZGVmaW5lZCwgdW5kZWZpbmVkKTsgLy8gYWx3YXlzIHNlbmQgaW5pdGlhbCBzeW5jIHJlcXVlc3RcclxuICAgIH0sIDApO1xyXG5cclxuICAgIHRoaXMuc2VuZEJyb2tlclN0YXRlID0gZGVib3VuY2UoXHJcbiAgICAgIHRoaXMuX19zZW5kQnJva2VyU3RhdGUuYmluZCh0aGlzKSxcclxuICAgICAgMlxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIENvbmZpZ3VyZUNoYW5uZWwoXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgZW5hYmxlQnJvYWRjYXN0OiBib29sZWFuLFxyXG4gICAgZW5hYmxlQ2FjaGluZzogYm9vbGVhbixcclxuICAgIHRyYWNlOiBib29sZWFuXHJcbiAgKTogdm9pZCB7XHJcbiAgICBjaGFubmVsU2V0dGluZ3Muc2V0KGNoYW5uZWxOYW1lLCB7XHJcbiAgICAgIGVuYWJsZUJyb2FkY2FzdCxcclxuICAgICAgZW5hYmxlQ2FjaGluZyxcclxuICAgICAgdHJhY2UsXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZW5hYmxlQ2FjaGluZylcclxuICAgICAgdGhpcy5zdGF0ZS5zZXQoY2hhbm5lbE5hbWUsIHVuZGVmaW5lZCk7XHJcbiAgICBpZiAoZW5hYmxlQnJvYWRjYXN0KSB0aGlzLmJyYW9kY2FzdHMuYWRkKGNoYW5uZWxOYW1lKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlQnJvYWRjYXN0RXJyb3IoXHJcbiAgICBldjogTWVzc2FnZUV2ZW50PElCcm9hZGNhc3RFbnZlbG9wZT5cclxuICApIHtcclxuICAgIHRocm93IEVycm9yKFwiQlJPQURDQVNUIEZBSUxFRDogXCIgKyBldi5kYXRhKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2VuZEJyb2tlclN0YXRlOiAoXHJcbiAgICB0YXJnZXRJZD86IHN0cmluZyxcclxuICAgIGZpbHRlckJyb2FkY2FzdHM/OiBzdHJpbmdbXVxyXG4gICkgPT4gdm9pZDtcclxuICBwcml2YXRlIF9fc2VuZEJyb2tlclN0YXRlKFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmcsXHJcbiAgICBmaWx0ZXJCcm9hZGNhc3RzPzogc3RyaW5nW11cclxuICApIHtcclxuICAgIGxldCBjdXJyZW50QnJvYWRjYXN0cyA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuYnJhb2RjYXN0cy5rZXlzKClcclxuICAgICk7XHJcblxyXG4gICAgaWYgKGZpbHRlckJyb2FkY2FzdHMgJiYgZmlsdGVyQnJvYWRjYXN0cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGN1cnJlbnRCcm9hZGNhc3RzID0gY3VycmVudEJyb2FkY2FzdHMuZmlsdGVyKChrKSA9PlxyXG4gICAgICAgIGZpbHRlckJyb2FkY2FzdHMuaW5jbHVkZXMoaylcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhdmFpbGFibGVTdGF0ZTogeyBbeDogc3RyaW5nXTogYW55IH0gPSB7fTtcclxuICAgIGZvciAoY29uc3QgeCBvZiB0aGlzLnN0YXRlKSB7XHJcbiAgICAgIGlmICgheFsxXSkgY29udGludWU7XHJcbiAgICAgIGlmICghY3VycmVudEJyb2FkY2FzdHMuaW5jbHVkZXMoeFswXSkpIGNvbnRpbnVlO1xyXG4gICAgICBhdmFpbGFibGVTdGF0ZVt4WzBdXSA9IHhbMV07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3RhdGU6IElCcm9rZXJTdGF0ZSA9IHtcclxuICAgICAgaWQ6IHNlbmRlcklkLFxyXG4gICAgICBhdmFpbGFibGVTdGF0ZSxcclxuICAgICAgYnJvYWRjYXN0czogY3VycmVudEJyb2FkY2FzdHMsXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGV2OiBJQnJvYWRjYXN0U3luY0VudmVsb3BlID0ge1xyXG4gICAgICBjaGFubmVsTmFtZTogQlJPQURDQVNUX1NZTkMsXHJcbiAgICAgIHNlbmRlckN0eDogZ2xvYmFsVGhpcy5jb25zdHJ1Y3Rvci5uYW1lLFxyXG4gICAgICBzZW5kZXJJZCxcclxuICAgICAgdGFyZ2V0SWQsXHJcbiAgICAgIG1zZzogc3RhdGUsXHJcbiAgICAgIGNoYW5uZWxUeXBlOiBcInN5bmNcIixcclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5fX2JjQ2hhbm5lbC5wb3N0TWVzc2FnZShldik7XHJcblxyXG4gICAgaWYgKHRhcmdldElkID09IHVuZGVmaW5lZClcclxuICAgICAgdGhpcy5sb2coXCJCcm9hZGNhc3Qgc3luYyByZXF1ZXN0ZWRcIiwgXCJcIiwge1xyXG4gICAgICAgIGJyb2tlclN0YXRlOiBzdGF0ZSxcclxuICAgICAgfSk7XHJcbiAgICBlbHNlXHJcbiAgICAgIHRoaXMubG9nKFwiQnJvYWRjYXN0IHN5bmMgcmVzcG9uZGVkXCIsIFwiXCIsIHtcclxuICAgICAgICB0YXJnZXRJZCxcclxuICAgICAgICBicm9rZXJTdGF0ZTogc3RhdGUsXHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVCcm9hZGNhc3RTeW5jKGV2OiBJQnJvYWRjYXN0U3luY0VudmVsb3BlKSB7XHJcbiAgICBpZiAoaXNTeW5jUmVxKGV2KSlcclxuICAgICAgcmV0dXJuIHRoaXMuc2VuZEJyb2tlclN0YXRlKFxyXG4gICAgICAgIGV2LnNlbmRlcklkLFxyXG4gICAgICAgIGV2Lm1zZy5icm9hZGNhc3RzXHJcbiAgICAgICk7XHJcbiAgICBpZiAoaXNTeW5jUmVzcChldikpIHtcclxuICAgICAgZm9yIChjb25zdCBzIG9mIE9iamVjdC5lbnRyaWVzKFxyXG4gICAgICAgIGV2Lm1zZy5hdmFpbGFibGVTdGF0ZVxyXG4gICAgICApKSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgdGhpcy5icmFvZGNhc3RzLmhhcyhzWzBdKSAmJlxyXG4gICAgICAgICAgdGhpcy5zdGF0ZS5oYXMoc1swXSkgJiZcclxuICAgICAgICAgIHRoaXMuc3RhdGUuZ2V0KHNbMF0pID09IHVuZGVmaW5lZFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgdGhpcy5fX25vdGlmeVN1YnNjcmliZXJzKHNbMF0sIHNbMV0sIGV2LnNlbmRlcklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubG9nKFxyXG4gICAgICAgICAgXCJCcm9hZGNhc3Qgc3luYyByZXNwb25jZSBoYW5kbGVkXCIsXHJcbiAgICAgICAgICBcIlwiLFxyXG4gICAgICAgICAgZXYubXNnXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVCcm9hZGNhc3QoXHJcbiAgICBldjogTWVzc2FnZUV2ZW50PElCcm9hZGNhc3RFbnZlbG9wZT5cclxuICApIHtcclxuICAgIHRoaXMubG9nKFxyXG4gICAgICBcIkJyb2FkY2FzdCByZWNlaXZlZFwiLFxyXG4gICAgICBldi5kYXRhLmNoYW5uZWxOYW1lLFxyXG4gICAgICBldi5kYXRhXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChcclxuICAgICAgZXYuZGF0YS50YXJnZXRJZCAhPSB1bmRlZmluZWQgJiZcclxuICAgICAgZXYuZGF0YS50YXJnZXRJZCAhPT0gc2VuZGVySWRcclxuICAgICkge1xyXG4gICAgICB0aGlzLmxvZyhcclxuICAgICAgICBcIkJyb2FkY2FzdCBpZ25vcmVkIChkaWZmZXJlbnQgdGFyZ2V0SWQpXCIsXHJcbiAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGlzQnJvYWRjYXN0U3luYyhldi5kYXRhKSlcclxuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlQnJvYWRjYXN0U3luYyhldi5kYXRhKTtcclxuXHJcbiAgICBzd2l0Y2ggKGV2LmRhdGEuY2hhbm5lbFR5cGUpIHtcclxuICAgICAgY2FzZSBcInB1YlN1YlwiOlxyXG4gICAgICAgIHRoaXMuX19ub3RpZnlTdWJzY3JpYmVycyhcclxuICAgICAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWUsXHJcbiAgICAgICAgICBldi5kYXRhLm1zZyxcclxuICAgICAgICAgIGV2LmRhdGEuc2VuZGVySWRcclxuICAgICAgICApO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFwicmVxXCI6XHJcbiAgICAgICAgdGhpcy5icmlkZ2VSZXF1ZXN0KFxyXG4gICAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZSxcclxuICAgICAgICAgIGV2LmRhdGEubXNnLFxyXG4gICAgICAgICAgZXYuZGF0YS5zZW5kZXJJZFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgXCJyZXBcIjpcclxuICAgICAgICBjb25zdCByZXEgPSB0aGlzLmJyb2FkY2FzdGVkUmVxdWVzdHMuZ2V0KFxyXG4gICAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKCFyZXEpIHJldHVybjtcclxuXHJcbiAgICAgICAgcmVxLnJlc29sdmUoZXYuZGF0YS5tc2cpO1xyXG4gICAgICAgIHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5kZWxldGUoXHJcbiAgICAgICAgICBldi5kYXRhLmNoYW5uZWxOYW1lXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5sb2coXHJcbiAgICAgIFwiQnJvYWRjYXN0IGhhbmRsZWRcIixcclxuICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZSxcclxuICAgICAgZXYuZGF0YVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEJyaWRnZSBwdWIvc3ViIG1lc3NhZ2VzIHRvIGJyb2FkY2FzdCBjaGFubmVsXHJcbiAgICogQHBhcmFtIHN1YnNLZXlcclxuICAgKiBAcmV0dXJucyB7U3Vic2NyaXB0aW9ufVxyXG4gICAqL1xyXG4gIHByaXZhdGUgX19jb25maWd1cmVCcm9hZGNhc3QoXHJcbiAgICBzdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjxhbnk+XHJcbiAgKTogdm9pZCB7XHJcbiAgICBpZiAoIXN1YnNjcmlwdGlvbi5jaGFubmVsTmFtZSkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3Vic2NyaXB0aW9uYCk7XHJcbiAgICB9XHJcbiAgICB0aGlzLmJyYW9kY2FzdHMuYWRkKHN1YnNjcmlwdGlvbi5jaGFubmVsTmFtZSk7XHJcbiAgICBjb25zdCBvcmlnaW5hbERpc3Bvc2UgPSBzdWJzY3JpcHRpb24uZGlzcG9zZTtcclxuICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlID0gKCkgPT4ge1xyXG4gICAgICBvcmlnaW5hbERpc3Bvc2UoKTtcclxuICAgICAgdGhpcy5icmFvZGNhc3RzLmRlbGV0ZShzdWJzY3JpcHRpb24uY2hhbm5lbE5hbWUpO1xyXG4gICAgfTtcclxuICAgIHN1YnNjcmlwdGlvbi5pc0Jyb2FkY2FzdCA9IHRydWU7XHJcblxyXG4gICAgdGhpcy5zZW5kQnJva2VyU3RhdGUoKTtcclxuICB9XHJcblxyXG4gIEdldFN0YXRlPFQ+KHN1YnNLZXk6IHN0cmluZyk6IFQgfCB1bmRlZmluZWQge1xyXG4gICAgaWYgKHN1YnNLZXkpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuZ2V0KHN1YnNLZXkpIGFzIFQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgQnJvYWRjYXN0KFxyXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcclxuICAgIG1zZzogdW5rbm93bixcclxuICAgIHRhcmdldElkPzogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICB0aGlzLl9icm9hZGNhc3QoY2hhbm5lbE5hbWUsIG1zZywgXCJwdWJTdWJcIiwgdGFyZ2V0SWQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBfYnJvYWRjYXN0KFxyXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcclxuICAgIG1zZzogdW5rbm93bixcclxuICAgIGNoYW5uZWxUeXBlOiBDaGFubmVsVHlwZSxcclxuICAgIHRhcmdldElkPzogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICBjb25zdCBzZXR0aW5ncyA9IGNoYW5uZWxTZXR0aW5ncy5nZXQoY2hhbm5lbE5hbWUpO1xyXG5cclxuICAgIHRoaXMubG9nKFxyXG4gICAgICBgTWVzc2FnZSBicm9hZGNhc3RlZCAoJHtjaGFubmVsVHlwZX0pIHRvICR7XHJcbiAgICAgICAgdGFyZ2V0SWQgfHwgXCJhbGwgYnJva2Vyc1wiXHJcbiAgICAgIH1gLFxyXG4gICAgICBjaGFubmVsTmFtZSxcclxuICAgICAgbXNnXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IF9tc2cgPSBhd2FpdCBQcm9taXNlLnJlc29sdmUobXNnKTtcclxuICAgIGNvbnN0IGVudmVsb3BlOiBJQnJvYWRjYXN0RW52ZWxvcGUgPSB7XHJcbiAgICAgIGNoYW5uZWxOYW1lOiBjaGFubmVsTmFtZSxcclxuICAgICAgc2VuZGVyQ3R4OiBnbG9iYWxUaGlzLmNvbnN0cnVjdG9yLm5hbWUsXHJcbiAgICAgIHNlbmRlcklkOiBzZW5kZXJJZCxcclxuICAgICAgdGFyZ2V0SWQ6IHRhcmdldElkLFxyXG4gICAgICBtc2c6IF9tc2csXHJcbiAgICAgIGNoYW5uZWxUeXBlLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoc2V0dGluZ3M/LmVuYWJsZUNhY2hpbmcpXHJcbiAgICAgIHRoaXMuc3RhdGUuc2V0KGNoYW5uZWxOYW1lLCBtc2cpO1xyXG5cclxuICAgIHRoaXMuX19iY0NoYW5uZWwucG9zdE1lc3NhZ2UoZW52ZWxvcGUpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgUHVibGlzaChcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBtc2c6IHVua25vd24sXHJcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xyXG4gICkge1xyXG4gICAgdGhpcy5sb2coYE1lc3NhZ2UgcHVibGlzaGVkYCwgY2hhbm5lbE5hbWUsIG1zZyk7XHJcbiAgICBhd2FpdCB0aGlzLl9fbm90aWZ5U3Vic2NyaWJlcnMoXHJcbiAgICAgIGNoYW5uZWxOYW1lLFxyXG4gICAgICBtc2csXHJcbiAgICAgIHNlbmRlcklkXHJcbiAgICApO1xyXG5cclxuICAgIGlmICghdGhpcy5icmFvZGNhc3RzLmhhcyhjaGFubmVsTmFtZSkpIHJldHVybjtcclxuXHJcbiAgICB0aGlzLl9icm9hZGNhc3QoY2hhbm5lbE5hbWUsIG1zZywgXCJwdWJTdWJcIiwgdGFyZ2V0SWQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfX25leHRNZXNzYWdlQXdhdGVycyA9IG5ldyBNYXA8XHJcbiAgICBzdHJpbmcsXHJcbiAgICB7XHJcbiAgICAgIHByb21pc2U6IFByb21pc2U8dW5rbm93bj47XHJcbiAgICAgIHJlc29sdmU6IChtc2c6IHVua25vd24pID0+IHVua25vd247XHJcbiAgICB9XHJcbiAgPigpO1xyXG5cclxuICBhc3luYyBuZXh0TWVzc2FnZTxUID0gdW5rbm93bj4oXHJcbiAgICBzdWJzS2V5OiBzdHJpbmdcclxuICApOiBQcm9taXNlPFQ+IHtcclxuICAgIGNvbnN0IGEgPSB0aGlzLl9fbmV4dE1lc3NhZ2VBd2F0ZXJzLmdldChzdWJzS2V5KTtcclxuICAgIGlmIChhKSByZXR1cm4gYS5wcm9taXNlIGFzIFByb21pc2U8VD47XHJcblxyXG4gICAgY29uc3QgbmV3QXdhaXRlcjoge1xyXG4gICAgICBwcm9taXNlOiBQcm9taXNlPHVua25vd24+O1xyXG4gICAgICByZXNvbHZlOiAobXNnOiB1bmtub3duKSA9PiB2b2lkO1xyXG4gICAgfSA9IHtcclxuICAgICAgcHJvbWlzZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgUHJvbWlzZTxUPixcclxuICAgICAgcmVzb2x2ZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgKFxyXG4gICAgICAgIG1zZzogdW5rbm93blxyXG4gICAgICApID0+IHZvaWQsXHJcbiAgICB9O1xyXG4gICAgbmV3QXdhaXRlci5wcm9taXNlID0gbmV3IFByb21pc2UoXHJcbiAgICAgIChyZXM6IChtc2c6IHVua25vd24pID0+IHZvaWQpID0+IHtcclxuICAgICAgICBuZXdBd2FpdGVyLnJlc29sdmUgPSByZXM7XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5zZXQoc3Vic0tleSwgbmV3QXdhaXRlcik7XHJcblxyXG4gICAgcmV0dXJuIG5ld0F3YWl0ZXIucHJvbWlzZSBhcyBQcm9taXNlPFQ+O1xyXG4gIH1cclxuXHJcbiAgU3Vic2NyaWJlPFQ+KFxyXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcclxuICAgIGhhbmRsZXI/OiBUSGFuZGxlcjxUPixcclxuICAgIGVuYWJsZUJyb2FkY2FzdCA9IGZhbHNlLFxyXG4gICAgZW5hYmxlQ2FjaGluZyA9IHRydWVcclxuICApOiBTdWJzY3JpcHRpb248VD4ge1xyXG4gICAgY29uc3Qgc2V0dGluZ3MgPSBjaGFubmVsU2V0dGluZ3MuZ2V0KGNoYW5uZWxOYW1lKTtcclxuICAgIGNvbnN0IHNldHRpbmdzT3ZlcnJpZGVuID0gZmFsc2U7XHJcbiAgICBpZiAoc2V0dGluZ3MpIHtcclxuICAgICAgZW5hYmxlQnJvYWRjYXN0ID0gc2V0dGluZ3MuZW5hYmxlQnJvYWRjYXN0IHx8IGZhbHNlO1xyXG4gICAgICBlbmFibGVDYWNoaW5nID0gc2V0dGluZ3MuZW5hYmxlQ2FjaGluZyB8fCB0cnVlO1xyXG4gICAgICBzZXR0aW5nc092ZXJyaWRlbjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdWJzID0gdGhpcy5zdWJzY3JpYmVycy5nZXQoY2hhbm5lbE5hbWUpIHx8IFtdO1xyXG4gICAgY29uc3QgaGRsID0gaGFuZGxlciBhcyAobXNnOiB1bmtub3duKSA9PiB2b2lkO1xyXG4gICAgc3Vicy5wdXNoKGhkbCk7XHJcbiAgICB0aGlzLnN1YnNjcmliZXJzLnNldChjaGFubmVsTmFtZSwgc3Vicyk7XHJcblxyXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb248VD4gPSB7XHJcbiAgICAgIGNoYW5uZWxOYW1lOiBjaGFubmVsTmFtZSxcclxuICAgICAgaXNDYWNoZWQ6IGZhbHNlLFxyXG4gICAgICBkaXNwb3NlOiAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgX3N1YnMgPSB0aGlzLnN1YnNjcmliZXJzLmdldChjaGFubmVsTmFtZSk7XHJcblxyXG4gICAgICAgIGlmIChfc3VicyA9PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICBjb25zdCBpID0gX3N1YnMuaW5kZXhPZihoZGwpO1xyXG5cclxuICAgICAgICBpZiAoaSA9PT0gLTEpIHJldHVybjtcclxuICAgICAgICBfc3Vicy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHB1Ymxpc2g6IChtc2csIHRhcmdldElkPzogc3RyaW5nKSA9PlxyXG4gICAgICAgIHRoaXMuUHVibGlzaChjaGFubmVsTmFtZSwgbXNnLCB0YXJnZXRJZCksXHJcbiAgICAgIGlzRGlzcG9zZWQ6IGZhbHNlLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoZW5hYmxlQnJvYWRjYXN0KVxyXG4gICAgICB0aGlzLl9fY29uZmlndXJlQnJvYWRjYXN0KHN1YnNjcmlwdGlvbik7XHJcbiAgICBpZiAoZW5hYmxlQ2FjaGluZylcclxuICAgICAgdGhpcy5zdGF0ZS5zZXQoY2hhbm5lbE5hbWUsIHVuZGVmaW5lZCk7XHJcblxyXG4gICAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYnJpZGdlUmVxdWVzdChcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICByZXF1ZXN0RGF0YTogdW5rbm93bixcclxuICAgIHNlbmRlcklkOiBzdHJpbmdcclxuICApIHtcclxuICAgIGNvbnN0IGxpc3RlbmVyID0gdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLmdldChjaGFubmVsTmFtZSk7XHJcblxyXG4gICAgaWYgKCFsaXN0ZW5lcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xyXG5cclxuICAgIHJldHVybiBsaXN0ZW5lci5oYW5kbGVyKFxyXG4gICAgICByZXF1ZXN0RGF0YSxcclxuICAgICAgc2VuZGVySWRcclxuICAgICkgYXMgUHJvbWlzZTx1bmtub3duPjtcclxuICB9XHJcblxyXG4gIFJlcXVlc3Q8VFJlcCA9IHVua25vd24+KFxyXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcclxuICAgIHJlcXVlc3REYXRhOiB1bmtub3duLFxyXG4gICAgZW5hYmxlQnJvYWRjYXN0ID0gZmFsc2UsXHJcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xyXG4gICk6IFByb21pc2U8VFJlcD4gfCBQcm9taXNlPHVuZGVmaW5lZD4ge1xyXG4gICAgaWYgKCFlbmFibGVCcm9hZGNhc3QpIHtcclxuICAgICAgY29uc3QgbGlzdGVuZXIgPVxyXG4gICAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xyXG4gICAgICBpZiAoIWxpc3RlbmVyKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7XHJcbiAgICAgIHJldHVybiBsaXN0ZW5lci5oYW5kbGVyKHJlcXVlc3REYXRhKSBhcyBQcm9taXNlPFRSZXA+O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fYnJvYWRjYXN0KFxyXG4gICAgICAgIGNoYW5uZWxOYW1lLFxyXG4gICAgICAgIHJlcXVlc3REYXRhLFxyXG4gICAgICAgIFwicmVxXCIsXHJcbiAgICAgICAgdGFyZ2V0SWRcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgcmVxID0gdGhpcy5icm9hZGNhc3RlZFJlcXVlc3RzLmdldChjaGFubmVsTmFtZSk7XHJcbiAgICAgIGlmIChyZXEpIHJlcS5yZXNvbHZlKHVuZGVmaW5lZCk7XHJcblxyXG4gICAgICBsZXQgcmVzb2x2ZSA9IHVuZGVmaW5lZCBhcyB1bmtub3duIGFzIChcclxuICAgICAgICByOiB1bmtub3duXHJcbiAgICAgICkgPT4gdm9pZDtcclxuICAgICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlPFRSZXA+KFxyXG4gICAgICAgIChyZXMpID0+IChyZXNvbHZlID0gcmVzIGFzIChyOiB1bmtub3duKSA9PiB2b2lkKVxyXG4gICAgICApO1xyXG4gICAgICBjb25zdCBicmVxID0ge1xyXG4gICAgICAgIHByb21pc2UsXHJcbiAgICAgICAgcmVzb2x2ZSxcclxuICAgICAgfTtcclxuICAgICAgdGhpcy5icm9hZGNhc3RlZFJlcXVlc3RzLnNldChjaGFubmVsTmFtZSwgYnJlcSk7XHJcbiAgICAgIHJldHVybiBicmVxLnByb21pc2U7XHJcbiAgICB9XHJcbiAgfVxyXG4gIHByaXZhdGUgYnJvYWRjYXN0ZWRSZXF1ZXN0cyA9IG5ldyBNYXA8XHJcbiAgICBzdHJpbmcsXHJcbiAgICB7XHJcbiAgICAgIHByb21pc2U6IFByb21pc2U8dW5rbm93bj47XHJcbiAgICAgIHJlc29sdmU6IChyOiB1bmtub3duKSA9PiB2b2lkO1xyXG4gICAgfVxyXG4gID4oKTtcclxuXHJcbiAgUmVwbHk8VFJlcSA9IHVua25vd24sIFRSZXAgPSB1bmtub3duPihcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBoYW5kbGVyOiAocmVxOiBUUmVxKSA9PiBUUmVwLFxyXG4gICAgZW5hYmxlQnJvYWRjYXN0ID0gZmFsc2VcclxuICApIHtcclxuICAgIGlmIChlbmFibGVCcm9hZGNhc3QpIHtcclxuICAgICAgY29uc3Qgb3JpZ0hhbmRsZXIgPSBoYW5kbGVyO1xyXG4gICAgICBoYW5kbGVyID0gKChtc2c6IFRSZXEsIHRhcmdldElkOiBzdHJpbmcpID0+XHJcbiAgICAgICAgdGhpcy5fYnJvYWRjYXN0KFxyXG4gICAgICAgICAgY2hhbm5lbE5hbWUsXHJcbiAgICAgICAgICBvcmlnSGFuZGxlcihtc2cpLFxyXG4gICAgICAgICAgXCJyZXBcIixcclxuICAgICAgICAgIHRhcmdldElkXHJcbiAgICAgICAgKSkgYXMgdW5rbm93biBhcyAocmVxOiBUUmVxKSA9PiBUUmVwO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcmVxTGlzdGVuZXJzID0gdGhpcy5yZXF1ZXN0TGlzdGVuZXJzO1xyXG4gICAgY29uc3Qgc3ViczogUmVxU3Vic2NyaXB0aW9uID0ge1xyXG4gICAgICBjaGFubmVsTmFtZSxcclxuICAgICAgZ2V0IGlzRGlzcG9zZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcUxpc3RlbmVycy5oYXMoY2hhbm5lbE5hbWUpO1xyXG4gICAgICB9LFxyXG4gICAgICBpc0Jyb2FkY2FzdDogZW5hYmxlQnJvYWRjYXN0LFxyXG4gICAgICBoYW5kbGVyOiBoYW5kbGVyIGFzIChyOiB1bmtub3duKSA9PiB1bmtub3duLFxyXG4gICAgICBkaXNwb3NlOiB1bmRlZmluZWQgYXMgdW5rbm93biBhcyAoKSA9PiB2b2lkLFxyXG4gICAgfTtcclxuXHJcbiAgICBzdWJzLmRpc3Bvc2UgPSAoKSA9PiB7XHJcbiAgICAgIHN1YnMuaXNEaXNwb3NlZCA9IHRydWU7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5lciA9XHJcbiAgICAgICAgdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLmdldChjaGFubmVsTmFtZSk7XHJcbiAgICAgIGlmIChjdXJyZW50TGlzdGVuZXIgPT09IHN1YnMpXHJcbiAgICAgICAgdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLmRlbGV0ZShjaGFubmVsTmFtZSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5lciA9XHJcbiAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xyXG4gICAgaWYgKGN1cnJlbnRMaXN0ZW5lcikge1xyXG4gICAgICBjdXJyZW50TGlzdGVuZXIuaXNEaXNwb3NlZCA9IHRydWU7XHJcbiAgICAgIGNvbnNvbGUud2FybihcclxuICAgICAgICBcIlJlcXVlc3QgbGlzdGVuZXIgaGFzIGJlZW4gcmVwbGFjZWQ6IFwiICsgY2hhbm5lbE5hbWVcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5zZXQoY2hhbm5lbE5hbWUsIHN1YnMpO1xyXG4gICAgcmV0dXJuIHN1YnM7XHJcbiAgfVxyXG5cclxuICByZXF1ZXN0TGlzdGVuZXJzID0gbmV3IE1hcDxzdHJpbmcsIFJlcVN1YnNjcmlwdGlvbj4oKTtcclxuXHJcbiAgcHJpdmF0ZSBhc3luYyBfX25vdGlmeVN1YnNjcmliZXJzKFxyXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcclxuICAgIG1zZzogdW5rbm93bixcclxuICAgIHNJZDogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICBjb25zdCBoYW5kbGVycyA9XHJcbiAgICAgIHRoaXMuc3Vic2NyaWJlcnMuZ2V0KGNoYW5uZWxOYW1lKSB8fCBbXTtcclxuXHJcbiAgICBjb25zdCBhbGxTdWJzY3JpYmVyc1Byb21pc2VzOiBQcm9taXNlPHZvaWQ+W10gPSBbXTtcclxuICAgIGZvciAoY29uc3QgaCBvZiBoYW5kbGVycykge1xyXG4gICAgICBpZiAoIWgpIGNvbnRpbnVlO1xyXG4gICAgICBhbGxTdWJzY3JpYmVyc1Byb21pc2VzLnB1c2goXHJcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKGgobXNnLCBzSWQpKVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLmxvZyhcIkhhbmRsZXIgY2FsbGVkXCIsIGNoYW5uZWxOYW1lLCBoKTtcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCBQcm9taXNlLmFsbChhbGxTdWJzY3JpYmVyc1Byb21pc2VzKTtcclxuXHJcbiAgICBpZiAodGhpcy5zdGF0ZS5oYXMoY2hhbm5lbE5hbWUpKVxyXG4gICAgICB0aGlzLnN0YXRlLnNldChjaGFubmVsTmFtZSwgbXNnKTtcclxuXHJcbiAgICB0aGlzLl9faGFuZGxlQXdhaXRlcihjaGFubmVsTmFtZSwgbXNnKTtcclxuXHJcbiAgICB0aGlzLmxvZyhcIk1lc3NhZ2UgaGFuZGxlZFwiLCBjaGFubmVsTmFtZSwgbXNnLCB0aGlzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX19oYW5kbGVBd2FpdGVyKHN1YnNLZXk6IHN0cmluZywgbXNnOiB1bmtub3duKSB7XHJcbiAgICBjb25zdCBhd2FpdGVyID0gdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5nZXQoc3Vic0tleSk7XHJcbiAgICBpZiAoIWF3YWl0ZXIpIHJldHVybjtcclxuXHJcbiAgICBhd2FpdGVyLnJlc29sdmUobXNnKTtcclxuXHJcbiAgICB0aGlzLl9fbmV4dE1lc3NhZ2VBd2F0ZXJzLmRlbGV0ZShzdWJzS2V5KTtcclxuICB9XHJcbn1cclxuXHJcbmdsb2JhbFRoaXMuQnJvd3Nlck1lc3NhZ2VCcm9rZXIgPVxyXG4gIGdsb2JhbFRoaXMuQnJvd3Nlck1lc3NhZ2VCcm9rZXIgfHwgbmV3IEJyb2tlcigpO1xyXG5cclxuZXhwb3J0IGNvbnN0IEJNQiA9IGdsb2JhbFRoaXMuQnJvd3Nlck1lc3NhZ2VCcm9rZXI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL1B1YlN1YkNoYW5uZWxcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vUmVxUmVwQ2hhbm5lbFwiO1xyXG4iLCAiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XHJcbmltcG9ydCB7XHJcbiAgRGlzcG9zZXIsXHJcbiAgQ2hhbm5lbFNldHRpbmdzLFxyXG4gIElQdWJTdWJDaGFubmVsLFxyXG4gIFRIYW5kbGVyLFxyXG59IGZyb20gXCIuL1R5cGVzXCI7XHJcblxyXG5jb25zdCBwdWJTdWJDaGFubmVscyA9IG5ldyBNYXA8c3RyaW5nLCBQdWJTdWJDaGFubmVsPigpO1xyXG5cclxuZXhwb3J0IGNsYXNzIFB1YlN1YkNoYW5uZWw8VE1zZyA9IGFueT5cclxuICBpbXBsZW1lbnRzIElQdWJTdWJDaGFubmVsPFRNc2c+XHJcbntcclxuICBzdGF0aWMgZ2V0T3JDcmVhdGU8VE1zZz4oXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBzZXR0aW5ncz86IENoYW5uZWxTZXR0aW5nc1xyXG4gICk6IFB1YlN1YkNoYW5uZWw8VE1zZz4ge1xyXG4gICAgaWYgKCFzZXR0aW5ncykge1xyXG4gICAgICBjb25zdCBjID0gcHViU3ViQ2hhbm5lbHMuZ2V0KG5hbWUpO1xyXG4gICAgICBpZiAoIWMpIHRocm93IEVycm9yKFwiQ2FuJ3QgZmluZCBjaGFubmVsIHNldHRpbmdzXCIpO1xyXG4gICAgICByZXR1cm4gYyBhcyBQdWJTdWJDaGFubmVsPFRNc2c+O1xyXG4gICAgfVxyXG5cclxuICAgIEJNQi5Db25maWd1cmVDaGFubmVsKFxyXG4gICAgICBuYW1lLFxyXG4gICAgICBzZXR0aW5ncy5lbmFibGVCcm9hZGNhc3QgfHwgZmFsc2UsXHJcbiAgICAgIHNldHRpbmdzLmVuYWJsZUNhY2hpbmcgfHwgZmFsc2UsXHJcbiAgICAgIHNldHRpbmdzLnRyYWNlIHx8IGZhbHNlXHJcbiAgICApO1xyXG4gICAgY29uc3QgY2hhbm5lbCA9IG5ldyBQdWJTdWJDaGFubmVsPFRNc2c+KG5hbWUsIHNldHRpbmdzKTtcclxuICAgIHB1YlN1YkNoYW5uZWxzLnNldChuYW1lLCBjaGFubmVsKTtcclxuICAgIHJldHVybiBjaGFubmVsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3NcclxuICApIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgfVxyXG5cclxuICBhc3luYyBzZW5kKG1zZzogVE1zZywgdGFyZ2V0SWQ/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIEJNQi5QdWJsaXNoKHRoaXMubmFtZSwgbXNnLCB0YXJnZXRJZCk7XHJcbiAgfVxyXG4gIHN0YXRpYyBhc3luYyBwdWJsaXNoPFRNc2cgPSBhbnk+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiBUTXNnLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIEJNQi5QdWJsaXNoKG5hbWUsIG1zZywgdGFyZ2V0SWQpO1xyXG4gIH1cclxuICBzdGF0aWMgYXN5bmMgYnJvYWRjYXN0PFRNc2cgPSBhbnk+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiBUTXNnLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIEJNQi5Ccm9hZGNhc3Q8VE1zZz4obmFtZSwgbXNnLCB0YXJnZXRJZCk7XHJcbiAgfVxyXG5cclxuICBzdWJzY3JpYmUoaGFuZGxlcjogVEhhbmRsZXI8VE1zZz4pOiBEaXNwb3NlciB7XHJcbiAgICBjb25zdCBzID0gQk1CLlN1YnNjcmliZShcclxuICAgICAgdGhpcy5uYW1lLFxyXG4gICAgICBoYW5kbGVyLFxyXG4gICAgICB0aGlzLnNldHRpbmdzLmVuYWJsZUJyb2FkY2FzdCxcclxuICAgICAgdGhpcy5zZXR0aW5ncy5lbmFibGVDYWNoaW5nXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHMuZGlzcG9zZTtcclxuICB9XHJcblxyXG4gIGdldFN0YXRlKCk6IFRNc2cgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIEJNQi5HZXRTdGF0ZSh0aGlzLm5hbWUpO1xyXG4gIH1cclxuICBzdGF0aWMgR2V0U3RhdGU8VE1zZz4obmFtZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gQk1CLkdldFN0YXRlPFRNc2c+KG5hbWUpO1xyXG4gIH1cclxuXHJcbiAgbmV4dE1lc3NhZ2UoKTogUHJvbWlzZTxUTXNnPiB7XHJcbiAgICByZXR1cm4gQk1CLm5leHRNZXNzYWdlKHRoaXMubmFtZSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgbmV4dE1lc3NhZ2U8VE1zZz4obmFtZTogc3RyaW5nKTogUHJvbWlzZTxUTXNnPiB7XHJcbiAgICByZXR1cm4gQk1CLm5leHRNZXNzYWdlKG5hbWUpO1xyXG4gIH1cclxuXHJcbiAgcmVhZG9ubHkgdHlwZSA9IFwicHViU3ViXCI7XHJcbiAgcmVhZG9ubHkgZGlzcG9zZSA9ICgpID0+IHtcclxuICAgIEJNQi5zdWJzY3JpYmVycy5kZWxldGUodGhpcy5uYW1lKTtcclxuICAgIHB1YlN1YkNoYW5uZWxzLmRlbGV0ZSh0aGlzLm5hbWUpO1xyXG4gIH07XHJcblxyXG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZyA9IFwiXCI7XHJcbiAgcmVhZG9ubHkgc2V0dGluZ3M6IENoYW5uZWxTZXR0aW5ncyA9IHt9O1xyXG59XHJcbiIsICJleHBvcnQgY29uc3QgUFVCX1NVQl9SRVFVRVNUX1NVQlNDUklQVElPTl9LRVkgPSBcInRlc3RSZXFcIjtcclxuZXhwb3J0IGNvbnN0IFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSA9IFwidGVzdFJlc3BcIjtcclxuZXhwb3J0IGNvbnN0IFJFUV9SRVBfQ0hBTk5FTF9OQU1FID0gXCJyZXFSZXBDaGFubmVsXCI7XHJcbiIsICJpbXBvcnQge1xyXG4gIFB1YlN1YkNoYW5uZWwsXHJcbiAgUmVxUmVwQ2hhbm5lbCxcclxufSBmcm9tIFwiYnJvd3Nlci1tZXNzYWdlLWJyb2tlclwiO1xyXG5pbXBvcnQge1xyXG4gIFBVQl9TVUJfUkVRVUVTVF9TVUJTQ1JJUFRJT05fS0VZLFxyXG4gIFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSxcclxuICBSRVFfUkVQX0NIQU5ORUxfTkFNRSxcclxufSBmcm9tIFwiLi9jb25zdGFudHNcIjtcclxuXHJcblB1YlN1YkNoYW5uZWwuZ2V0T3JDcmVhdGUoXHJcbiAgUFVCX1NVQl9SRVFVRVNUX1NVQlNDUklQVElPTl9LRVksXHJcbiAge1xyXG4gICAgZW5hYmxlQnJvYWRjYXN0OiB0cnVlLFxyXG4gIH1cclxuKS5zdWJzY3JpYmUoKF8pID0+IHtcclxuICBQdWJTdWJDaGFubmVsLmJyb2FkY2FzdChcclxuICAgIFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSxcclxuICAgIHsgcGF5bG9hZDogXCJyZXNwb25zZVwiIH1cclxuICApO1xyXG59KTtcclxuXHJcblJlcVJlcENoYW5uZWwuZ2V0T3JDcmVhdGU8XHJcbiAgeyBwYXlsb2FkOiBzdHJpbmcgfSxcclxuICB7IHBheWxvYWQ6IHN0cmluZyB9XHJcbj4oUkVRX1JFUF9DSEFOTkVMX05BTUUsIHtcclxuICBlbmFibGVCcm9hZGNhc3Q6IHRydWUsXHJcbn0pLnJlcGx5KChyZXEpID0+IHtcclxuICByZXR1cm4geyBwYXlsb2FkOiByZXEucGF5bG9hZCArIFwicmVzcG9uc2VcIiB9O1xyXG59KTtcclxuXHJcbi8vbGV0IHdpbmRvdyBrbm93IHRoYXQgd29ya2VyIGlzIHJlYWR5IGFuZCBleGVjdXRlIHRlc3RcclxucG9zdE1lc3NhZ2UoXCJyZWFkeVwiKTtcclxuIl0sCiAgIm1hcHBpbmdzIjogIjtBQUdBLElBQU0sSUFBaUIsb0JBQUk7QUFBM0IsSUFFYSxJQUFOLE1BRVA7RUFtRFUsWUFDTixHQUNBLEdBQ0E7QUFyQ0YsU0FBUyxPQUFpQjtBQUUxQixTQUFBLFdBQTRCLENBQUM7QUFPN0IsU0FBUyxPQUFlO0FBNkJ0QixTQUFLLE9BQU8sR0FDWixLQUFLLFdBQVc7RUFDbEI7RUF4REEsTUFBTSxRQUFRLEdBQXVDO0FBQ25ELFdBQU8sRUFBSSxRQUNULEtBQUssTUFDTCxHQUNBLEtBQUssU0FBUyxlQUNoQjtFQUNGO0VBRUEsTUFBTSxHQUE4QztBQUNsRCxXQUFPLEVBQUks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
