"use strict";

// ../browser-message-broker/dist/Module.js
var T = /* @__PURE__ */ new Map();
var b = class {
  constructor(e, s) {
    this.type = "reqRep";
    this.settings = {};
    this.name = "";
    this.name = e, this.settings = s;
  }
  async request(e) {
    return i.Request(this.name, e, this.settings.broadcast);
  }
  reply(e) {
    return i.Reply(this.name, e, this.settings.broadcast).dispose;
  }
  dispose() {
    i.requestListeners.delete(this.name), T.delete(this.name);
  }
  static for(e, s) {
    if (!s) {
      let n = T.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.broadcast || false, s.cache || false, s.trace || false);
    let t = new b(e, s);
    return T.set(e, t), t;
  }
};
var S = "broadcast-sync";
var R = "browser-message-broker";
function k(d) {
  return d.channelName === S;
}
function B(d) {
  return d.senderId != null && d.targetId == null;
}
function q(d) {
  return d.senderId != null && d.targetId != null;
}
var l = Math.random().toString(36).substring(2, 9);
function M(d, e = 1) {
  let s;
  return (...t) => {
    clearTimeout(s), s = setTimeout(() => {
      d(...t);
    }, e);
  };
}
var h = /* @__PURE__ */ new Map();
var w = class {
  constructor() {
    this.trace = false;
    this.senderId = l;
    this.state = /* @__PURE__ */ new Map();
    this.subscribers = /* @__PURE__ */ new Map();
    this.braodcasts = /* @__PURE__ */ new Set();
    this.__bcChannel = new BroadcastChannel(R);
    this.__nextMessageAwaters = /* @__PURE__ */ new Map();
    this.broadcastedRequests = /* @__PURE__ */ new Map();
    this.requestListeners = /* @__PURE__ */ new Map();
    this.__bcChannel.onmessage = this.handleBroadcast.bind(this), this.__bcChannel.onmessageerror = this.handleBroadcastError.bind(this), setTimeout(() => {
      this.__sendBrokerState(void 0, void 0);
    }, 0), this.sendBrokerState = M(this.__sendBrokerState.bind(this), 2);
  }
  log(e, s, ...t) {
    (this.trace || h.get(s)?.trace) && console.log(`[${globalThis.constructor.name}(${this.senderId})-${s}] ${e}`, t);
  }
  ConfigureChannel(e, s, t, n) {
    h.set(e, { broadcast: s, cache: t, trace: n }), t && this.state.set(e, void 0), s && this.braodcasts.add(e);
  }
  handleBroadcastError(e) {
    throw Error("BROADCAST FAILED: " + e.data);
  }
  __sendBrokerState(e, s) {
    let t = Array.from(this.braodcasts.keys());
    s && s.length > 0 && (t = t.filter((o) => s.includes(o)));
    let n = {};
    for (let o of this.state)
      !o[1] || !t.includes(o[0]) || (n[o[0]] = o[1]);
    let r = { id: l, availableState: n, broadcasts: t }, a = { channelName: S, senderCtx: globalThis.constructor.name, senderId: l, targetId: e, msg: r, channelType: "sync" };
    this.__bcChannel.postMessage(a), e == null ? this.log("Broadcast sync requested", "", { brokerState: r }) : this.log("Broadcast sync responded", "", { targetId: e, brokerState: r });
  }
  handleBroadcastSync(e) {
    if (B(e))
      return this.sendBrokerState(e.senderId, e.msg.broadcasts);
    if (q(e))
      for (let s of Object.entries(e.msg.availableState))
        this.braodcasts.has(s[0]) && this.state.has(s[0]) && this.state.get(s[0]) == null && this.__notifySubscribers(s[0], s[1], e.senderId), this.log("Broadcast sync responce handled", "", e.msg);
  }
  handleBroadcast(e) {
    if (this.log("Broadcast received", e.data.channelName, e.data), e.data.targetId != null && e.data.targetId !== l) {
      this.log("Broadcast ignored (different targetId)", e.data.channelName);
      return;
    }
    if (k(e.data))
      return this.handleBroadcastSync(e.data);
    switch (e.data.channelType) {
      case "pubSub":
        this.__notifySubscribers(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "req":
        this.bridgeRequest(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "rep":
        let s = this.broadcastedRequests.get(e.data.channelName);
        if (!s)
          return;
        s.resolve(e.data.msg), this.broadcastedRequests.delete(e.data.channelName);
        break;
    }
    this.log("Broadcast handled", e.data.channelName, e.data);
  }
  __configureBroadcast(e) {
    if (!e.channelName)
      throw new Error("Invalid subscription");
    this.braodcasts.add(e.channelName);
    let s = e.dispose;
    e.dispose = () => {
      s(), this.braodcasts.delete(e.channelName);
    }, e.isBroadcast = true, this.sendBrokerState();
  }
  GetState(e) {
    if (e)
      return this.state.get(e);
  }
  async Broadcast(e, s, t) {
    this._broadcast(e, s, "pubSub", t);
  }
  async _broadcast(e, s, t, n) {
    let r = h.get(e);
    this.log(`Message broadcasted (${t}) to ${n || "all brokers"}`, e, s);
    let a = await Promise.resolve(s), o = { channelName: e, senderCtx: globalThis.constructor.name, senderId: l, targetId: n, msg: a, channelType: t };
    r?.cache && this.state.set(e, s), this.__bcChannel.postMessage(o);
  }
  async Publish(e, s, t) {
    this.log("Message published", e, s), await this.__notifySubscribers(e, s, l), this.braodcasts.has(e) && this._broadcast(e, s, "pubSub", t);
  }
  async nextMessage(e) {
    let s = this.__nextMessageAwaters.get(e);
    if (s)
      return s.promise;
    let t = { promise: void 0, resolve: void 0 };
    return t.promise = new Promise((n) => {
      t.resolve = n;
    }), this.__nextMessageAwaters.set(e, t), t.promise;
  }
  Subscribe(e, s, t = false, n = true) {
    let r = h.get(e), a = false;
    r && (t = r.broadcast || false, n = r.cache || true);
    let o = this.subscribers.get(e) || [], c = s;
    o.push(c), this.subscribers.set(e, o);
    let u = { channelName: e, isCached: false, dispose: () => {
      let g = this.subscribers.get(e);
      if (g == null)
        return;
      let p = g.indexOf(c);
      p !== -1 && g.splice(p, 1);
    }, publish: (g, p) => this.Publish(e, g, p), isDisposed: false };
    return t && this.__configureBroadcast(u), n && this.state.set(e, void 0), u;
  }
  bridgeRequest(e, s, t) {
    let n = this.requestListeners.get(e);
    return n ? n.handler(s, t) : Promise.resolve(void 0);
  }
  Request(e, s, t = false, n) {
    if (t) {
      this._broadcast(e, s, "req", n);
      let r = this.broadcastedRequests.get(e);
      r && r.resolve(void 0);
      let a, c = { promise: new Promise((u) => a = u), resolve: a };
      return this.broadcastedRequests.set(e, c), c.promise;
    } else {
      let r = this.requestListeners.get(e);
      return r ? r.handler(s) : Promise.resolve(void 0);
    }
  }
  Reply(e, s, t = false) {
    if (t) {
      let o = s;
      s = (c, u) => this._broadcast(e, o(c), "rep", u);
    }
    let n = this.requestListeners, r = { channelName: e, get isDisposed() {
      return n.has(e);
    }, isBroadcast: t, handler: s, dispose: void 0 };
    r.dispose = () => {
      r.isDisposed = true, this.requestListeners.get(e) === r && this.requestListeners.delete(e);
    };
    let a = this.requestListeners.get(e);
    return a && (a.isDisposed = true, console.warn("Request listener has been replaced: " + e)), this.requestListeners.set(e, r), r;
  }
  async __notifySubscribers(e, s, t) {
    let n = this.subscribers.get(e) || [], r = [];
    for (let a of n)
      !a || (r.push(Promise.resolve(a(s, t))), this.log("Handler called", e, a));
    await Promise.all(r), h.get(e)?.cache && this.state.set(e, s), this.__handleAwaiter(e, s), this.log("Message handled", e, s, this);
  }
  __handleAwaiter(e, s) {
    let t = this.__nextMessageAwaters.get(e);
    !t || (t.resolve(s), this.__nextMessageAwaters.delete(e));
  }
};
globalThis.BrowserMessageBroker = globalThis.BrowserMessageBroker || new w();
var i = globalThis.BrowserMessageBroker;
var m = /* @__PURE__ */ new Map();
var f = class {
  constructor(e, s) {
    this.type = "pubSub";
    this.dispose = () => {
      i.subscribers.delete(this.name), m.delete(this.name);
    };
    this.name = "";
    this.settings = {};
    this.name = e, this.settings = s;
  }
  static for(e, s) {
    if (!s) {
      let n = m.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.broadcast || false, s.cache || false, s.trace || false);
    let t = new f(e, s);
    return m.set(e, t), t;
  }
  async send(e, s) {
    i.Publish(this.name, e, s);
  }
  static async publish(e, s, t) {
    i.Publish(e, s, t);
  }
  static async broadcast(e, s, t) {
    i.Broadcast(e, s, t);
  }
  subscribe(e) {
    return i.Subscribe(this.name, e, this.settings.broadcast, this.settings.cache).dispose;
  }
  getState() {
    return i.GetState(this.name);
  }
  static GetState(e) {
    return i.GetState(e);
  }
  nextMessage() {
    return i.nextMessage(this.name);
  }
  static nextMessage(e) {
    return i.nextMessage(e);
  }
};

// suite/WebWorker/constants.ts
var PUB_SUB_REQUEST_SUBSCRIPTION_KEY = "testReq";
var PUB_SUB_RESPONSE_SUBSCRIPTION_KEY = "testResp";
var REQ_REP_CHANNEL_NAME = "reqRepChannel";

// suite/WebWorker/testWorker.ts
f.for(PUB_SUB_REQUEST_SUBSCRIPTION_KEY, {
  broadcast: true
}).subscribe((_) => {
  f.broadcast(PUB_SUB_RESPONSE_SUBSCRIPTION_KEY, { payload: "response" });
});
b.for(REQ_REP_CHANNEL_NAME, {
  broadcast: true
}).reply((req) => {
  return { payload: req.payload + "response" };
});
postMessage("ready");
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUmVxUmVwQ2hhbm5lbC50cyIsICIuLi8uLi8uLi9icm93c2VyLW1lc3NhZ2UtYnJva2VyL3NyYy9Ccm9rZXIudHMiLCAiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUHViU3ViQ2hhbm5lbC50cyIsICJjb25zdGFudHMudHMiLCAidGVzdFdvcmtlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XHJcbmltcG9ydCB7IENoYW5uZWxTZXR0aW5ncywgSVJlcVJlcENoYW5uZWwgfSBmcm9tIFwiLi9UeXBlc1wiO1xyXG5cclxuY29uc3QgcmVxUmVwQ2hhbm5lbHMgPSBuZXcgTWFwPHN0cmluZywgUmVxUmVwQ2hhbm5lbD4oKTtcclxuXHJcbmV4cG9ydCBjbGFzcyBSZXFSZXBDaGFubmVsPFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj5cclxuICBpbXBsZW1lbnRzIElSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+XHJcbntcclxuICBhc3luYyByZXF1ZXN0KG1zZz86IFRSZXEpOiBQcm9taXNlPFRSZXAgfCB1bmRlZmluZWQ+IHtcclxuICAgIHJldHVybiBCTUIuUmVxdWVzdDxUUmVwPihcclxuICAgICAgdGhpcy5uYW1lLFxyXG4gICAgICBtc2csXHJcbiAgICAgIHRoaXMuc2V0dGluZ3MuYnJvYWRjYXN0XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcmVwbHkoaGFuZGxlcjogKHJlcTogVFJlcSkgPT4gVFJlcCB8IFByb21pc2U8VFJlcD4pIHtcclxuICAgIHJldHVybiBCTUIuUmVwbHk8VFJlcSwgVFJlcD4oXHJcbiAgICAgIHRoaXMubmFtZSxcclxuICAgICAgaGFuZGxlcixcclxuICAgICAgdGhpcy5zZXR0aW5ncy5icm9hZGNhc3RcclxuICAgICkuZGlzcG9zZTtcclxuICB9XHJcblxyXG4gIHJlYWRvbmx5IHR5cGU6IFwicmVxUmVwXCIgPSBcInJlcVJlcFwiO1xyXG5cclxuICBzZXR0aW5nczogQ2hhbm5lbFNldHRpbmdzID0ge307XHJcblxyXG4gIGRpc3Bvc2UoKSB7XHJcbiAgICBCTUIucmVxdWVzdExpc3RlbmVycy5kZWxldGUodGhpcy5uYW1lKTtcclxuICAgIHJlcVJlcENoYW5uZWxzLmRlbGV0ZSh0aGlzLm5hbWUpO1xyXG4gIH1cclxuXHJcbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nID0gXCJcIjtcclxuXHJcbiAgc3RhdGljIGZvcjxUUmVxID0gdW5rbm93biwgVFJlcCA9IHVua25vd24+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgc2V0dGluZ3M/OiBDaGFubmVsU2V0dGluZ3NcclxuICApOiBSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+IHtcclxuICAgIGlmICghc2V0dGluZ3MpIHtcclxuICAgICAgY29uc3QgYyA9IHJlcVJlcENoYW5uZWxzLmdldChuYW1lKTtcclxuICAgICAgaWYgKCFjKSB0aHJvdyBFcnJvcihcIkNhbid0IGZpbmQgY2hhbm5lbCBzZXR0aW5nc1wiKTtcclxuICAgICAgcmV0dXJuIGMgYXMgUmVxUmVwQ2hhbm5lbDxUUmVxLCBUUmVwPjtcclxuICAgIH1cclxuXHJcbiAgICBCTUIuQ29uZmlndXJlQ2hhbm5lbChcclxuICAgICAgbmFtZSxcclxuICAgICAgc2V0dGluZ3MuYnJvYWRjYXN0IHx8IGZhbHNlLFxyXG4gICAgICBzZXR0aW5ncy5jYWNoZSB8fCBmYWxzZSxcclxuICAgICAgc2V0dGluZ3MudHJhY2UgfHwgZmFsc2VcclxuICAgICk7XHJcbiAgICBjb25zdCBjaGFubmVsID0gbmV3IFJlcVJlcENoYW5uZWw8VFJlcSwgVFJlcD4oXHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIHNldHRpbmdzXHJcbiAgICApO1xyXG4gICAgcmVxUmVwQ2hhbm5lbHMuc2V0KG5hbWUsIGNoYW5uZWwpO1xyXG4gICAgcmV0dXJuIGNoYW5uZWw7XHJcbiAgfVxyXG4gIHByaXZhdGUgY29uc3RydWN0b3IoXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBzZXR0aW5nczogQ2hhbm5lbFNldHRpbmdzXHJcbiAgKSB7XHJcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xyXG4gIH1cclxufVxyXG4iLCAiaW1wb3J0IHtcclxuICBDaGFubmVsVHlwZSxcclxuICBJQnJvYWRjYXN0RW52ZWxvcGUsXHJcbiAgSUJyb2FkY2FzdFN5bmNFbnZlbG9wZSxcclxuICBJQnJva2VyLFxyXG4gIElCcm9rZXJTdGF0ZSxcclxuICBDaGFubmVsU2V0dGluZ3MsXHJcbiAgUmVxU3Vic2NyaXB0aW9uLFxyXG4gIFN1YnNjcmlwdGlvbixcclxuICBUSGFuZGxlcixcclxufSBmcm9tIFwiLi9UeXBlc1wiO1xyXG5cclxuY29uc3QgQlJPQURDQVNUX1NZTkMgPSBcImJyb2FkY2FzdC1zeW5jXCI7XHJcbmNvbnN0IEJST1dTRVJfTUVTU0FHRV9CUk9LRVIgPSBcImJyb3dzZXItbWVzc2FnZS1icm9rZXJcIjtcclxuXHJcbmZ1bmN0aW9uIGlzQnJvYWRjYXN0U3luYyhcclxuICBlOiBJQnJvYWRjYXN0RW52ZWxvcGVcclxuKTogZSBpcyBJQnJvYWRjYXN0U3luY0VudmVsb3BlIHtcclxuICByZXR1cm4gZS5jaGFubmVsTmFtZSA9PT0gQlJPQURDQVNUX1NZTkM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzU3luY1JlcShlOiBJQnJvYWRjYXN0RW52ZWxvcGUpIHtcclxuICByZXR1cm4gZS5zZW5kZXJJZCAhPSB1bmRlZmluZWQgJiYgZS50YXJnZXRJZCA9PSB1bmRlZmluZWQ7XHJcbn1cclxuZnVuY3Rpb24gaXNTeW5jUmVzcChlOiBJQnJvYWRjYXN0RW52ZWxvcGUpIHtcclxuICByZXR1cm4gZS5zZW5kZXJJZCAhPSB1bmRlZmluZWQgJiYgZS50YXJnZXRJZCAhPSB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzZW5kZXJJZCA9IE1hdGgucmFuZG9tKClcclxuICAudG9TdHJpbmcoMzYpXHJcbiAgLnN1YnN0cmluZygyLCA5KTtcclxuXHJcbmZ1bmN0aW9uIGRlYm91bmNlPFQgZXh0ZW5kcyBGdW5jdGlvbj4oXHJcbiAgZnVuYzogVCxcclxuICB0aW1lb3V0ID0gMVxyXG4pIHtcclxuICBsZXQgdGltZXI6IG51bWJlcjtcclxuICByZXR1cm4gKC4uLmFyZ3M6IHVua25vd25bXSkgPT4ge1xyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcclxuICAgIHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIGZ1bmMoLi4uYXJncyk7XHJcbiAgICB9LCB0aW1lb3V0KTtcclxuICB9O1xyXG59XHJcblxyXG5jb25zdCBjaGFubmVsU2V0dGluZ3MgPSBuZXcgTWFwPHN0cmluZywgQ2hhbm5lbFNldHRpbmdzPigpO1xyXG5cclxuY2xhc3MgQnJva2VyIGltcGxlbWVudHMgSUJyb2tlciB7XHJcbiAgdHJhY2U6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBzZW5kZXJJZCA9IHNlbmRlcklkO1xyXG4gIHN0YXRlID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcclxuICBzdWJzY3JpYmVycyA9IG5ldyBNYXA8c3RyaW5nLCBUSGFuZGxlcltdPigpO1xyXG4gIGJyYW9kY2FzdHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcclxuICBwcml2YXRlIF9fYmNDaGFubmVsID0gbmV3IEJyb2FkY2FzdENoYW5uZWwoXHJcbiAgICBCUk9XU0VSX01FU1NBR0VfQlJPS0VSXHJcbiAgKTtcclxuXHJcbiAgcHJpdmF0ZSBsb2coXHJcbiAgICBtZXNzYWdlOiBzdHJpbmcsXHJcbiAgICBjaGFubmVsOiBzdHJpbmcsXHJcbiAgICAuLi5kYXRhOiB1bmtub3duW11cclxuICApIHtcclxuICAgIGlmICh0aGlzLnRyYWNlIHx8IGNoYW5uZWxTZXR0aW5ncy5nZXQoY2hhbm5lbCk/LnRyYWNlKVxyXG4gICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICBgWyR7Z2xvYmFsVGhpcy5jb25zdHJ1Y3Rvci5uYW1lfSgke3RoaXMuc2VuZGVySWR9KS0ke2NoYW5uZWx9XSAke21lc3NhZ2V9YCxcclxuICAgICAgICBkYXRhXHJcbiAgICAgICk7XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMuX19iY0NoYW5uZWwub25tZXNzYWdlID1cclxuICAgICAgdGhpcy5oYW5kbGVCcm9hZGNhc3QuYmluZCh0aGlzKTtcclxuICAgIHRoaXMuX19iY0NoYW5uZWwub25tZXNzYWdlZXJyb3IgPVxyXG4gICAgICB0aGlzLmhhbmRsZUJyb2FkY2FzdEVycm9yLmJpbmQodGhpcyk7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgIHRoaXMuX19zZW5kQnJva2VyU3RhdGUodW5kZWZpbmVkLCB1bmRlZmluZWQpOyAvLyBhbHdheXMgc2VuZCBpbml0aWFsIHN5bmMgcmVxdWVzdFxyXG4gICAgfSwgMCk7XHJcblxyXG4gICAgdGhpcy5zZW5kQnJva2VyU3RhdGUgPSBkZWJvdW5jZShcclxuICAgICAgdGhpcy5fX3NlbmRCcm9rZXJTdGF0ZS5iaW5kKHRoaXMpLFxyXG4gICAgICAyXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgQ29uZmlndXJlQ2hhbm5lbChcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBicm9hZGNhc3Q6IGJvb2xlYW4sXHJcbiAgICBjYWNoZTogYm9vbGVhbixcclxuICAgIHRyYWNlOiBib29sZWFuXHJcbiAgKTogdm9pZCB7XHJcbiAgICBjaGFubmVsU2V0dGluZ3Muc2V0KGNoYW5uZWxOYW1lLCB7XHJcbiAgICAgIGJyb2FkY2FzdDogYnJvYWRjYXN0LFxyXG4gICAgICBjYWNoZTogY2FjaGUsXHJcbiAgICAgIHRyYWNlLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGNhY2hlKSB0aGlzLnN0YXRlLnNldChjaGFubmVsTmFtZSwgdW5kZWZpbmVkKTtcclxuICAgIGlmIChicm9hZGNhc3QpIHRoaXMuYnJhb2RjYXN0cy5hZGQoY2hhbm5lbE5hbWUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBoYW5kbGVCcm9hZGNhc3RFcnJvcihcclxuICAgIGV2OiBNZXNzYWdlRXZlbnQ8SUJyb2FkY2FzdEVudmVsb3BlPlxyXG4gICkge1xyXG4gICAgdGhyb3cgRXJyb3IoXCJCUk9BRENBU1QgRkFJTEVEOiBcIiArIGV2LmRhdGEpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzZW5kQnJva2VyU3RhdGU6IChcclxuICAgIHRhcmdldElkPzogc3RyaW5nLFxyXG4gICAgZmlsdGVyQnJvYWRjYXN0cz86IHN0cmluZ1tdXHJcbiAgKSA9PiB2b2lkO1xyXG4gIHByaXZhdGUgX19zZW5kQnJva2VyU3RhdGUoXHJcbiAgICB0YXJnZXRJZD86IHN0cmluZyxcclxuICAgIGZpbHRlckJyb2FkY2FzdHM/OiBzdHJpbmdbXVxyXG4gICkge1xyXG4gICAgbGV0IGN1cnJlbnRCcm9hZGNhc3RzID0gQXJyYXkuZnJvbShcclxuICAgICAgdGhpcy5icmFvZGNhc3RzLmtleXMoKVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoZmlsdGVyQnJvYWRjYXN0cyAmJiBmaWx0ZXJCcm9hZGNhc3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgY3VycmVudEJyb2FkY2FzdHMgPSBjdXJyZW50QnJvYWRjYXN0cy5maWx0ZXIoKGspID0+XHJcbiAgICAgICAgZmlsdGVyQnJvYWRjYXN0cy5pbmNsdWRlcyhrKVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGF2YWlsYWJsZVN0YXRlOiB7IFt4OiBzdHJpbmddOiBhbnkgfSA9IHt9O1xyXG4gICAgZm9yIChjb25zdCB4IG9mIHRoaXMuc3RhdGUpIHtcclxuICAgICAgaWYgKCF4WzFdKSBjb250aW51ZTtcclxuICAgICAgaWYgKCFjdXJyZW50QnJvYWRjYXN0cy5pbmNsdWRlcyh4WzBdKSkgY29udGludWU7XHJcbiAgICAgIGF2YWlsYWJsZVN0YXRlW3hbMF1dID0geFsxXTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdGF0ZTogSUJyb2tlclN0YXRlID0ge1xyXG4gICAgICBpZDogc2VuZGVySWQsXHJcbiAgICAgIGF2YWlsYWJsZVN0YXRlLFxyXG4gICAgICBicm9hZGNhc3RzOiBjdXJyZW50QnJvYWRjYXN0cyxcclxuICAgIH07XHJcblxyXG4gICAgY29uc3QgZXY6IElCcm9hZGNhc3RTeW5jRW52ZWxvcGUgPSB7XHJcbiAgICAgIGNoYW5uZWxOYW1lOiBCUk9BRENBU1RfU1lOQyxcclxuICAgICAgc2VuZGVyQ3R4OiBnbG9iYWxUaGlzLmNvbnN0cnVjdG9yLm5hbWUsXHJcbiAgICAgIHNlbmRlcklkLFxyXG4gICAgICB0YXJnZXRJZCxcclxuICAgICAgbXNnOiBzdGF0ZSxcclxuICAgICAgY2hhbm5lbFR5cGU6IFwic3luY1wiLFxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLl9fYmNDaGFubmVsLnBvc3RNZXNzYWdlKGV2KTtcclxuXHJcbiAgICBpZiAodGFyZ2V0SWQgPT0gdW5kZWZpbmVkKVxyXG4gICAgICB0aGlzLmxvZyhcIkJyb2FkY2FzdCBzeW5jIHJlcXVlc3RlZFwiLCBcIlwiLCB7XHJcbiAgICAgICAgYnJva2VyU3RhdGU6IHN0YXRlLFxyXG4gICAgICB9KTtcclxuICAgIGVsc2VcclxuICAgICAgdGhpcy5sb2coXCJCcm9hZGNhc3Qgc3luYyByZXNwb25kZWRcIiwgXCJcIiwge1xyXG4gICAgICAgIHRhcmdldElkLFxyXG4gICAgICAgIGJyb2tlclN0YXRlOiBzdGF0ZSxcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUJyb2FkY2FzdFN5bmMoZXY6IElCcm9hZGNhc3RTeW5jRW52ZWxvcGUpIHtcclxuICAgIGlmIChpc1N5bmNSZXEoZXYpKVxyXG4gICAgICByZXR1cm4gdGhpcy5zZW5kQnJva2VyU3RhdGUoXHJcbiAgICAgICAgZXYuc2VuZGVySWQsXHJcbiAgICAgICAgZXYubXNnLmJyb2FkY2FzdHNcclxuICAgICAgKTtcclxuICAgIGlmIChpc1N5bmNSZXNwKGV2KSkge1xyXG4gICAgICBmb3IgKGNvbnN0IHMgb2YgT2JqZWN0LmVudHJpZXMoXHJcbiAgICAgICAgZXYubXNnLmF2YWlsYWJsZVN0YXRlXHJcbiAgICAgICkpIHtcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICB0aGlzLmJyYW9kY2FzdHMuaGFzKHNbMF0pICYmXHJcbiAgICAgICAgICB0aGlzLnN0YXRlLmhhcyhzWzBdKSAmJlxyXG4gICAgICAgICAgdGhpcy5zdGF0ZS5nZXQoc1swXSkgPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLl9fbm90aWZ5U3Vic2NyaWJlcnMoc1swXSwgc1sxXSwgZXYuc2VuZGVySWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5sb2coXHJcbiAgICAgICAgICBcIkJyb2FkY2FzdCBzeW5jIHJlc3BvbmNlIGhhbmRsZWRcIixcclxuICAgICAgICAgIFwiXCIsXHJcbiAgICAgICAgICBldi5tc2dcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUJyb2FkY2FzdChcclxuICAgIGV2OiBNZXNzYWdlRXZlbnQ8SUJyb2FkY2FzdEVudmVsb3BlPlxyXG4gICkge1xyXG4gICAgdGhpcy5sb2coXHJcbiAgICAgIFwiQnJvYWRjYXN0IHJlY2VpdmVkXCIsXHJcbiAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWUsXHJcbiAgICAgIGV2LmRhdGFcclxuICAgICk7XHJcblxyXG4gICAgaWYgKFxyXG4gICAgICBldi5kYXRhLnRhcmdldElkICE9IHVuZGVmaW5lZCAmJlxyXG4gICAgICBldi5kYXRhLnRhcmdldElkICE9PSBzZW5kZXJJZFxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXMubG9nKFxyXG4gICAgICAgIFwiQnJvYWRjYXN0IGlnbm9yZWQgKGRpZmZlcmVudCB0YXJnZXRJZClcIixcclxuICAgICAgICBldi5kYXRhLmNoYW5uZWxOYW1lXHJcbiAgICAgICk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNCcm9hZGNhc3RTeW5jKGV2LmRhdGEpKVxyXG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVCcm9hZGNhc3RTeW5jKGV2LmRhdGEpO1xyXG5cclxuICAgIHN3aXRjaCAoZXYuZGF0YS5jaGFubmVsVHlwZSkge1xyXG4gICAgICBjYXNlIFwicHViU3ViXCI6XHJcbiAgICAgICAgdGhpcy5fX25vdGlmeVN1YnNjcmliZXJzKFxyXG4gICAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZSxcclxuICAgICAgICAgIGV2LmRhdGEubXNnLFxyXG4gICAgICAgICAgZXYuZGF0YS5zZW5kZXJJZFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgXCJyZXFcIjpcclxuICAgICAgICB0aGlzLmJyaWRnZVJlcXVlc3QoXHJcbiAgICAgICAgICBldi5kYXRhLmNoYW5uZWxOYW1lLFxyXG4gICAgICAgICAgZXYuZGF0YS5tc2csXHJcbiAgICAgICAgICBldi5kYXRhLnNlbmRlcklkXHJcbiAgICAgICAgKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBcInJlcFwiOlxyXG4gICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5nZXQoXHJcbiAgICAgICAgICBldi5kYXRhLmNoYW5uZWxOYW1lXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoIXJlcSkgcmV0dXJuO1xyXG5cclxuICAgICAgICByZXEucmVzb2x2ZShldi5kYXRhLm1zZyk7XHJcbiAgICAgICAgdGhpcy5icm9hZGNhc3RlZFJlcXVlc3RzLmRlbGV0ZShcclxuICAgICAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWVcclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmxvZyhcclxuICAgICAgXCJCcm9hZGNhc3QgaGFuZGxlZFwiLFxyXG4gICAgICBldi5kYXRhLmNoYW5uZWxOYW1lLFxyXG4gICAgICBldi5kYXRhXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQnJpZGdlIHB1Yi9zdWIgbWVzc2FnZXMgdG8gYnJvYWRjYXN0IGNoYW5uZWxcclxuICAgKiBAcGFyYW0gc3Vic0tleVxyXG4gICAqIEByZXR1cm5zIHtTdWJzY3JpcHRpb259XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfX2NvbmZpZ3VyZUJyb2FkY2FzdChcclxuICAgIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uPGFueT5cclxuICApOiB2b2lkIHtcclxuICAgIGlmICghc3Vic2NyaXB0aW9uLmNoYW5uZWxOYW1lKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzdWJzY3JpcHRpb25gKTtcclxuICAgIH1cclxuICAgIHRoaXMuYnJhb2RjYXN0cy5hZGQoc3Vic2NyaXB0aW9uLmNoYW5uZWxOYW1lKTtcclxuICAgIGNvbnN0IG9yaWdpbmFsRGlzcG9zZSA9IHN1YnNjcmlwdGlvbi5kaXNwb3NlO1xyXG4gICAgc3Vic2NyaXB0aW9uLmRpc3Bvc2UgPSAoKSA9PiB7XHJcbiAgICAgIG9yaWdpbmFsRGlzcG9zZSgpO1xyXG4gICAgICB0aGlzLmJyYW9kY2FzdHMuZGVsZXRlKHN1YnNjcmlwdGlvbi5jaGFubmVsTmFtZSk7XHJcbiAgICB9O1xyXG4gICAgc3Vic2NyaXB0aW9uLmlzQnJvYWRjYXN0ID0gdHJ1ZTtcclxuXHJcbiAgICB0aGlzLnNlbmRCcm9rZXJTdGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgR2V0U3RhdGU8VD4oc3Vic0tleTogc3RyaW5nKTogVCB8IHVuZGVmaW5lZCB7XHJcbiAgICBpZiAoc3Vic0tleSkge1xyXG4gICAgICByZXR1cm4gdGhpcy5zdGF0ZS5nZXQoc3Vic0tleSkgYXMgVDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBCcm9hZGNhc3QoXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiB1bmtub3duLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIHRoaXMuX2Jyb2FkY2FzdChjaGFubmVsTmFtZSwgbXNnLCBcInB1YlN1YlwiLCB0YXJnZXRJZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGFzeW5jIF9icm9hZGNhc3QoXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiB1bmtub3duLFxyXG4gICAgY2hhbm5lbFR5cGU6IENoYW5uZWxUeXBlLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIGNvbnN0IHNldHRpbmdzID0gY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsTmFtZSk7XHJcblxyXG4gICAgdGhpcy5sb2coXHJcbiAgICAgIGBNZXNzYWdlIGJyb2FkY2FzdGVkICgke2NoYW5uZWxUeXBlfSkgdG8gJHtcclxuICAgICAgICB0YXJnZXRJZCB8fCBcImFsbCBicm9rZXJzXCJcclxuICAgICAgfWAsXHJcbiAgICAgIGNoYW5uZWxOYW1lLFxyXG4gICAgICBtc2dcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgX21zZyA9IGF3YWl0IFByb21pc2UucmVzb2x2ZShtc2cpO1xyXG4gICAgY29uc3QgZW52ZWxvcGU6IElCcm9hZGNhc3RFbnZlbG9wZSA9IHtcclxuICAgICAgY2hhbm5lbE5hbWU6IGNoYW5uZWxOYW1lLFxyXG4gICAgICBzZW5kZXJDdHg6IGdsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZSxcclxuICAgICAgc2VuZGVySWQ6IHNlbmRlcklkLFxyXG4gICAgICB0YXJnZXRJZDogdGFyZ2V0SWQsXHJcbiAgICAgIG1zZzogX21zZyxcclxuICAgICAgY2hhbm5lbFR5cGUsXHJcbiAgICB9O1xyXG5cclxuICAgIGlmIChzZXR0aW5ncz8uY2FjaGUpIHRoaXMuc3RhdGUuc2V0KGNoYW5uZWxOYW1lLCBtc2cpO1xyXG5cclxuICAgIHRoaXMuX19iY0NoYW5uZWwucG9zdE1lc3NhZ2UoZW52ZWxvcGUpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgUHVibGlzaChcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBtc2c6IHVua25vd24sXHJcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xyXG4gICkge1xyXG4gICAgdGhpcy5sb2coYE1lc3NhZ2UgcHVibGlzaGVkYCwgY2hhbm5lbE5hbWUsIG1zZyk7XHJcbiAgICBhd2FpdCB0aGlzLl9fbm90aWZ5U3Vic2NyaWJlcnMoXHJcbiAgICAgIGNoYW5uZWxOYW1lLFxyXG4gICAgICBtc2csXHJcbiAgICAgIHNlbmRlcklkXHJcbiAgICApO1xyXG5cclxuICAgIGlmICghdGhpcy5icmFvZGNhc3RzLmhhcyhjaGFubmVsTmFtZSkpIHJldHVybjtcclxuXHJcbiAgICB0aGlzLl9icm9hZGNhc3QoY2hhbm5lbE5hbWUsIG1zZywgXCJwdWJTdWJcIiwgdGFyZ2V0SWQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfX25leHRNZXNzYWdlQXdhdGVycyA9IG5ldyBNYXA8XHJcbiAgICBzdHJpbmcsXHJcbiAgICB7XHJcbiAgICAgIHByb21pc2U6IFByb21pc2U8dW5rbm93bj47XHJcbiAgICAgIHJlc29sdmU6IChtc2c6IHVua25vd24pID0+IHVua25vd247XHJcbiAgICB9XHJcbiAgPigpO1xyXG5cclxuICBhc3luYyBuZXh0TWVzc2FnZTxUID0gdW5rbm93bj4oXHJcbiAgICBzdWJzS2V5OiBzdHJpbmdcclxuICApOiBQcm9taXNlPFQ+IHtcclxuICAgIGNvbnN0IGEgPSB0aGlzLl9fbmV4dE1lc3NhZ2VBd2F0ZXJzLmdldChzdWJzS2V5KTtcclxuICAgIGlmIChhKSByZXR1cm4gYS5wcm9taXNlIGFzIFByb21pc2U8VD47XHJcblxyXG4gICAgY29uc3QgbmV3QXdhaXRlcjoge1xyXG4gICAgICBwcm9taXNlOiBQcm9taXNlPHVua25vd24+O1xyXG4gICAgICByZXNvbHZlOiAobXNnOiB1bmtub3duKSA9PiB2b2lkO1xyXG4gICAgfSA9IHtcclxuICAgICAgcHJvbWlzZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgUHJvbWlzZTxUPixcclxuICAgICAgcmVzb2x2ZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgKFxyXG4gICAgICAgIG1zZzogdW5rbm93blxyXG4gICAgICApID0+IHZvaWQsXHJcbiAgICB9O1xyXG4gICAgbmV3QXdhaXRlci5wcm9taXNlID0gbmV3IFByb21pc2UoXHJcbiAgICAgIChyZXM6IChtc2c6IHVua25vd24pID0+IHZvaWQpID0+IHtcclxuICAgICAgICBuZXdBd2FpdGVyLnJlc29sdmUgPSByZXM7XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5zZXQoc3Vic0tleSwgbmV3QXdhaXRlcik7XHJcblxyXG4gICAgcmV0dXJuIG5ld0F3YWl0ZXIucHJvbWlzZSBhcyBQcm9taXNlPFQ+O1xyXG4gIH1cclxuXHJcbiAgU3Vic2NyaWJlPFQ+KFxyXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcclxuICAgIGhhbmRsZXI/OiBUSGFuZGxlcjxUPixcclxuICAgIGJyb2FkY2FzdCA9IGZhbHNlLFxyXG4gICAgY2FjaGUgPSB0cnVlXHJcbiAgKTogU3Vic2NyaXB0aW9uPFQ+IHtcclxuICAgIGNvbnN0IHNldHRpbmdzID0gY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsTmFtZSk7XHJcbiAgICBjb25zdCBzZXR0aW5nc092ZXJyaWRlbiA9IGZhbHNlO1xyXG4gICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgIGJyb2FkY2FzdCA9IHNldHRpbmdzLmJyb2FkY2FzdCB8fCBmYWxzZTtcclxuICAgICAgY2FjaGUgPSBzZXR0aW5ncy5jYWNoZSB8fCB0cnVlO1xyXG4gICAgICBzZXR0aW5nc092ZXJyaWRlbjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdWJzID0gdGhpcy5zdWJzY3JpYmVycy5nZXQoY2hhbm5lbE5hbWUpIHx8IFtdO1xyXG4gICAgY29uc3QgaGRsID0gaGFuZGxlciBhcyAobXNnOiB1bmtub3duKSA9PiB2b2lkO1xyXG4gICAgc3Vicy5wdXNoKGhkbCk7XHJcbiAgICB0aGlzLnN1YnNjcmliZXJzLnNldChjaGFubmVsTmFtZSwgc3Vicyk7XHJcblxyXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb248VD4gPSB7XHJcbiAgICAgIGNoYW5uZWxOYW1lOiBjaGFubmVsTmFtZSxcclxuICAgICAgaXNDYWNoZWQ6IGZhbHNlLFxyXG4gICAgICBkaXNwb3NlOiAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgX3N1YnMgPSB0aGlzLnN1YnNjcmliZXJzLmdldChjaGFubmVsTmFtZSk7XHJcblxyXG4gICAgICAgIGlmIChfc3VicyA9PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICBjb25zdCBpID0gX3N1YnMuaW5kZXhPZihoZGwpO1xyXG5cclxuICAgICAgICBpZiAoaSA9PT0gLTEpIHJldHVybjtcclxuICAgICAgICBfc3Vicy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHB1Ymxpc2g6IChtc2csIHRhcmdldElkPzogc3RyaW5nKSA9PlxyXG4gICAgICAgIHRoaXMuUHVibGlzaChjaGFubmVsTmFtZSwgbXNnLCB0YXJnZXRJZCksXHJcbiAgICAgIGlzRGlzcG9zZWQ6IGZhbHNlLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoYnJvYWRjYXN0KSB0aGlzLl9fY29uZmlndXJlQnJvYWRjYXN0KHN1YnNjcmlwdGlvbik7XHJcbiAgICBpZiAoY2FjaGUpIHRoaXMuc3RhdGUuc2V0KGNoYW5uZWxOYW1lLCB1bmRlZmluZWQpO1xyXG5cclxuICAgIHJldHVybiBzdWJzY3JpcHRpb247XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJyaWRnZVJlcXVlc3QoXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgcmVxdWVzdERhdGE6IHVua25vd24sXHJcbiAgICBzZW5kZXJJZDogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICBjb25zdCBsaXN0ZW5lciA9IHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xyXG5cclxuICAgIGlmICghbGlzdGVuZXIpIHJldHVybiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTtcclxuXHJcbiAgICByZXR1cm4gbGlzdGVuZXIuaGFuZGxlcihcclxuICAgICAgcmVxdWVzdERhdGEsXHJcbiAgICAgIHNlbmRlcklkXHJcbiAgICApIGFzIFByb21pc2U8dW5rbm93bj47XHJcbiAgfVxyXG5cclxuICBSZXF1ZXN0PFRSZXAgPSB1bmtub3duPihcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICByZXF1ZXN0RGF0YTogdW5rbm93bixcclxuICAgIGJyb2FkY2FzdCA9IGZhbHNlLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApOiBQcm9taXNlPFRSZXA+IHwgUHJvbWlzZTx1bmRlZmluZWQ+IHtcclxuICAgIGlmICghYnJvYWRjYXN0KSB7XHJcbiAgICAgIGNvbnN0IGxpc3RlbmVyID1cclxuICAgICAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuZ2V0KGNoYW5uZWxOYW1lKTtcclxuICAgICAgaWYgKCFsaXN0ZW5lcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xyXG4gICAgICByZXR1cm4gbGlzdGVuZXIuaGFuZGxlcihyZXF1ZXN0RGF0YSkgYXMgUHJvbWlzZTxUUmVwPjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2Jyb2FkY2FzdChcclxuICAgICAgICBjaGFubmVsTmFtZSxcclxuICAgICAgICByZXF1ZXN0RGF0YSxcclxuICAgICAgICBcInJlcVwiLFxyXG4gICAgICAgIHRhcmdldElkXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IHJlcSA9IHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5nZXQoY2hhbm5lbE5hbWUpO1xyXG4gICAgICBpZiAocmVxKSByZXEucmVzb2x2ZSh1bmRlZmluZWQpO1xyXG5cclxuICAgICAgbGV0IHJlc29sdmUgPSB1bmRlZmluZWQgYXMgdW5rbm93biBhcyAoXHJcbiAgICAgICAgcjogdW5rbm93blxyXG4gICAgICApID0+IHZvaWQ7XHJcbiAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZTxUUmVwPihcclxuICAgICAgICAocmVzKSA9PiAocmVzb2x2ZSA9IHJlcyBhcyAocjogdW5rbm93bikgPT4gdm9pZClcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgYnJlcSA9IHtcclxuICAgICAgICBwcm9taXNlLFxyXG4gICAgICAgIHJlc29sdmUsXHJcbiAgICAgIH07XHJcbiAgICAgIHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5zZXQoY2hhbm5lbE5hbWUsIGJyZXEpO1xyXG4gICAgICByZXR1cm4gYnJlcS5wcm9taXNlO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGJyb2FkY2FzdGVkUmVxdWVzdHMgPSBuZXcgTWFwPFxyXG4gICAgc3RyaW5nLFxyXG4gICAge1xyXG4gICAgICBwcm9taXNlOiBQcm9taXNlPHVua25vd24+O1xyXG4gICAgICByZXNvbHZlOiAocjogdW5rbm93bikgPT4gdm9pZDtcclxuICAgIH1cclxuICA+KCk7XHJcblxyXG4gIFJlcGx5PFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj4oXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgaGFuZGxlcjogKHJlcTogVFJlcSkgPT4gVFJlcCxcclxuICAgIGJyb2FkY2FzdCA9IGZhbHNlXHJcbiAgKSB7XHJcbiAgICBpZiAoYnJvYWRjYXN0KSB7XHJcbiAgICAgIGNvbnN0IG9yaWdIYW5kbGVyID0gaGFuZGxlcjtcclxuICAgICAgaGFuZGxlciA9ICgobXNnOiBUUmVxLCB0YXJnZXRJZDogc3RyaW5nKSA9PlxyXG4gICAgICAgIHRoaXMuX2Jyb2FkY2FzdChcclxuICAgICAgICAgIGNoYW5uZWxOYW1lLFxyXG4gICAgICAgICAgb3JpZ0hhbmRsZXIobXNnKSxcclxuICAgICAgICAgIFwicmVwXCIsXHJcbiAgICAgICAgICB0YXJnZXRJZFxyXG4gICAgICAgICkpIGFzIHVua25vd24gYXMgKHJlcTogVFJlcSkgPT4gVFJlcDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcUxpc3RlbmVycyA9IHRoaXMucmVxdWVzdExpc3RlbmVycztcclxuICAgIGNvbnN0IHN1YnM6IFJlcVN1YnNjcmlwdGlvbiA9IHtcclxuICAgICAgY2hhbm5lbE5hbWUsXHJcbiAgICAgIGdldCBpc0Rpc3Bvc2VkKCkge1xyXG4gICAgICAgIHJldHVybiByZXFMaXN0ZW5lcnMuaGFzKGNoYW5uZWxOYW1lKTtcclxuICAgICAgfSxcclxuICAgICAgaXNCcm9hZGNhc3Q6IGJyb2FkY2FzdCxcclxuICAgICAgaGFuZGxlcjogaGFuZGxlciBhcyAocjogdW5rbm93bikgPT4gdW5rbm93bixcclxuICAgICAgZGlzcG9zZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgKCkgPT4gdm9pZCxcclxuICAgIH07XHJcblxyXG4gICAgc3Vicy5kaXNwb3NlID0gKCkgPT4ge1xyXG4gICAgICBzdWJzLmlzRGlzcG9zZWQgPSB0cnVlO1xyXG4gICAgICBjb25zdCBjdXJyZW50TGlzdGVuZXIgPVxyXG4gICAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xyXG4gICAgICBpZiAoY3VycmVudExpc3RlbmVyID09PSBzdWJzKVxyXG4gICAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5kZWxldGUoY2hhbm5lbE5hbWUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBjdXJyZW50TGlzdGVuZXIgPVxyXG4gICAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuZ2V0KGNoYW5uZWxOYW1lKTtcclxuICAgIGlmIChjdXJyZW50TGlzdGVuZXIpIHtcclxuICAgICAgY3VycmVudExpc3RlbmVyLmlzRGlzcG9zZWQgPSB0cnVlO1xyXG4gICAgICBjb25zb2xlLndhcm4oXHJcbiAgICAgICAgXCJSZXF1ZXN0IGxpc3RlbmVyIGhhcyBiZWVuIHJlcGxhY2VkOiBcIiArIGNoYW5uZWxOYW1lXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuc2V0KGNoYW5uZWxOYW1lLCBzdWJzKTtcclxuICAgIHJldHVybiBzdWJzO1xyXG4gIH1cclxuXHJcbiAgcmVxdWVzdExpc3RlbmVycyA9IG5ldyBNYXA8c3RyaW5nLCBSZXFTdWJzY3JpcHRpb24+KCk7XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgX19ub3RpZnlTdWJzY3JpYmVycyhcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBtc2c6IHVua25vd24sXHJcbiAgICBzSWQ6IHN0cmluZ1xyXG4gICkge1xyXG4gICAgY29uc3QgaGFuZGxlcnMgPVxyXG4gICAgICB0aGlzLnN1YnNjcmliZXJzLmdldChjaGFubmVsTmFtZSkgfHwgW107XHJcblxyXG4gICAgY29uc3QgYWxsU3Vic2NyaWJlcnNQcm9taXNlczogUHJvbWlzZTx2b2lkPltdID0gW107XHJcbiAgICBmb3IgKGNvbnN0IGggb2YgaGFuZGxlcnMpIHtcclxuICAgICAgaWYgKCFoKSBjb250aW51ZTtcclxuICAgICAgYWxsU3Vic2NyaWJlcnNQcm9taXNlcy5wdXNoKFxyXG4gICAgICAgIFByb21pc2UucmVzb2x2ZShoKG1zZywgc0lkKSlcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5sb2coXCJIYW5kbGVyIGNhbGxlZFwiLCBjaGFubmVsTmFtZSwgaCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoYWxsU3Vic2NyaWJlcnNQcm9taXNlcyk7XHJcblxyXG4gICAgaWYgKGNoYW5uZWxTZXR0aW5ncy5nZXQoY2hhbm5lbE5hbWUpPy5jYWNoZSlcclxuICAgICAgdGhpcy5zdGF0ZS5zZXQoY2hhbm5lbE5hbWUsIG1zZyk7XHJcblxyXG4gICAgdGhpcy5fX2hhbmRsZUF3YWl0ZXIoY2hhbm5lbE5hbWUsIG1zZyk7XHJcblxyXG4gICAgdGhpcy5sb2coXCJNZXNzYWdlIGhhbmRsZWRcIiwgY2hhbm5lbE5hbWUsIG1zZywgdGhpcyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9faGFuZGxlQXdhaXRlcihzdWJzS2V5OiBzdHJpbmcsIG1zZzogdW5rbm93bikge1xyXG4gICAgY29uc3QgYXdhaXRlciA9IHRoaXMuX19uZXh0TWVzc2FnZUF3YXRlcnMuZ2V0KHN1YnNLZXkpO1xyXG4gICAgaWYgKCFhd2FpdGVyKSByZXR1cm47XHJcblxyXG4gICAgYXdhaXRlci5yZXNvbHZlKG1zZyk7XHJcblxyXG4gICAgdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5kZWxldGUoc3Vic0tleSk7XHJcbiAgfVxyXG59XHJcblxyXG5nbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyID1cclxuICBnbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyIHx8IG5ldyBCcm9rZXIoKTtcclxuXHJcbmV4cG9ydCBjb25zdCBCTUIgPSBnbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyO1xyXG5leHBvcnQgKiBmcm9tIFwiLi9QdWJTdWJDaGFubmVsXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL1JlcVJlcENoYW5uZWxcIjtcclxuIiwgImltcG9ydCB7IEJNQiB9IGZyb20gXCIuL0Jyb2tlclwiO1xyXG5pbXBvcnQge1xyXG4gIERpc3Bvc2VyLFxyXG4gIENoYW5uZWxTZXR0aW5ncyxcclxuICBJUHViU3ViQ2hhbm5lbCxcclxuICBUSGFuZGxlcixcclxufSBmcm9tIFwiLi9UeXBlc1wiO1xyXG5cclxuY29uc3QgcHViU3ViQ2hhbm5lbHMgPSBuZXcgTWFwPHN0cmluZywgUHViU3ViQ2hhbm5lbD4oKTtcclxuXHJcbmV4cG9ydCBjbGFzcyBQdWJTdWJDaGFubmVsPFRNc2cgPSBhbnk+XHJcbiAgaW1wbGVtZW50cyBJUHViU3ViQ2hhbm5lbDxUTXNnPlxyXG57XHJcbiAgc3RhdGljIGZvcjxUTXNnPihcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHNldHRpbmdzPzogQ2hhbm5lbFNldHRpbmdzXHJcbiAgKTogUHViU3ViQ2hhbm5lbDxUTXNnPiB7XHJcbiAgICBpZiAoIXNldHRpbmdzKSB7XHJcbiAgICAgIGNvbnN0IGMgPSBwdWJTdWJDaGFubmVscy5nZXQobmFtZSk7XHJcbiAgICAgIGlmICghYykgdGhyb3cgRXJyb3IoXCJDYW4ndCBmaW5kIGNoYW5uZWwgc2V0dGluZ3NcIik7XHJcbiAgICAgIHJldHVybiBjIGFzIFB1YlN1YkNoYW5uZWw8VE1zZz47XHJcbiAgICB9XHJcblxyXG4gICAgQk1CLkNvbmZpZ3VyZUNoYW5uZWwoXHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIHNldHRpbmdzLmJyb2FkY2FzdCB8fCBmYWxzZSxcclxuICAgICAgc2V0dGluZ3MuY2FjaGUgfHwgZmFsc2UsXHJcbiAgICAgIHNldHRpbmdzLnRyYWNlIHx8IGZhbHNlXHJcbiAgICApO1xyXG4gICAgY29uc3QgY2hhbm5lbCA9IG5ldyBQdWJTdWJDaGFubmVsPFRNc2c+KG5hbWUsIHNldHRpbmdzKTtcclxuICAgIHB1YlN1YkNoYW5uZWxzLnNldChuYW1lLCBjaGFubmVsKTtcclxuICAgIHJldHVybiBjaGFubmVsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3NcclxuICApIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgfVxyXG5cclxuICBhc3luYyBzZW5kKG1zZzogVE1zZywgdGFyZ2V0SWQ/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIEJNQi5QdWJsaXNoKHRoaXMubmFtZSwgbXNnLCB0YXJnZXRJZCk7XHJcbiAgfVxyXG4gIHN0YXRpYyBhc3luYyBwdWJsaXNoPFRNc2cgPSBhbnk+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiBUTXNnLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIEJNQi5QdWJsaXNoKG5hbWUsIG1zZywgdGFyZ2V0SWQpO1xyXG4gIH1cclxuICBzdGF0aWMgYXN5bmMgYnJvYWRjYXN0PFRNc2cgPSBhbnk+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiBUTXNnLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIEJNQi5Ccm9hZGNhc3Q8VE1zZz4obmFtZSwgbXNnLCB0YXJnZXRJZCk7XHJcbiAgfVxyXG5cclxuICBzdWJzY3JpYmUoaGFuZGxlcjogVEhhbmRsZXI8VE1zZz4pOiBEaXNwb3NlciB7XHJcbiAgICBjb25zdCBzID0gQk1CLlN1YnNjcmliZShcclxuICAgICAgdGhpcy5uYW1lLFxyXG4gICAgICBoYW5kbGVyLFxyXG4gICAgICB0aGlzLnNldHRpbmdzLmJyb2FkY2FzdCxcclxuICAgICAgdGhpcy5zZXR0aW5ncy5jYWNoZVxyXG4gICAgKTtcclxuICAgIHJldHVybiBzLmRpc3Bvc2U7XHJcbiAgfVxyXG5cclxuICBnZXRTdGF0ZSgpOiBUTXNnIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiBCTUIuR2V0U3RhdGUodGhpcy5uYW1lKTtcclxuICB9XHJcbiAgc3RhdGljIEdldFN0YXRlPFRNc2c+KG5hbWU6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIEJNQi5HZXRTdGF0ZTxUTXNnPihuYW1lKTtcclxuICB9XHJcblxyXG4gIG5leHRNZXNzYWdlKCk6IFByb21pc2U8VE1zZz4ge1xyXG4gICAgcmV0dXJuIEJNQi5uZXh0TWVzc2FnZSh0aGlzLm5hbWUpO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIG5leHRNZXNzYWdlPFRNc2c+KG5hbWU6IHN0cmluZyk6IFByb21pc2U8VE1zZz4ge1xyXG4gICAgcmV0dXJuIEJNQi5uZXh0TWVzc2FnZShuYW1lKTtcclxuICB9XHJcblxyXG4gIHJlYWRvbmx5IHR5cGUgPSBcInB1YlN1YlwiO1xyXG4gIHJlYWRvbmx5IGRpc3Bvc2UgPSAoKSA9PiB7XHJcbiAgICBCTUIuc3Vic2NyaWJlcnMuZGVsZXRlKHRoaXMubmFtZSk7XHJcbiAgICBwdWJTdWJDaGFubmVscy5kZWxldGUodGhpcy5uYW1lKTtcclxuICB9O1xyXG5cclxuICByZWFkb25seSBuYW1lOiBzdHJpbmcgPSBcIlwiO1xyXG4gIHJlYWRvbmx5IHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3MgPSB7fTtcclxufVxyXG4iLCAiZXhwb3J0IGNvbnN0IFBVQl9TVUJfUkVRVUVTVF9TVUJTQ1JJUFRJT05fS0VZID0gXCJ0ZXN0UmVxXCI7XHJcbmV4cG9ydCBjb25zdCBQVUJfU1VCX1JFU1BPTlNFX1NVQlNDUklQVElPTl9LRVkgPSBcInRlc3RSZXNwXCI7XHJcbmV4cG9ydCBjb25zdCBSRVFfUkVQX0NIQU5ORUxfTkFNRSA9IFwicmVxUmVwQ2hhbm5lbFwiO1xyXG4iLCAiaW1wb3J0IHtcclxuICBQdWJTdWJDaGFubmVsLFxyXG4gIFJlcVJlcENoYW5uZWwsXHJcbn0gZnJvbSBcImJyb3dzZXItbWVzc2FnZS1icm9rZXJcIjtcclxuaW1wb3J0IHtcclxuICBQVUJfU1VCX1JFUVVFU1RfU1VCU0NSSVBUSU9OX0tFWSxcclxuICBQVUJfU1VCX1JFU1BPTlNFX1NVQlNDUklQVElPTl9LRVksXHJcbiAgUkVRX1JFUF9DSEFOTkVMX05BTUUsXHJcbn0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XHJcblxyXG5QdWJTdWJDaGFubmVsLmZvcihQVUJfU1VCX1JFUVVFU1RfU1VCU0NSSVBUSU9OX0tFWSwge1xyXG4gIGJyb2FkY2FzdDogdHJ1ZSxcclxufSkuc3Vic2NyaWJlKChfKSA9PiB7XHJcbiAgUHViU3ViQ2hhbm5lbC5icm9hZGNhc3QoXHJcbiAgICBQVUJfU1VCX1JFU1BPTlNFX1NVQlNDUklQVElPTl9LRVksXHJcbiAgICB7IHBheWxvYWQ6IFwicmVzcG9uc2VcIiB9XHJcbiAgKTtcclxufSk7XHJcblxyXG5SZXFSZXBDaGFubmVsLmZvcjx7IHBheWxvYWQ6IHN0cmluZyB9LCB7IHBheWxvYWQ6IHN0cmluZyB9PihcclxuICBSRVFfUkVQX0NIQU5ORUxfTkFNRSxcclxuICB7XHJcbiAgICBicm9hZGNhc3Q6IHRydWUsXHJcbiAgfVxyXG4pLnJlcGx5KChyZXEpID0+IHtcclxuICByZXR1cm4geyBwYXlsb2FkOiByZXEucGF5bG9hZCArIFwicmVzcG9uc2VcIiB9O1xyXG59KTtcclxuXHJcbi8vbGV0IHdpbmRvdyBrbm93IHRoYXQgd29ya2VyIGlzIHJlYWR5IGFuZCBleGVjdXRlIHRlc3RcclxucG9zdE1lc3NhZ2UoXCJyZWFkeVwiKTtcclxuIl0sCiAgIm1hcHBpbmdzIjogIjs7O0FBR0EsSUFBTSxJQUFpQixvQkFBSTtBQUEzQixJQUVhLElBQU4sTUFFUDtFQW1EVSxZQUNOLEdBQ0EsR0FDQTtBQXJDRixTQUFTLE9BQWlCO0FBRTFCLFNBQUEsV0FBNEIsQ0FBQztBQU83QixTQUFTLE9BQWU7QUE2QnRCLFNBQUssT0FBTyxHQUNaLEtBQUssV0FBVztFQUNsQjtFQXhEQSxNQUFNLFFBQVEsR0FBdUM7QUFDbkQsV0FBTyxFQUFJLFFBQ1QsS0FBSyxNQUNMLEdBQ0EsS0FBSyxTQUFTLFNBQ2hCO0VBQ0Y7RUFFQSxNQUFNLEdBQThDO0FBQ2xELFdBQU8sRUFBSSxNQUNULEtBQUssTUFDTCxHQUNBLEtBQUssU0FBUyxTQUNoQixFQUFFO0VBQ0o7RUFNQSxVQUFVO0FBQ1IsTUFBSSxpQkFBaUIsT0FBTyxLQUFLLElBQUksR0FDckMsRUFBZSxPQUFPLEtBQUssSUFBSTtFQUNqQztFQUlBLE9BQU8sSUFDTCxHQUNBLEdBQzJCO0FBQzNCLFFBQUksQ0FBQyxHQUFVO0FBQ2IsVUFBTSxJQUFJLEVBQWUsSUFBSSxDQUFJO0FBQ2pDLFVBQUksQ0FBQztBQUFHLGNBQU0sTUFBTSw2QkFBNkI7QUFDakQsYUFBTztJQUNUO0FB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QUFDLEdBQVU7QUFDYixVQUFNLElBQUksRUFBZSxJQUFJLENBQUk7QUFDakMsVUFBSSxDQUFDO0FBQUcsY0FBTSxNQUFNLDZCQUE2QjtBQUNqRCxhQUFPO0lBQ1Q7QUFFQSxNQUFJLGlCQUNGLEdBQ0EsRUFBUyxhQUFhLE9BQ3RCLEVBQVMsU0FBUyxPQUNsQixFQUFTLFNBQVMsS0FDcEI7QUFDQSxRQUFNLElBQVUsSUFBSSxFQUFvQixHQUFNLENBQVE7QUFDdEQsV0FBQSxFQUFlLElBQUksR0FBTSxDQUFPLEdBQ3pCO0VBQ1Q7RUFVQSxNQUFNLEtBQUssR0FBVyxHQUFrQztBQUN0RCxNQUFJLFFBQVEsS0FBSyxNQUFNLEdBQUssQ0FBUTtFQUN0QztFQUNBLGFBQWEsUUFDWCxHQUNBLEdBQ0EsR0FDQTtBQUNBLE1BQUksUUFBUSxHQUFNLEdBQUssQ0FBUTtFQUNqQztFQUNBLGFBQWEsVUFDWCxHQUNBLEdBQ0EsR0FDQTtBQUNBLE1BQUksVUFBZ0IsR0FBTSxHQUFLLENBQVE7RUFDekM7RUFFQSxVQUFVLEdBQW1DO0FBTzNDLFdBTlUsRUFBSSxVQUNaLEtBQUssTUFDTCxHQUNBLEtBQUssU0FBUyxXQUNkLEtBQUssU0FBUyxLQUNoQixFQUNTO0VBQ1g7RUFFQSxXQUE2QjtBQUMzQixXQUFPLEVBQUksU0FBUyxLQUFLLElBQUk7RUFDL0I7RUFDQSxPQUFPLFNBQWUsR0FBYztBQUNsQyxXQUFPLEVBQUksU0FBZSxDQUFJO0VBQ2hDO0VBRUEsY0FBNkI7QUFDM0IsV0FBTyxFQUFJLFlBQVksS0FBSyxJQUFJO0VBQ2xDO0VBRUEsT0FBTyxZQUFrQixHQUE2QjtBQUNwRCxXQUFPLEVBQUksWUFBWSxDQUFJO0VBQzdCO0FBVUY7OztBQzdGTyxJQUFNLG1DQUFtQztBQUN6QyxJQUFNLG9DQUFvQztBQUMxQyxJQUFNLHVCQUF1Qjs7O0FDUXBDLEVBQWMsSUFBSSxrQ0FBa0M7QUFBQSxFQUNsRCxXQUFXO0FBQ2IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxNQUFNO0FBQ2xCLElBQWMsVUFDWixtQ0FDQSxFQUFFLFNBQVMsV0FBVyxDQUN4QjtBQUNGLENBQUM7QUFFRCxFQUFjLElBQ1osc0JBQ0E7QUFBQSxFQUNFLFdBQVc7QUFDYixDQUNGLEVBQUUsTUFBTSxDQUFDLFFBQVE7QUFDZixTQUFPLEVBQUUsU0FBUyxJQUFJLFVBQVUsV0FBVztBQUM3QyxDQUFDO0FBR0QsWUFBWSxPQUFPOyIsCiAgIm5hbWVzIjogW10KfQo=
