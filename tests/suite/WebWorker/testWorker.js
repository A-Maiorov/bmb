// ../browser-message-broker/dist/Module.js
var T = /* @__PURE__ */ new Map();
var p = class {
  constructor(e, s) {
    this.type = "reqRep";
    this.settings = {};
    this.name = "";
    this.name = e, this.settings = s;
  }
  async request(e) {
    return i.Request(this.name, e, this.settings.enableBroadcast);
  }
  reply(e) {
    return i.Reply(this.name, e, this.settings.enableBroadcast).dispose;
  }
  dispose() {
    i.requestListeners.delete(this.name), T.delete(this.name);
  }
  static getOrCreate(e, s) {
    if (!s) {
      let n = T.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.enableBroadcast || false, s.enableCaching || false, s.trace || false);
    let t = new p(e, s);
    return T.set(e, t), t;
  }
};
var S = "broadcast-sync";
var R = "browser-message-broker";
function B(d) {
  return d.channelName === S;
}
function k(d) {
  return d.senderId != null && d.targetId == null;
}
function q(d) {
  return d.senderId != null && d.targetId != null;
}
var g = Math.random().toString(36).substring(2, 9);
function M(d, e = 1) {
  let s;
  return (...t) => {
    clearTimeout(s), s = setTimeout(() => {
      d(...t);
    }, e);
  };
}
var b = /* @__PURE__ */ new Map();
var w = class {
  constructor() {
    this.trace = false;
    this.senderId = g;
    this.state = /* @__PURE__ */ new Map();
    this.subscribers = /* @__PURE__ */ new Map();
    this.braodcasts = /* @__PURE__ */ new Set();
    this.__bcChannel = new BroadcastChannel(R);
    this.__nextMessageAwaters = /* @__PURE__ */ new Map();
    this.broadcastedRequests = /* @__PURE__ */ new Map();
    this.requestListeners = /* @__PURE__ */ new Map();
    this.__bcChannel.onmessage = this.handleBroadcast.bind(this), this.__bcChannel.onmessageerror = this.handleBroadcastError.bind(this), setTimeout(() => {
      this.__sendBrokerState(void 0, void 0);
    }, 0), this.sendBrokerState = M(this.__sendBrokerState.bind(this), 2);
  }
  log(e, s, ...t) {
    (this.trace || b.get(s)?.trace) && console.log(`[${globalThis.constructor.name}(${this.senderId})-${s}] ${e}`, t);
  }
  ConfigureChannel(e, s, t, n) {
    b.set(e, { enableBroadcast: s, enableCaching: t, trace: n }), t && this.state.set(e, void 0), s && this.braodcasts.add(e);
  }
  handleBroadcastError(e) {
    throw Error("BROADCAST FAILED: " + e.data);
  }
  __sendBrokerState(e, s) {
    let t = Array.from(this.braodcasts.keys());
    s && s.length > 0 && (t = t.filter((o) => s.includes(o)));
    let n = {};
    for (let o of this.state)
      !o[1] || !t.includes(o[0]) || (n[o[0]] = o[1]);
    let r = { id: g, availableState: n, broadcasts: t }, a = { channelName: S, senderCtx: globalThis.constructor.name, senderId: g, targetId: e, msg: r, channelType: "sync" };
    this.__bcChannel.postMessage(a), e == null ? this.log("Broadcast sync requested", "", { brokerState: r }) : this.log("Broadcast sync responded", "", { targetId: e, brokerState: r });
  }
  handleBroadcastSync(e) {
    if (k(e))
      return this.sendBrokerState(e.senderId, e.msg.broadcasts);
    if (q(e))
      for (let s of Object.entries(e.msg.availableState))
        this.braodcasts.has(s[0]) && this.state.has(s[0]) && this.state.get(s[0]) == null && this.__notifySubscribers(s[0], s[1], e.senderId), this.log("Broadcast sync responce handled", "", e.msg);
  }
  handleBroadcast(e) {
    if (this.log("Broadcast received", e.data.channelName, e.data), e.data.targetId != null && e.data.targetId !== g) {
      this.log("Broadcast ignored (different targetId)", e.data.channelName);
      return;
    }
    if (B(e.data))
      return this.handleBroadcastSync(e.data);
    switch (e.data.channelType) {
      case "pubSub":
        this.__notifySubscribers(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "req":
        this.bridgeRequest(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "rep":
        let s = this.broadcastedRequests.get(e.data.channelName);
        if (!s)
          return;
        s.resolve(e.data.msg), this.broadcastedRequests.delete(e.data.channelName);
        break;
    }
    this.log("Broadcast handled", e.data.channelName, e.data);
  }
  __configureBroadcast(e) {
    if (!e.channelName)
      throw new Error("Invalid subscription");
    this.braodcasts.add(e.channelName);
    let s = e.dispose;
    e.dispose = () => {
      s(), this.braodcasts.delete(e.channelName);
    }, e.isBroadcast = true, this.sendBrokerState();
  }
  GetState(e) {
    if (e)
      return this.state.get(e);
  }
  async Broadcast(e, s, t) {
    this._broadcast(e, s, "pubSub", t);
  }
  async _broadcast(e, s, t, n) {
    let r = b.get(e);
    this.log(`Message broadcasted (${t}) to ${n || "all brokers"}`, e, s);
    let a = await Promise.resolve(s), o = { channelName: e, senderCtx: globalThis.constructor.name, senderId: g, targetId: n, msg: a, channelType: t };
    r?.enableCaching && this.state.set(e, s), this.__bcChannel.postMessage(o);
  }
  async Publish(e, s, t) {
    this.log("Message published", e, s), await this.__notifySubscribers(e, s, g), this.braodcasts.has(e) && this._broadcast(e, s, "pubSub", t);
  }
  async nextMessage(e) {
    let s = this.__nextMessageAwaters.get(e);
    if (s)
      return s.promise;
    let t = { promise: void 0, resolve: void 0 };
    return t.promise = new Promise((n) => {
      t.resolve = n;
    }), this.__nextMessageAwaters.set(e, t), t.promise;
  }
  Subscribe(e, s, t = false, n = true) {
    let r = b.get(e), a = false;
    r && (t = r.enableBroadcast || false, n = r.enableCaching || true);
    let o = this.subscribers.get(e) || [], c = s;
    o.push(c), this.subscribers.set(e, o);
    let u = { channelName: e, isCached: false, dispose: () => {
      let l = this.subscribers.get(e);
      if (l == null)
        return;
      let h = l.indexOf(c);
      h !== -1 && l.splice(h, 1);
    }, publish: (l, h) => this.Publish(e, l, h), isDisposed: false };
    return t && this.__configureBroadcast(u), n && this.state.set(e, void 0), u;
  }
  bridgeRequest(e, s, t) {
    let n = this.requestListeners.get(e);
    return n ? n.handler(s, t) : Promise.resolve(void 0);
  }
  Request(e, s, t = false, n) {
    if (t) {
      this._broadcast(e, s, "req", n);
      let r = this.broadcastedRequests.get(e);
      r && r.resolve(void 0);
      let a, c = { promise: new Promise((u) => a = u), resolve: a };
      return this.broadcastedRequests.set(e, c), c.promise;
    } else {
      let r = this.requestListeners.get(e);
      return r ? r.handler(s) : Promise.resolve(void 0);
    }
  }
  Reply(e, s, t = false) {
    if (t) {
      let o = s;
      s = (c, u) => this._broadcast(e, o(c), "rep", u);
    }
    let n = this.requestListeners, r = { channelName: e, get isDisposed() {
      return n.has(e);
    }, isBroadcast: t, handler: s, dispose: void 0 };
    r.dispose = () => {
      r.isDisposed = true, this.requestListeners.get(e) === r && this.requestListeners.delete(e);
    };
    let a = this.requestListeners.get(e);
    return a && (a.isDisposed = true, console.warn("Request listener has been replaced: " + e)), this.requestListeners.set(e, r), r;
  }
  async __notifySubscribers(e, s, t) {
    let n = this.subscribers.get(e) || [], r = [];
    for (let a of n)
      !a || (r.push(Promise.resolve(a(s, t))), this.log("Handler called", e, a));
    await Promise.all(r), this.state.has(e) && this.state.set(e, s), this.__handleAwaiter(e, s), this.log("Message handled", e, s, this);
  }
  __handleAwaiter(e, s) {
    let t = this.__nextMessageAwaters.get(e);
    !t || (t.resolve(s), this.__nextMessageAwaters.delete(e));
  }
};
globalThis.BrowserMessageBroker = globalThis.BrowserMessageBroker || new w();
var i = globalThis.BrowserMessageBroker;
var m = /* @__PURE__ */ new Map();
var f = class {
  constructor(e, s) {
    this.type = "pubSub";
    this.dispose = () => {
      i.subscribers.delete(this.name), m.delete(this.name);
    };
    this.name = "";
    this.settings = {};
    this.name = e, this.settings = s;
  }
  static getOrCreate(e, s) {
    if (!s) {
      let n = m.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.enableBroadcast || false, s.enableCaching || false, s.trace || false);
    let t = new f(e, s);
    return m.set(e, t), t;
  }
  async send(e, s) {
    i.Publish(this.name, e, s);
  }
  static async publish(e, s, t) {
    i.Publish(e, s, t);
  }
  static async broadcast(e, s, t) {
    i.Broadcast(e, s, t);
  }
  subscribe(e) {
    return i.Subscribe(this.name, e, this.settings.enableBroadcast, this.settings.enableCaching).dispose;
  }
  getState() {
    return i.GetState(this.name);
  }
  static GetState(e) {
    return i.GetState(e);
  }
  nextMessage() {
    return i.nextMessage(this.name);
  }
  static nextMessage(e) {
    return i.nextMessage(e);
  }
};

// suite/WebWorker/constants.ts
var PUB_SUB_REQUEST_SUBSCRIPTION_KEY = "testReq";
var PUB_SUB_RESPONSE_SUBSCRIPTION_KEY = "testResp";
var REQ_REP_CHANNEL_NAME = "reqRepChannel";

// suite/WebWorker/testWorker.ts
f.getOrCreate(PUB_SUB_REQUEST_SUBSCRIPTION_KEY, {
  enableBroadcast: true
}).subscribe((_) => {
  f.broadcast(PUB_SUB_RESPONSE_SUBSCRIPTION_KEY, { payload: "response" });
});
p.getOrCreate(REQ_REP_CHANNEL_NAME, {
  enableBroadcast: true
}).reply((req) => {
  return { payload: req.payload + "response" };
});
postMessage("ready");
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUmVxUmVwQ2hhbm5lbC50cyIsICIuLi8uLi8uLi9icm93c2VyLW1lc3NhZ2UtYnJva2VyL3NyYy9Ccm9rZXIudHMiLCAiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUHViU3ViQ2hhbm5lbC50cyIsICJjb25zdGFudHMudHMiLCAidGVzdFdvcmtlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XHJcbmltcG9ydCB7IENoYW5uZWxTZXR0aW5ncywgSVJlcVJlcENoYW5uZWwgfSBmcm9tIFwiLi9UeXBlc1wiO1xyXG5cclxuY29uc3QgcmVxUmVwQ2hhbm5lbHMgPSBuZXcgTWFwPHN0cmluZywgUmVxUmVwQ2hhbm5lbD4oKTtcclxuXHJcbmV4cG9ydCBjbGFzcyBSZXFSZXBDaGFubmVsPFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj5cclxuICBpbXBsZW1lbnRzIElSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+XHJcbntcclxuICBhc3luYyByZXF1ZXN0KG1zZzogVFJlcSk6IFByb21pc2U8VFJlcCB8IHVuZGVmaW5lZD4ge1xyXG4gICAgcmV0dXJuIEJNQi5SZXF1ZXN0PFRSZXA+KFxyXG4gICAgICB0aGlzLm5hbWUsXHJcbiAgICAgIG1zZyxcclxuICAgICAgdGhpcy5zZXR0aW5ncy5lbmFibGVCcm9hZGNhc3RcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICByZXBseShoYW5kbGVyOiAocmVxOiBUUmVxKSA9PiBUUmVwKSB7XHJcbiAgICByZXR1cm4gQk1CLlJlcGx5PFRSZXEsIFRSZXA+KFxyXG4gICAgICB0aGlzLm5hbWUsXHJcbiAgICAgIGhhbmRsZXIsXHJcbiAgICAgIHRoaXMuc2V0dGluZ3MuZW5hYmxlQnJvYWRjYXN0XHJcbiAgICApLmRpc3Bvc2U7XHJcbiAgfVxyXG5cclxuICByZWFkb25seSB0eXBlOiBcInJlcVJlcFwiID0gXCJyZXFSZXBcIjtcclxuXHJcbiAgc2V0dGluZ3M6IENoYW5uZWxTZXR0aW5ncyA9IHt9O1xyXG5cclxuICBkaXNwb3NlKCkge1xyXG4gICAgQk1CLnJlcXVlc3RMaXN0ZW5lcnMuZGVsZXRlKHRoaXMubmFtZSk7XHJcbiAgICByZXFSZXBDaGFubmVscy5kZWxldGUodGhpcy5uYW1lKTtcclxuICB9XHJcblxyXG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gIHN0YXRpYyBnZXRPckNyZWF0ZTxUUmVxID0gdW5rbm93biwgVFJlcCA9IHVua25vd24+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgc2V0dGluZ3M/OiBDaGFubmVsU2V0dGluZ3NcclxuICApOiBSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+IHtcclxuICAgIGlmICghc2V0dGluZ3MpIHtcclxuICAgICAgY29uc3QgYyA9IHJlcVJlcENoYW5uZWxzLmdldChuYW1lKTtcclxuICAgICAgaWYgKCFjKSB0aHJvdyBFcnJvcihcIkNhbid0IGZpbmQgY2hhbm5lbCBzZXR0aW5nc1wiKTtcclxuICAgICAgcmV0dXJuIGMgYXMgUmVxUmVwQ2hhbm5lbDxUUmVxLCBUUmVwPjtcclxuICAgIH1cclxuXHJcbiAgICBCTUIuQ29uZmlndXJlQ2hhbm5lbChcclxuICAgICAgbmFtZSxcclxuICAgICAgc2V0dGluZ3MuZW5hYmxlQnJvYWRjYXN0IHx8IGZhbHNlLFxyXG4gICAgICBzZXR0aW5ncy5lbmFibGVDYWNoaW5nIHx8IGZhbHNlLFxyXG4gICAgICBzZXR0aW5ncy50cmFjZSB8fCBmYWxzZVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGNoYW5uZWwgPSBuZXcgUmVxUmVwQ2hhbm5lbDxUUmVxLCBUUmVwPihcclxuICAgICAgbmFtZSxcclxuICAgICAgc2V0dGluZ3NcclxuICAgICk7XHJcbiAgICByZXFSZXBDaGFubmVscy5zZXQobmFtZSwgY2hhbm5lbCk7XHJcbiAgICByZXR1cm4gY2hhbm5lbDtcclxuICB9XHJcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3NcclxuICApIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgfVxyXG59XHJcbiIsICJpbXBvcnQge1xyXG4gIENoYW5uZWxUeXBlLFxyXG4gIElCcm9hZGNhc3RFbnZlbG9wZSxcclxuICBJQnJvYWRjYXN0U3luY0VudmVsb3BlLFxyXG4gIElCcm9rZXIsXHJcbiAgSUJyb2tlclN0YXRlLFxyXG4gIENoYW5uZWxTZXR0aW5ncyxcclxuICBSZXFTdWJzY3JpcHRpb24sXHJcbiAgU3Vic2NyaXB0aW9uLFxyXG4gIFRIYW5kbGVyLFxyXG59IGZyb20gXCIuL1R5cGVzXCI7XHJcblxyXG5jb25zdCBCUk9BRENBU1RfU1lOQyA9IFwiYnJvYWRjYXN0LXN5bmNcIjtcclxuY29uc3QgQlJPV1NFUl9NRVNTQUdFX0JST0tFUiA9IFwiYnJvd3Nlci1tZXNzYWdlLWJyb2tlclwiO1xyXG5cclxuZnVuY3Rpb24gaXNCcm9hZGNhc3RTeW5jKFxyXG4gIGU6IElCcm9hZGNhc3RFbnZlbG9wZVxyXG4pOiBlIGlzIElCcm9hZGNhc3RTeW5jRW52ZWxvcGUge1xyXG4gIHJldHVybiBlLmNoYW5uZWxOYW1lID09PSBCUk9BRENBU1RfU1lOQztcclxufVxyXG5cclxuZnVuY3Rpb24gaXNTeW5jUmVxKGU6IElCcm9hZGNhc3RFbnZlbG9wZSkge1xyXG4gIHJldHVybiBlLnNlbmRlcklkICE9IHVuZGVmaW5lZCAmJiBlLnRhcmdldElkID09IHVuZGVmaW5lZDtcclxufVxyXG5mdW5jdGlvbiBpc1N5bmNSZXNwKGU6IElCcm9hZGNhc3RFbnZlbG9wZSkge1xyXG4gIHJldHVybiBlLnNlbmRlcklkICE9IHVuZGVmaW5lZCAmJiBlLnRhcmdldElkICE9IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHNlbmRlcklkID0gTWF0aC5yYW5kb20oKVxyXG4gIC50b1N0cmluZygzNilcclxuICAuc3Vic3RyaW5nKDIsIDkpO1xyXG5cclxuZnVuY3Rpb24gZGVib3VuY2U8VCBleHRlbmRzIEZ1bmN0aW9uPihcclxuICBmdW5jOiBULFxyXG4gIHRpbWVvdXQgPSAxXHJcbikge1xyXG4gIGxldCB0aW1lcjogbnVtYmVyO1xyXG4gIHJldHVybiAoLi4uYXJnczogdW5rbm93bltdKSA9PiB7XHJcbiAgICBjbGVhclRpbWVvdXQodGltZXIpO1xyXG4gICAgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgZnVuYyguLi5hcmdzKTtcclxuICAgIH0sIHRpbWVvdXQpO1xyXG4gIH07XHJcbn1cclxuXHJcbmNvbnN0IGNoYW5uZWxTZXR0aW5ncyA9IG5ldyBNYXA8c3RyaW5nLCBDaGFubmVsU2V0dGluZ3M+KCk7XHJcblxyXG5jbGFzcyBCcm9rZXIgaW1wbGVtZW50cyBJQnJva2VyIHtcclxuICB0cmFjZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gIHNlbmRlcklkID0gc2VuZGVySWQ7XHJcbiAgc3RhdGUgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xyXG4gIHN1YnNjcmliZXJzID0gbmV3IE1hcDxzdHJpbmcsIFRIYW5kbGVyW10+KCk7XHJcbiAgYnJhb2RjYXN0cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xyXG4gIHByaXZhdGUgX19iY0NoYW5uZWwgPSBuZXcgQnJvYWRjYXN0Q2hhbm5lbChcclxuICAgIEJST1dTRVJfTUVTU0FHRV9CUk9LRVJcclxuICApO1xyXG5cclxuICBwcml2YXRlIGxvZyhcclxuICAgIG1lc3NhZ2U6IHN0cmluZyxcclxuICAgIGNoYW5uZWw6IHN0cmluZyxcclxuICAgIC4uLmRhdGE6IHVua25vd25bXVxyXG4gICkge1xyXG4gICAgaWYgKHRoaXMudHJhY2UgfHwgY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsKT8udHJhY2UpXHJcbiAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgIGBbJHtnbG9iYWxUaGlzLmNvbnN0cnVjdG9yLm5hbWV9KCR7dGhpcy5zZW5kZXJJZH0pLSR7Y2hhbm5lbH1dICR7bWVzc2FnZX1gLFxyXG4gICAgICAgIGRhdGFcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgdGhpcy5fX2JjQ2hhbm5lbC5vbm1lc3NhZ2UgPVxyXG4gICAgICB0aGlzLmhhbmRsZUJyb2FkY2FzdC5iaW5kKHRoaXMpO1xyXG4gICAgdGhpcy5fX2JjQ2hhbm5lbC5vbm1lc3NhZ2VlcnJvciA9XHJcbiAgICAgIHRoaXMuaGFuZGxlQnJvYWRjYXN0RXJyb3IuYmluZCh0aGlzKTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgdGhpcy5fX3NlbmRCcm9rZXJTdGF0ZSh1bmRlZmluZWQsIHVuZGVmaW5lZCk7IC8vIGFsd2F5cyBzZW5kIGluaXRpYWwgc3luYyByZXF1ZXN0XHJcbiAgICB9LCAwKTtcclxuXHJcbiAgICB0aGlzLnNlbmRCcm9rZXJTdGF0ZSA9IGRlYm91bmNlKFxyXG4gICAgICB0aGlzLl9fc2VuZEJyb2tlclN0YXRlLmJpbmQodGhpcyksXHJcbiAgICAgIDJcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBDb25maWd1cmVDaGFubmVsKFxyXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcclxuICAgIGVuYWJsZUJyb2FkY2FzdDogYm9vbGVhbixcclxuICAgIGVuYWJsZUNhY2hpbmc6IGJvb2xlYW4sXHJcbiAgICB0cmFjZTogYm9vbGVhblxyXG4gICk6IHZvaWQge1xyXG4gICAgY2hhbm5lbFNldHRpbmdzLnNldChjaGFubmVsTmFtZSwge1xyXG4gICAgICBlbmFibGVCcm9hZGNhc3QsXHJcbiAgICAgIGVuYWJsZUNhY2hpbmcsXHJcbiAgICAgIHRyYWNlLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGVuYWJsZUNhY2hpbmcpXHJcbiAgICAgIHRoaXMuc3RhdGUuc2V0KGNoYW5uZWxOYW1lLCB1bmRlZmluZWQpO1xyXG4gICAgaWYgKGVuYWJsZUJyb2FkY2FzdCkgdGhpcy5icmFvZGNhc3RzLmFkZChjaGFubmVsTmFtZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUJyb2FkY2FzdEVycm9yKFxyXG4gICAgZXY6IE1lc3NhZ2VFdmVudDxJQnJvYWRjYXN0RW52ZWxvcGU+XHJcbiAgKSB7XHJcbiAgICB0aHJvdyBFcnJvcihcIkJST0FEQ0FTVCBGQUlMRUQ6IFwiICsgZXYuZGF0YSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNlbmRCcm9rZXJTdGF0ZTogKFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmcsXHJcbiAgICBmaWx0ZXJCcm9hZGNhc3RzPzogc3RyaW5nW11cclxuICApID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSBfX3NlbmRCcm9rZXJTdGF0ZShcclxuICAgIHRhcmdldElkPzogc3RyaW5nLFxyXG4gICAgZmlsdGVyQnJvYWRjYXN0cz86IHN0cmluZ1tdXHJcbiAgKSB7XHJcbiAgICBsZXQgY3VycmVudEJyb2FkY2FzdHMgPSBBcnJheS5mcm9tKFxyXG4gICAgICB0aGlzLmJyYW9kY2FzdHMua2V5cygpXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChmaWx0ZXJCcm9hZGNhc3RzICYmIGZpbHRlckJyb2FkY2FzdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjdXJyZW50QnJvYWRjYXN0cyA9IGN1cnJlbnRCcm9hZGNhc3RzLmZpbHRlcigoaykgPT5cclxuICAgICAgICBmaWx0ZXJCcm9hZGNhc3RzLmluY2x1ZGVzKGspXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYXZhaWxhYmxlU3RhdGU6IHsgW3g6IHN0cmluZ106IGFueSB9ID0ge307XHJcbiAgICBmb3IgKGNvbnN0IHggb2YgdGhpcy5zdGF0ZSkge1xyXG4gICAgICBpZiAoIXhbMV0pIGNvbnRpbnVlO1xyXG4gICAgICBpZiAoIWN1cnJlbnRCcm9hZGNhc3RzLmluY2x1ZGVzKHhbMF0pKSBjb250aW51ZTtcclxuICAgICAgYXZhaWxhYmxlU3RhdGVbeFswXV0gPSB4WzFdO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXRlOiBJQnJva2VyU3RhdGUgPSB7XHJcbiAgICAgIGlkOiBzZW5kZXJJZCxcclxuICAgICAgYXZhaWxhYmxlU3RhdGUsXHJcbiAgICAgIGJyb2FkY2FzdHM6IGN1cnJlbnRCcm9hZGNhc3RzLFxyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBldjogSUJyb2FkY2FzdFN5bmNFbnZlbG9wZSA9IHtcclxuICAgICAgY2hhbm5lbE5hbWU6IEJST0FEQ0FTVF9TWU5DLFxyXG4gICAgICBzZW5kZXJDdHg6IGdsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZSxcclxuICAgICAgc2VuZGVySWQsXHJcbiAgICAgIHRhcmdldElkLFxyXG4gICAgICBtc2c6IHN0YXRlLFxyXG4gICAgICBjaGFubmVsVHlwZTogXCJzeW5jXCIsXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuX19iY0NoYW5uZWwucG9zdE1lc3NhZ2UoZXYpO1xyXG5cclxuICAgIGlmICh0YXJnZXRJZCA9PSB1bmRlZmluZWQpXHJcbiAgICAgIHRoaXMubG9nKFwiQnJvYWRjYXN0IHN5bmMgcmVxdWVzdGVkXCIsIFwiXCIsIHtcclxuICAgICAgICBicm9rZXJTdGF0ZTogc3RhdGUsXHJcbiAgICAgIH0pO1xyXG4gICAgZWxzZVxyXG4gICAgICB0aGlzLmxvZyhcIkJyb2FkY2FzdCBzeW5jIHJlc3BvbmRlZFwiLCBcIlwiLCB7XHJcbiAgICAgICAgdGFyZ2V0SWQsXHJcbiAgICAgICAgYnJva2VyU3RhdGU6IHN0YXRlLFxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlQnJvYWRjYXN0U3luYyhldjogSUJyb2FkY2FzdFN5bmNFbnZlbG9wZSkge1xyXG4gICAgaWYgKGlzU3luY1JlcShldikpXHJcbiAgICAgIHJldHVybiB0aGlzLnNlbmRCcm9rZXJTdGF0ZShcclxuICAgICAgICBldi5zZW5kZXJJZCxcclxuICAgICAgICBldi5tc2cuYnJvYWRjYXN0c1xyXG4gICAgICApO1xyXG4gICAgaWYgKGlzU3luY1Jlc3AoZXYpKSB7XHJcbiAgICAgIGZvciAoY29uc3QgcyBvZiBPYmplY3QuZW50cmllcyhcclxuICAgICAgICBldi5tc2cuYXZhaWxhYmxlU3RhdGVcclxuICAgICAgKSkge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIHRoaXMuYnJhb2RjYXN0cy5oYXMoc1swXSkgJiZcclxuICAgICAgICAgIHRoaXMuc3RhdGUuaGFzKHNbMF0pICYmXHJcbiAgICAgICAgICB0aGlzLnN0YXRlLmdldChzWzBdKSA9PSB1bmRlZmluZWRcclxuICAgICAgICApIHtcclxuICAgICAgICAgIHRoaXMuX19ub3RpZnlTdWJzY3JpYmVycyhzWzBdLCBzWzFdLCBldi5zZW5kZXJJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmxvZyhcclxuICAgICAgICAgIFwiQnJvYWRjYXN0IHN5bmMgcmVzcG9uY2UgaGFuZGxlZFwiLFxyXG4gICAgICAgICAgXCJcIixcclxuICAgICAgICAgIGV2Lm1zZ1xyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgaGFuZGxlQnJvYWRjYXN0KFxyXG4gICAgZXY6IE1lc3NhZ2VFdmVudDxJQnJvYWRjYXN0RW52ZWxvcGU+XHJcbiAgKSB7XHJcbiAgICB0aGlzLmxvZyhcclxuICAgICAgXCJCcm9hZGNhc3QgcmVjZWl2ZWRcIixcclxuICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZSxcclxuICAgICAgZXYuZGF0YVxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIGV2LmRhdGEudGFyZ2V0SWQgIT0gdW5kZWZpbmVkICYmXHJcbiAgICAgIGV2LmRhdGEudGFyZ2V0SWQgIT09IHNlbmRlcklkXHJcbiAgICApIHtcclxuICAgICAgdGhpcy5sb2coXHJcbiAgICAgICAgXCJCcm9hZGNhc3QgaWdub3JlZCAoZGlmZmVyZW50IHRhcmdldElkKVwiLFxyXG4gICAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWVcclxuICAgICAgKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpc0Jyb2FkY2FzdFN5bmMoZXYuZGF0YSkpXHJcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUJyb2FkY2FzdFN5bmMoZXYuZGF0YSk7XHJcblxyXG4gICAgc3dpdGNoIChldi5kYXRhLmNoYW5uZWxUeXBlKSB7XHJcbiAgICAgIGNhc2UgXCJwdWJTdWJcIjpcclxuICAgICAgICB0aGlzLl9fbm90aWZ5U3Vic2NyaWJlcnMoXHJcbiAgICAgICAgICBldi5kYXRhLmNoYW5uZWxOYW1lLFxyXG4gICAgICAgICAgZXYuZGF0YS5tc2csXHJcbiAgICAgICAgICBldi5kYXRhLnNlbmRlcklkXHJcbiAgICAgICAgKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBcInJlcVwiOlxyXG4gICAgICAgIHRoaXMuYnJpZGdlUmVxdWVzdChcclxuICAgICAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWUsXHJcbiAgICAgICAgICBldi5kYXRhLm1zZyxcclxuICAgICAgICAgIGV2LmRhdGEuc2VuZGVySWRcclxuICAgICAgICApO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIFwicmVwXCI6XHJcbiAgICAgICAgY29uc3QgcmVxID0gdGhpcy5icm9hZGNhc3RlZFJlcXVlc3RzLmdldChcclxuICAgICAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWVcclxuICAgICAgICApO1xyXG4gICAgICAgIGlmICghcmVxKSByZXR1cm47XHJcblxyXG4gICAgICAgIHJlcS5yZXNvbHZlKGV2LmRhdGEubXNnKTtcclxuICAgICAgICB0aGlzLmJyb2FkY2FzdGVkUmVxdWVzdHMuZGVsZXRlKFxyXG4gICAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMubG9nKFxyXG4gICAgICBcIkJyb2FkY2FzdCBoYW5kbGVkXCIsXHJcbiAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWUsXHJcbiAgICAgIGV2LmRhdGFcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBCcmlkZ2UgcHViL3N1YiBtZXNzYWdlcyB0byBicm9hZGNhc3QgY2hhbm5lbFxyXG4gICAqIEBwYXJhbSBzdWJzS2V5XHJcbiAgICogQHJldHVybnMge1N1YnNjcmlwdGlvbn1cclxuICAgKi9cclxuICBwcml2YXRlIF9fY29uZmlndXJlQnJvYWRjYXN0KFxyXG4gICAgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb248YW55PlxyXG4gICk6IHZvaWQge1xyXG4gICAgaWYgKCFzdWJzY3JpcHRpb24uY2hhbm5lbE5hbWUpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHN1YnNjcmlwdGlvbmApO1xyXG4gICAgfVxyXG4gICAgdGhpcy5icmFvZGNhc3RzLmFkZChzdWJzY3JpcHRpb24uY2hhbm5lbE5hbWUpO1xyXG4gICAgY29uc3Qgb3JpZ2luYWxEaXNwb3NlID0gc3Vic2NyaXB0aW9uLmRpc3Bvc2U7XHJcbiAgICBzdWJzY3JpcHRpb24uZGlzcG9zZSA9ICgpID0+IHtcclxuICAgICAgb3JpZ2luYWxEaXNwb3NlKCk7XHJcbiAgICAgIHRoaXMuYnJhb2RjYXN0cy5kZWxldGUoc3Vic2NyaXB0aW9uLmNoYW5uZWxOYW1lKTtcclxuICAgIH07XHJcbiAgICBzdWJzY3JpcHRpb24uaXNCcm9hZGNhc3QgPSB0cnVlO1xyXG5cclxuICAgIHRoaXMuc2VuZEJyb2tlclN0YXRlKCk7XHJcbiAgfVxyXG5cclxuICBHZXRTdGF0ZTxUPihzdWJzS2V5OiBzdHJpbmcpOiBUIHwgdW5kZWZpbmVkIHtcclxuICAgIGlmIChzdWJzS2V5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnN0YXRlLmdldChzdWJzS2V5KSBhcyBUO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIEJyb2FkY2FzdChcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBtc2c6IHVua25vd24sXHJcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xyXG4gICkge1xyXG4gICAgdGhpcy5fYnJvYWRjYXN0KGNoYW5uZWxOYW1lLCBtc2csIFwicHViU3ViXCIsIHRhcmdldElkKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgX2Jyb2FkY2FzdChcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBtc2c6IHVua25vd24sXHJcbiAgICBjaGFubmVsVHlwZTogQ2hhbm5lbFR5cGUsXHJcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xyXG4gICkge1xyXG4gICAgY29uc3Qgc2V0dGluZ3MgPSBjaGFubmVsU2V0dGluZ3MuZ2V0KGNoYW5uZWxOYW1lKTtcclxuXHJcbiAgICB0aGlzLmxvZyhcclxuICAgICAgYE1lc3NhZ2UgYnJvYWRjYXN0ZWQgKCR7Y2hhbm5lbFR5cGV9KSB0byAke1xyXG4gICAgICAgIHRhcmdldElkIHx8IFwiYWxsIGJyb2tlcnNcIlxyXG4gICAgICB9YCxcclxuICAgICAgY2hhbm5lbE5hbWUsXHJcbiAgICAgIG1zZ1xyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBfbXNnID0gYXdhaXQgUHJvbWlzZS5yZXNvbHZlKG1zZyk7XHJcbiAgICBjb25zdCBlbnZlbG9wZTogSUJyb2FkY2FzdEVudmVsb3BlID0ge1xyXG4gICAgICBjaGFubmVsTmFtZTogY2hhbm5lbE5hbWUsXHJcbiAgICAgIHNlbmRlckN0eDogZ2xvYmFsVGhpcy5jb25zdHJ1Y3Rvci5uYW1lLFxyXG4gICAgICBzZW5kZXJJZDogc2VuZGVySWQsXHJcbiAgICAgIHRhcmdldElkOiB0YXJnZXRJZCxcclxuICAgICAgbXNnOiBfbXNnLFxyXG4gICAgICBjaGFubmVsVHlwZSxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKHNldHRpbmdzPy5lbmFibGVDYWNoaW5nKVxyXG4gICAgICB0aGlzLnN0YXRlLnNldChjaGFubmVsTmFtZSwgbXNnKTtcclxuXHJcbiAgICB0aGlzLl9fYmNDaGFubmVsLnBvc3RNZXNzYWdlKGVudmVsb3BlKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIFB1Ymxpc2goXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiB1bmtub3duLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIHRoaXMubG9nKGBNZXNzYWdlIHB1Ymxpc2hlZGAsIGNoYW5uZWxOYW1lLCBtc2cpO1xyXG4gICAgYXdhaXQgdGhpcy5fX25vdGlmeVN1YnNjcmliZXJzKFxyXG4gICAgICBjaGFubmVsTmFtZSxcclxuICAgICAgbXNnLFxyXG4gICAgICBzZW5kZXJJZFxyXG4gICAgKTtcclxuXHJcbiAgICBpZiAoIXRoaXMuYnJhb2RjYXN0cy5oYXMoY2hhbm5lbE5hbWUpKSByZXR1cm47XHJcblxyXG4gICAgdGhpcy5fYnJvYWRjYXN0KGNoYW5uZWxOYW1lLCBtc2csIFwicHViU3ViXCIsIHRhcmdldElkKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX19uZXh0TWVzc2FnZUF3YXRlcnMgPSBuZXcgTWFwPFxyXG4gICAgc3RyaW5nLFxyXG4gICAge1xyXG4gICAgICBwcm9taXNlOiBQcm9taXNlPHVua25vd24+O1xyXG4gICAgICByZXNvbHZlOiAobXNnOiB1bmtub3duKSA9PiB1bmtub3duO1xyXG4gICAgfVxyXG4gID4oKTtcclxuXHJcbiAgYXN5bmMgbmV4dE1lc3NhZ2U8VCA9IHVua25vd24+KFxyXG4gICAgc3Vic0tleTogc3RyaW5nXHJcbiAgKTogUHJvbWlzZTxUPiB7XHJcbiAgICBjb25zdCBhID0gdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5nZXQoc3Vic0tleSk7XHJcbiAgICBpZiAoYSkgcmV0dXJuIGEucHJvbWlzZSBhcyBQcm9taXNlPFQ+O1xyXG5cclxuICAgIGNvbnN0IG5ld0F3YWl0ZXI6IHtcclxuICAgICAgcHJvbWlzZTogUHJvbWlzZTx1bmtub3duPjtcclxuICAgICAgcmVzb2x2ZTogKG1zZzogdW5rbm93bikgPT4gdm9pZDtcclxuICAgIH0gPSB7XHJcbiAgICAgIHByb21pc2U6IHVuZGVmaW5lZCBhcyB1bmtub3duIGFzIFByb21pc2U8VD4sXHJcbiAgICAgIHJlc29sdmU6IHVuZGVmaW5lZCBhcyB1bmtub3duIGFzIChcclxuICAgICAgICBtc2c6IHVua25vd25cclxuICAgICAgKSA9PiB2b2lkLFxyXG4gICAgfTtcclxuICAgIG5ld0F3YWl0ZXIucHJvbWlzZSA9IG5ldyBQcm9taXNlKFxyXG4gICAgICAocmVzOiAobXNnOiB1bmtub3duKSA9PiB2b2lkKSA9PiB7XHJcbiAgICAgICAgbmV3QXdhaXRlci5yZXNvbHZlID0gcmVzO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuX19uZXh0TWVzc2FnZUF3YXRlcnMuc2V0KHN1YnNLZXksIG5ld0F3YWl0ZXIpO1xyXG5cclxuICAgIHJldHVybiBuZXdBd2FpdGVyLnByb21pc2UgYXMgUHJvbWlzZTxUPjtcclxuICB9XHJcblxyXG4gIFN1YnNjcmliZTxUPihcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBoYW5kbGVyPzogVEhhbmRsZXI8VD4sXHJcbiAgICBlbmFibGVCcm9hZGNhc3QgPSBmYWxzZSxcclxuICAgIGVuYWJsZUNhY2hpbmcgPSB0cnVlXHJcbiAgKTogU3Vic2NyaXB0aW9uPFQ+IHtcclxuICAgIGNvbnN0IHNldHRpbmdzID0gY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsTmFtZSk7XHJcbiAgICBjb25zdCBzZXR0aW5nc092ZXJyaWRlbiA9IGZhbHNlO1xyXG4gICAgaWYgKHNldHRpbmdzKSB7XHJcbiAgICAgIGVuYWJsZUJyb2FkY2FzdCA9IHNldHRpbmdzLmVuYWJsZUJyb2FkY2FzdCB8fCBmYWxzZTtcclxuICAgICAgZW5hYmxlQ2FjaGluZyA9IHNldHRpbmdzLmVuYWJsZUNhY2hpbmcgfHwgdHJ1ZTtcclxuICAgICAgc2V0dGluZ3NPdmVycmlkZW47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc3VicyA9IHRoaXMuc3Vic2NyaWJlcnMuZ2V0KGNoYW5uZWxOYW1lKSB8fCBbXTtcclxuICAgIGNvbnN0IGhkbCA9IGhhbmRsZXIgYXMgKG1zZzogdW5rbm93bikgPT4gdm9pZDtcclxuICAgIHN1YnMucHVzaChoZGwpO1xyXG4gICAgdGhpcy5zdWJzY3JpYmVycy5zZXQoY2hhbm5lbE5hbWUsIHN1YnMpO1xyXG5cclxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uPFQ+ID0ge1xyXG4gICAgICBjaGFubmVsTmFtZTogY2hhbm5lbE5hbWUsXHJcbiAgICAgIGlzQ2FjaGVkOiBmYWxzZSxcclxuICAgICAgZGlzcG9zZTogKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IF9zdWJzID0gdGhpcy5zdWJzY3JpYmVycy5nZXQoY2hhbm5lbE5hbWUpO1xyXG5cclxuICAgICAgICBpZiAoX3N1YnMgPT0gdW5kZWZpbmVkKSByZXR1cm47XHJcbiAgICAgICAgY29uc3QgaSA9IF9zdWJzLmluZGV4T2YoaGRsKTtcclxuXHJcbiAgICAgICAgaWYgKGkgPT09IC0xKSByZXR1cm47XHJcbiAgICAgICAgX3N1YnMuc3BsaWNlKGksIDEpO1xyXG4gICAgICB9LFxyXG4gICAgICBwdWJsaXNoOiAobXNnLCB0YXJnZXRJZD86IHN0cmluZykgPT5cclxuICAgICAgICB0aGlzLlB1Ymxpc2goY2hhbm5lbE5hbWUsIG1zZywgdGFyZ2V0SWQpLFxyXG4gICAgICBpc0Rpc3Bvc2VkOiBmYWxzZSxcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGVuYWJsZUJyb2FkY2FzdClcclxuICAgICAgdGhpcy5fX2NvbmZpZ3VyZUJyb2FkY2FzdChzdWJzY3JpcHRpb24pO1xyXG4gICAgaWYgKGVuYWJsZUNhY2hpbmcpXHJcbiAgICAgIHRoaXMuc3RhdGUuc2V0KGNoYW5uZWxOYW1lLCB1bmRlZmluZWQpO1xyXG5cclxuICAgIHJldHVybiBzdWJzY3JpcHRpb247XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJyaWRnZVJlcXVlc3QoXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgcmVxdWVzdERhdGE6IHVua25vd24sXHJcbiAgICBzZW5kZXJJZDogc3RyaW5nXHJcbiAgKSB7XHJcbiAgICBjb25zdCBsaXN0ZW5lciA9IHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xyXG5cclxuICAgIGlmICghbGlzdGVuZXIpIHJldHVybiBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTtcclxuXHJcbiAgICByZXR1cm4gbGlzdGVuZXIuaGFuZGxlcihcclxuICAgICAgcmVxdWVzdERhdGEsXHJcbiAgICAgIHNlbmRlcklkXHJcbiAgICApIGFzIFByb21pc2U8dW5rbm93bj47XHJcbiAgfVxyXG5cclxuICBSZXF1ZXN0PFRSZXAgPSB1bmtub3duPihcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICByZXF1ZXN0RGF0YTogdW5rbm93bixcclxuICAgIGVuYWJsZUJyb2FkY2FzdCA9IGZhbHNlLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApOiBQcm9taXNlPFRSZXA+IHwgUHJvbWlzZTx1bmRlZmluZWQ+IHtcclxuICAgIGlmICghZW5hYmxlQnJvYWRjYXN0KSB7XHJcbiAgICAgIGNvbnN0IGxpc3RlbmVyID1cclxuICAgICAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuZ2V0KGNoYW5uZWxOYW1lKTtcclxuICAgICAgaWYgKCFsaXN0ZW5lcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xyXG4gICAgICByZXR1cm4gbGlzdGVuZXIuaGFuZGxlcihyZXF1ZXN0RGF0YSkgYXMgUHJvbWlzZTxUUmVwPjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2Jyb2FkY2FzdChcclxuICAgICAgICBjaGFubmVsTmFtZSxcclxuICAgICAgICByZXF1ZXN0RGF0YSxcclxuICAgICAgICBcInJlcVwiLFxyXG4gICAgICAgIHRhcmdldElkXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IHJlcSA9IHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5nZXQoY2hhbm5lbE5hbWUpO1xyXG4gICAgICBpZiAocmVxKSByZXEucmVzb2x2ZSh1bmRlZmluZWQpO1xyXG5cclxuICAgICAgbGV0IHJlc29sdmUgPSB1bmRlZmluZWQgYXMgdW5rbm93biBhcyAoXHJcbiAgICAgICAgcjogdW5rbm93blxyXG4gICAgICApID0+IHZvaWQ7XHJcbiAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZTxUUmVwPihcclxuICAgICAgICAocmVzKSA9PiAocmVzb2x2ZSA9IHJlcyBhcyAocjogdW5rbm93bikgPT4gdm9pZClcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgYnJlcSA9IHtcclxuICAgICAgICBwcm9taXNlLFxyXG4gICAgICAgIHJlc29sdmUsXHJcbiAgICAgIH07XHJcbiAgICAgIHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5zZXQoY2hhbm5lbE5hbWUsIGJyZXEpO1xyXG4gICAgICByZXR1cm4gYnJlcS5wcm9taXNlO1xyXG4gICAgfVxyXG4gIH1cclxuICBwcml2YXRlIGJyb2FkY2FzdGVkUmVxdWVzdHMgPSBuZXcgTWFwPFxyXG4gICAgc3RyaW5nLFxyXG4gICAge1xyXG4gICAgICBwcm9taXNlOiBQcm9taXNlPHVua25vd24+O1xyXG4gICAgICByZXNvbHZlOiAocjogdW5rbm93bikgPT4gdm9pZDtcclxuICAgIH1cclxuICA+KCk7XHJcblxyXG4gIFJlcGx5PFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj4oXHJcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxyXG4gICAgaGFuZGxlcjogKHJlcTogVFJlcSkgPT4gVFJlcCxcclxuICAgIGVuYWJsZUJyb2FkY2FzdCA9IGZhbHNlXHJcbiAgKSB7XHJcbiAgICBpZiAoZW5hYmxlQnJvYWRjYXN0KSB7XHJcbiAgICAgIGNvbnN0IG9yaWdIYW5kbGVyID0gaGFuZGxlcjtcclxuICAgICAgaGFuZGxlciA9ICgobXNnOiBUUmVxLCB0YXJnZXRJZDogc3RyaW5nKSA9PlxyXG4gICAgICAgIHRoaXMuX2Jyb2FkY2FzdChcclxuICAgICAgICAgIGNoYW5uZWxOYW1lLFxyXG4gICAgICAgICAgb3JpZ0hhbmRsZXIobXNnKSxcclxuICAgICAgICAgIFwicmVwXCIsXHJcbiAgICAgICAgICB0YXJnZXRJZFxyXG4gICAgICAgICkpIGFzIHVua25vd24gYXMgKHJlcTogVFJlcSkgPT4gVFJlcDtcclxuICAgIH1cclxuICAgIGNvbnN0IHJlcUxpc3RlbmVycyA9IHRoaXMucmVxdWVzdExpc3RlbmVycztcclxuICAgIGNvbnN0IHN1YnM6IFJlcVN1YnNjcmlwdGlvbiA9IHtcclxuICAgICAgY2hhbm5lbE5hbWUsXHJcbiAgICAgIGdldCBpc0Rpc3Bvc2VkKCkge1xyXG4gICAgICAgIHJldHVybiByZXFMaXN0ZW5lcnMuaGFzKGNoYW5uZWxOYW1lKTtcclxuICAgICAgfSxcclxuICAgICAgaXNCcm9hZGNhc3Q6IGVuYWJsZUJyb2FkY2FzdCxcclxuICAgICAgaGFuZGxlcjogaGFuZGxlciBhcyAocjogdW5rbm93bikgPT4gdW5rbm93bixcclxuICAgICAgZGlzcG9zZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgKCkgPT4gdm9pZCxcclxuICAgIH07XHJcblxyXG4gICAgc3Vicy5kaXNwb3NlID0gKCkgPT4ge1xyXG4gICAgICBzdWJzLmlzRGlzcG9zZWQgPSB0cnVlO1xyXG4gICAgICBjb25zdCBjdXJyZW50TGlzdGVuZXIgPVxyXG4gICAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xyXG4gICAgICBpZiAoY3VycmVudExpc3RlbmVyID09PSBzdWJzKVxyXG4gICAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5kZWxldGUoY2hhbm5lbE5hbWUpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBjdXJyZW50TGlzdGVuZXIgPVxyXG4gICAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuZ2V0KGNoYW5uZWxOYW1lKTtcclxuICAgIGlmIChjdXJyZW50TGlzdGVuZXIpIHtcclxuICAgICAgY3VycmVudExpc3RlbmVyLmlzRGlzcG9zZWQgPSB0cnVlO1xyXG4gICAgICBjb25zb2xlLndhcm4oXHJcbiAgICAgICAgXCJSZXF1ZXN0IGxpc3RlbmVyIGhhcyBiZWVuIHJlcGxhY2VkOiBcIiArIGNoYW5uZWxOYW1lXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuc2V0KGNoYW5uZWxOYW1lLCBzdWJzKTtcclxuICAgIHJldHVybiBzdWJzO1xyXG4gIH1cclxuXHJcbiAgcmVxdWVzdExpc3RlbmVycyA9IG5ldyBNYXA8c3RyaW5nLCBSZXFTdWJzY3JpcHRpb24+KCk7XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgX19ub3RpZnlTdWJzY3JpYmVycyhcclxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXHJcbiAgICBtc2c6IHVua25vd24sXHJcbiAgICBzSWQ6IHN0cmluZ1xyXG4gICkge1xyXG4gICAgY29uc3QgaGFuZGxlcnMgPVxyXG4gICAgICB0aGlzLnN1YnNjcmliZXJzLmdldChjaGFubmVsTmFtZSkgfHwgW107XHJcblxyXG4gICAgY29uc3QgYWxsU3Vic2NyaWJlcnNQcm9taXNlczogUHJvbWlzZTx2b2lkPltdID0gW107XHJcbiAgICBmb3IgKGNvbnN0IGggb2YgaGFuZGxlcnMpIHtcclxuICAgICAgaWYgKCFoKSBjb250aW51ZTtcclxuICAgICAgYWxsU3Vic2NyaWJlcnNQcm9taXNlcy5wdXNoKFxyXG4gICAgICAgIFByb21pc2UucmVzb2x2ZShoKG1zZywgc0lkKSlcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5sb2coXCJIYW5kbGVyIGNhbGxlZFwiLCBjaGFubmVsTmFtZSwgaCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoYWxsU3Vic2NyaWJlcnNQcm9taXNlcyk7XHJcblxyXG4gICAgaWYgKHRoaXMuc3RhdGUuaGFzKGNoYW5uZWxOYW1lKSlcclxuICAgICAgdGhpcy5zdGF0ZS5zZXQoY2hhbm5lbE5hbWUsIG1zZyk7XHJcblxyXG4gICAgdGhpcy5fX2hhbmRsZUF3YWl0ZXIoY2hhbm5lbE5hbWUsIG1zZyk7XHJcblxyXG4gICAgdGhpcy5sb2coXCJNZXNzYWdlIGhhbmRsZWRcIiwgY2hhbm5lbE5hbWUsIG1zZywgdGhpcyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9faGFuZGxlQXdhaXRlcihzdWJzS2V5OiBzdHJpbmcsIG1zZzogdW5rbm93bikge1xyXG4gICAgY29uc3QgYXdhaXRlciA9IHRoaXMuX19uZXh0TWVzc2FnZUF3YXRlcnMuZ2V0KHN1YnNLZXkpO1xyXG4gICAgaWYgKCFhd2FpdGVyKSByZXR1cm47XHJcblxyXG4gICAgYXdhaXRlci5yZXNvbHZlKG1zZyk7XHJcblxyXG4gICAgdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5kZWxldGUoc3Vic0tleSk7XHJcbiAgfVxyXG59XHJcblxyXG5nbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyID1cclxuICBnbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyIHx8IG5ldyBCcm9rZXIoKTtcclxuXHJcbmV4cG9ydCBjb25zdCBCTUIgPSBnbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyO1xyXG5leHBvcnQgdHlwZSB7IElCcm9rZXIsIFN1YnNjcmlwdGlvbiB9IGZyb20gXCIuL1R5cGVzXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL1B1YlN1YkNoYW5uZWxcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vUmVxUmVwQ2hhbm5lbFwiO1xyXG4iLCAiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XHJcbmltcG9ydCB7XHJcbiAgRGlzcG9zZXIsXHJcbiAgQ2hhbm5lbFNldHRpbmdzLFxyXG4gIElQdWJTdWJDaGFubmVsLFxyXG4gIFRIYW5kbGVyLFxyXG59IGZyb20gXCIuL1R5cGVzXCI7XHJcblxyXG5jb25zdCBwdWJTdWJDaGFubmVscyA9IG5ldyBNYXA8c3RyaW5nLCBQdWJTdWJDaGFubmVsPigpO1xyXG5cclxuZXhwb3J0IGNsYXNzIFB1YlN1YkNoYW5uZWw8VE1zZyA9IGFueT5cclxuICBpbXBsZW1lbnRzIElQdWJTdWJDaGFubmVsPFRNc2c+XHJcbntcclxuICBzdGF0aWMgZ2V0T3JDcmVhdGU8VE1zZz4oXHJcbiAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICBzZXR0aW5ncz86IENoYW5uZWxTZXR0aW5nc1xyXG4gICk6IFB1YlN1YkNoYW5uZWw8VE1zZz4ge1xyXG4gICAgaWYgKCFzZXR0aW5ncykge1xyXG4gICAgICBjb25zdCBjID0gcHViU3ViQ2hhbm5lbHMuZ2V0KG5hbWUpO1xyXG4gICAgICBpZiAoIWMpIHRocm93IEVycm9yKFwiQ2FuJ3QgZmluZCBjaGFubmVsIHNldHRpbmdzXCIpO1xyXG4gICAgICByZXR1cm4gYyBhcyBQdWJTdWJDaGFubmVsPFRNc2c+O1xyXG4gICAgfVxyXG5cclxuICAgIEJNQi5Db25maWd1cmVDaGFubmVsKFxyXG4gICAgICBuYW1lLFxyXG4gICAgICBzZXR0aW5ncy5lbmFibGVCcm9hZGNhc3QgfHwgZmFsc2UsXHJcbiAgICAgIHNldHRpbmdzLmVuYWJsZUNhY2hpbmcgfHwgZmFsc2UsXHJcbiAgICAgIHNldHRpbmdzLnRyYWNlIHx8IGZhbHNlXHJcbiAgICApO1xyXG4gICAgY29uc3QgY2hhbm5lbCA9IG5ldyBQdWJTdWJDaGFubmVsPFRNc2c+KG5hbWUsIHNldHRpbmdzKTtcclxuICAgIHB1YlN1YkNoYW5uZWxzLnNldChuYW1lLCBjaGFubmVsKTtcclxuICAgIHJldHVybiBjaGFubmVsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcclxuICAgIG5hbWU6IHN0cmluZyxcclxuICAgIHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3NcclxuICApIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgfVxyXG5cclxuICBhc3luYyBzZW5kKG1zZzogVE1zZywgdGFyZ2V0SWQ/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIEJNQi5QdWJsaXNoKHRoaXMubmFtZSwgbXNnLCB0YXJnZXRJZCk7XHJcbiAgfVxyXG4gIHN0YXRpYyBhc3luYyBwdWJsaXNoPFRNc2cgPSBhbnk+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiBUTXNnLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIEJNQi5QdWJsaXNoKG5hbWUsIG1zZywgdGFyZ2V0SWQpO1xyXG4gIH1cclxuICBzdGF0aWMgYXN5bmMgYnJvYWRjYXN0PFRNc2cgPSBhbnk+KFxyXG4gICAgbmFtZTogc3RyaW5nLFxyXG4gICAgbXNnOiBUTXNnLFxyXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcclxuICApIHtcclxuICAgIEJNQi5Ccm9hZGNhc3Q8VE1zZz4obmFtZSwgbXNnLCB0YXJnZXRJZCk7XHJcbiAgfVxyXG5cclxuICBzdWJzY3JpYmUoaGFuZGxlcjogVEhhbmRsZXI8VE1zZz4pOiBEaXNwb3NlciB7XHJcbiAgICBjb25zdCBzID0gQk1CLlN1YnNjcmliZShcclxuICAgICAgdGhpcy5uYW1lLFxyXG4gICAgICBoYW5kbGVyLFxyXG4gICAgICB0aGlzLnNldHRpbmdzLmVuYWJsZUJyb2FkY2FzdCxcclxuICAgICAgdGhpcy5zZXR0aW5ncy5lbmFibGVDYWNoaW5nXHJcbiAgICApO1xyXG4gICAgcmV0dXJuIHMuZGlzcG9zZTtcclxuICB9XHJcblxyXG4gIGdldFN0YXRlKCk6IFRNc2cgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIEJNQi5HZXRTdGF0ZSh0aGlzLm5hbWUpO1xyXG4gIH1cclxuICBzdGF0aWMgR2V0U3RhdGU8VE1zZz4obmFtZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gQk1CLkdldFN0YXRlPFRNc2c+KG5hbWUpO1xyXG4gIH1cclxuXHJcbiAgbmV4dE1lc3NhZ2UoKTogUHJvbWlzZTxUTXNnPiB7XHJcbiAgICByZXR1cm4gQk1CLm5leHRNZXNzYWdlKHRoaXMubmFtZSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgbmV4dE1lc3NhZ2U8VE1zZz4obmFtZTogc3RyaW5nKTogUHJvbWlzZTxUTXNnPiB7XHJcbiAgICByZXR1cm4gQk1CLm5leHRNZXNzYWdlKG5hbWUpO1xyXG4gIH1cclxuXHJcbiAgcmVhZG9ubHkgdHlwZSA9IFwicHViU3ViXCI7XHJcbiAgcmVhZG9ubHkgZGlzcG9zZSA9ICgpID0+IHtcclxuICAgIEJNQi5zdWJzY3JpYmVycy5kZWxldGUodGhpcy5uYW1lKTtcclxuICAgIHB1YlN1YkNoYW5uZWxzLmRlbGV0ZSh0aGlzLm5hbWUpO1xyXG4gIH07XHJcblxyXG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZyA9IFwiXCI7XHJcbiAgcmVhZG9ubHkgc2V0dGluZ3M6IENoYW5uZWxTZXR0aW5ncyA9IHt9O1xyXG59XHJcbiIsICJleHBvcnQgY29uc3QgUFVCX1NVQl9SRVFVRVNUX1NVQlNDUklQVElPTl9LRVkgPSBcInRlc3RSZXFcIjtcclxuZXhwb3J0IGNvbnN0IFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSA9IFwidGVzdFJlc3BcIjtcclxuZXhwb3J0IGNvbnN0IFJFUV9SRVBfQ0hBTk5FTF9OQU1FID0gXCJyZXFSZXBDaGFubmVsXCI7XHJcbiIsICJpbXBvcnQge1xyXG4gIFB1YlN1YkNoYW5uZWwsXHJcbiAgUmVxUmVwQ2hhbm5lbCxcclxufSBmcm9tIFwiYnJvd3Nlci1tZXNzYWdlLWJyb2tlclwiO1xyXG5pbXBvcnQge1xyXG4gIFBVQl9TVUJfUkVRVUVTVF9TVUJTQ1JJUFRJT05fS0VZLFxyXG4gIFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSxcclxuICBSRVFfUkVQX0NIQU5ORUxfTkFNRSxcclxufSBmcm9tIFwiLi9jb25zdGFudHNcIjtcclxuXHJcblB1YlN1YkNoYW5uZWwuZ2V0T3JDcmVhdGUoXHJcbiAgUFVCX1NVQl9SRVFVRVNUX1NVQlNDUklQVElPTl9LRVksXHJcbiAge1xyXG4gICAgZW5hYmxlQnJvYWRjYXN0OiB0cnVlLFxyXG4gIH1cclxuKS5zdWJzY3JpYmUoKF8pID0+IHtcclxuICBQdWJTdWJDaGFubmVsLmJyb2FkY2FzdChcclxuICAgIFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSxcclxuICAgIHsgcGF5bG9hZDogXCJyZXNwb25zZVwiIH1cclxuICApO1xyXG59KTtcclxuXHJcblJlcVJlcENoYW5uZWwuZ2V0T3JDcmVhdGU8XHJcbiAgeyBwYXlsb2FkOiBzdHJpbmcgfSxcclxuICB7IHBheWxvYWQ6IHN0cmluZyB9XHJcbj4oUkVRX1JFUF9DSEFOTkVMX05BTUUsIHtcclxuICBlbmFibGVCcm9hZGNhc3Q6IHRydWUsXHJcbn0pLnJlcGx5KChyZXEpID0+IHtcclxuICByZXR1cm4geyBwYXlsb2FkOiByZXEucGF5bG9hZCArIFwicmVzcG9uc2VcIiB9O1xyXG59KTtcclxuXHJcbi8vbGV0IHdpbmRvdyBrbm93IHRoYXQgd29ya2VyIGlzIHJlYWR5IGFuZCBleGVjdXRlIHRlc3RcclxucG9zdE1lc3NhZ2UoXCJyZWFkeVwiKTtcclxuIl0sCiAgIm1hcHBpbmdzIjogIjtBQUdBLElBQU0sSUFBaUIsb0JBQUk7QUFBM0IsSUFFYSxJQUFOLE1BRVA7RUFtRFUsWUFDTixHQUNBLEdBQ0E7QUFyQ0YsU0FBUyxPQUFpQjtBQUUxQixTQUFBLFdBQTRCLENBQUM7QUFPN0IsU0FBUyxPQUFlO0FBNkJ0QixTQUFLLE9BQU8sR0FDWixLQUFLLFdBQVc7RUFDbEI7RUF4REEsTUFBTSxRQUFRLEdBQXNDO0FBQ2xELFdBQU8sRUFBSSxRQUNULEtBQUssTUFDTCxHQUNBLEtBQUssU0FBUyxl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
