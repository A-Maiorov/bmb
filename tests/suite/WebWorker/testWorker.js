// node_modules/.pnpm/browser-message-broker@0.0.8/node_modules/browser-message-broker/dist/Module.js
var b = /* @__PURE__ */ new Map();
var w = class d {
  constructor(e, s) {
    this.type = "reqRep";
    this.settings = {};
    this.name = "";
    this.name = e, this.settings = s;
  }
  async request(e) {
    return i.Request(this.name, e, this.settings.broadcast);
  }
  reply(e) {
    return i.Reply(this.name, e, this.settings.broadcast).dispose;
  }
  dispose() {
    i.requestListeners.delete(this.name), b.delete(this.name);
  }
  static for(e, s) {
    if (!s) {
      let n = b.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.broadcast || false, s.cache || false, s.trace || false);
    let t = new d(e, s);
    return b.set(e, t), t;
  }
};
var S = "broadcast-sync";
var R = "browser-message-broker";
function k(d3) {
  return d3.channelName === S;
}
function B(d3) {
  return d3.senderId != null && d3.targetId == null;
}
function q(d3) {
  return d3.senderId != null && d3.targetId != null;
}
var l = Math.random().toString(36).substring(2, 9);
function M(d3, e = 1) {
  let s;
  return (...t) => {
    clearTimeout(s), s = setTimeout(() => {
      d3(...t);
    }, e);
  };
}
var h = /* @__PURE__ */ new Map();
var f = class {
  constructor() {
    this.trace = false;
    this.senderId = l;
    this.state = /* @__PURE__ */ new Map();
    this.subscribers = /* @__PURE__ */ new Map();
    this.braodcasts = /* @__PURE__ */ new Set();
    this.__bcChannel = new BroadcastChannel(R);
    this.__nextMessageAwaters = /* @__PURE__ */ new Map();
    this.broadcastedRequests = /* @__PURE__ */ new Map();
    this.requestListeners = /* @__PURE__ */ new Map();
    this.__bcChannel.onmessage = this.handleBroadcast.bind(this), this.__bcChannel.onmessageerror = this.handleBroadcastError.bind(this), setTimeout(() => {
      this.__sendBrokerState(void 0, void 0);
    }, 0), this.sendBrokerState = M(this.__sendBrokerState.bind(this), 2);
  }
  log(e, s, ...t) {
    (this.trace || h.get(s)?.trace) && console.log(`[${globalThis.constructor.name}(${this.senderId})-${s}] ${e}`, t);
  }
  ConfigureChannel(e, s, t, n) {
    h.set(e, { broadcast: s, cache: t, trace: n }), t && this.state.set(e, void 0), s && this.braodcasts.add(e);
  }
  handleBroadcastError(e) {
    throw Error("BROADCAST FAILED: " + e.data);
  }
  __sendBrokerState(e, s) {
    let t = Array.from(this.braodcasts.keys());
    s && s.length > 0 && (t = t.filter((o) => s.includes(o)));
    let n = {};
    for (let o of this.state)
      o[1] && t.includes(o[0]) && (n[o[0]] = o[1]);
    let r = { id: l, availableState: n, broadcasts: t }, a = { channelName: S, senderCtx: globalThis.constructor.name, senderId: l, targetId: e, msg: r, channelType: "sync" };
    this.__bcChannel.postMessage(a), e == null ? this.log("Broadcast sync requested", "", { brokerState: r }) : this.log("Broadcast sync responded", "", { targetId: e, brokerState: r });
  }
  handleBroadcastSync(e) {
    if (B(e))
      return this.sendBrokerState(e.senderId, e.msg.broadcasts);
    if (q(e))
      for (let s of Object.entries(e.msg.availableState))
        this.braodcasts.has(s[0]) && this.state.has(s[0]) && this.state.get(s[0]) == null && this.__notifySubscribers(s[0], s[1], e.senderId), this.log("Broadcast sync responce handled", "", e.msg);
  }
  handleBroadcast(e) {
    if (this.log("Broadcast received", e.data.channelName, e.data), e.data.targetId != null && e.data.targetId !== l) {
      this.log("Broadcast ignored (different targetId)", e.data.channelName);
      return;
    }
    if (k(e.data))
      return this.handleBroadcastSync(e.data);
    switch (e.data.channelType) {
      case "pubSub":
        this.__notifySubscribers(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "req":
        this.bridgeRequest(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "rep":
        let s = this.broadcastedRequests.get(e.data.channelName);
        if (!s)
          return;
        s.resolve(e.data.msg), this.broadcastedRequests.delete(e.data.channelName);
        break;
    }
    this.log("Broadcast handled", e.data.channelName, e.data);
  }
  __configureBroadcast(e) {
    if (!e.channelName)
      throw new Error("Invalid subscription");
    this.braodcasts.add(e.channelName);
    let s = e.dispose;
    e.dispose = () => {
      s(), this.braodcasts.delete(e.channelName);
    }, e.isBroadcast = true, this.sendBrokerState();
  }
  GetState(e) {
    if (e)
      return this.state.get(e);
  }
  async Broadcast(e, s, t) {
    this._broadcast(e, s, "pubSub", t);
  }
  async _broadcast(e, s, t, n) {
    let r = h.get(e);
    this.log(`Message broadcasted (${t}) to ${n || "all brokers"}`, e, s);
    let a = await Promise.resolve(s), o = { channelName: e, senderCtx: globalThis.constructor.name, senderId: l, targetId: n, msg: a, channelType: t };
    r?.cache && this.state.set(e, s), this.__bcChannel.postMessage(o);
  }
  async Publish(e, s, t) {
    this.log("Message published", e, s), await this.__notifySubscribers(e, s, l), this.braodcasts.has(e) && this._broadcast(e, s, "pubSub", t);
  }
  async nextMessage(e) {
    let s = this.__nextMessageAwaters.get(e);
    if (s)
      return s.promise;
    let t = { promise: void 0, resolve: void 0 };
    return t.promise = new Promise((n) => {
      t.resolve = n;
    }), this.__nextMessageAwaters.set(e, t), t.promise;
  }
  Subscribe(e, s, t = false, n = true) {
    let r = h.get(e), a = false;
    r && (t = r.broadcast || false, n = r.cache || true);
    let o = this.subscribers.get(e) || [], c = s;
    o.push(c), this.subscribers.set(e, o);
    let u = { channelName: e, isCached: false, dispose: () => {
      let g = this.subscribers.get(e);
      if (g == null)
        return;
      let p = g.indexOf(c);
      p !== -1 && g.splice(p, 1);
    }, publish: (g, p) => this.Publish(e, g, p), isDisposed: false };
    return t && this.__configureBroadcast(u), n && this.state.set(e, void 0), u;
  }
  bridgeRequest(e, s, t) {
    let n = this.requestListeners.get(e);
    return n ? n.handler(s, t) : Promise.resolve(void 0);
  }
  Request(e, s, t = false, n) {
    if (t) {
      this._broadcast(e, s, "req", n);
      let r = this.broadcastedRequests.get(e);
      r && r.resolve(void 0);
      let a, c = { promise: new Promise((u) => a = u), resolve: a };
      return this.broadcastedRequests.set(e, c), c.promise;
    } else {
      let r = this.requestListeners.get(e);
      return r ? r.handler(s) : Promise.resolve(void 0);
    }
  }
  Reply(e, s, t = false) {
    if (t) {
      let o = s;
      s = (c, u) => this._broadcast(e, o(c), "rep", u);
    }
    let n = this.requestListeners, r = { channelName: e, get isDisposed() {
      return n.has(e);
    }, isBroadcast: t, handler: s, dispose: void 0 };
    r.dispose = () => {
      r.isDisposed = true, this.requestListeners.get(e) === r && this.requestListeners.delete(e);
    };
    let a = this.requestListeners.get(e);
    return a && (a.isDisposed = true, console.warn("Request listener has been replaced: " + e)), this.requestListeners.set(e, r), r;
  }
  async __notifySubscribers(e, s, t) {
    let n = this.subscribers.get(e) || [], r = [];
    for (let a of n)
      a && (r.push(Promise.resolve(a(s, t))), this.log("Handler called", e, a));
    await Promise.all(r), h.get(e)?.cache && this.state.set(e, s), this.__handleAwaiter(e, s), this.log("Message handled", e, s, this);
  }
  __handleAwaiter(e, s) {
    let t = this.__nextMessageAwaters.get(e);
    t && (t.resolve(s), this.__nextMessageAwaters.delete(e));
  }
};
globalThis.BrowserMessageBroker = globalThis.BrowserMessageBroker || new f();
var i = globalThis.BrowserMessageBroker;
var T = /* @__PURE__ */ new Map();
var m = class d2 {
  constructor(e, s) {
    this.type = "pubSub";
    this.dispose = () => {
      i.subscribers.delete(this.name), T.delete(this.name);
    };
    this.name = "";
    this.settings = {};
    this.name = e, this.settings = s;
  }
  static for(e, s) {
    if (!s) {
      let n = T.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.broadcast || false, s.cache || false, s.trace || false);
    let t = new d2(e, s);
    return T.set(e, t), t;
  }
  async send(e, s) {
    i.Publish(this.name, e, s);
  }
  static async publish(e, s, t) {
    i.Publish(e, s, t);
  }
  static async broadcast(e, s, t) {
    i.Broadcast(e, s, t);
  }
  subscribe(e) {
    return i.Subscribe(this.name, e, this.settings.broadcast, this.settings.cache).dispose;
  }
  getState() {
    return i.GetState(this.name);
  }
  static GetState(e) {
    return i.GetState(e);
  }
  nextMessage() {
    return i.nextMessage(this.name);
  }
  static nextMessage(e) {
    return i.nextMessage(e);
  }
};

// suite/WebWorker/constants.ts
var PUB_SUB_REQUEST_SUBSCRIPTION_KEY = "testReq";
var PUB_SUB_RESPONSE_SUBSCRIPTION_KEY = "testResp";
var REQ_REP_CHANNEL_NAME = "reqRepChannel";

// suite/WebWorker/testWorker.ts
m.for(PUB_SUB_REQUEST_SUBSCRIPTION_KEY, {
  broadcast: true
}).subscribe((_) => {
  m.broadcast(
    PUB_SUB_RESPONSE_SUBSCRIPTION_KEY,
    { payload: "response" }
  );
});
w.for(
  REQ_REP_CHANNEL_NAME,
  {
    broadcast: true
  }
).reply((req) => {
  return { payload: req.payload + "response" };
});
postMessage("ready");
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2Jyb3dzZXItbWVzc2FnZS1icm9rZXJAMC4wLjgvbm9kZV9tb2R1bGVzL2Jyb3dzZXItbWVzc2FnZS1icm9rZXIvc3JjL1JlcVJlcENoYW5uZWwudHMiLCAiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2Jyb3dzZXItbWVzc2FnZS1icm9rZXJAMC4wLjgvbm9kZV9tb2R1bGVzL2Jyb3dzZXItbWVzc2FnZS1icm9rZXIvc3JjL0Jyb2tlci50cyIsICIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vYnJvd3Nlci1tZXNzYWdlLWJyb2tlckAwLjAuOC9ub2RlX21vZHVsZXMvYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUHViU3ViQ2hhbm5lbC50cyIsICJjb25zdGFudHMudHMiLCAidGVzdFdvcmtlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XG5pbXBvcnQgeyBDaGFubmVsU2V0dGluZ3MsIElSZXFSZXBDaGFubmVsIH0gZnJvbSBcIi4vVHlwZXNcIjtcblxuY29uc3QgcmVxUmVwQ2hhbm5lbHMgPSBuZXcgTWFwPHN0cmluZywgUmVxUmVwQ2hhbm5lbD4oKTtcblxuZXhwb3J0IGNsYXNzIFJlcVJlcENoYW5uZWw8VFJlcSA9IHVua25vd24sIFRSZXAgPSB1bmtub3duPlxuICBpbXBsZW1lbnRzIElSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+XG57XG4gIGFzeW5jIHJlcXVlc3QobXNnPzogVFJlcSk6IFByb21pc2U8VFJlcCB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiBCTUIuUmVxdWVzdDxUUmVwPihcbiAgICAgIHRoaXMubmFtZSxcbiAgICAgIG1zZyxcbiAgICAgIHRoaXMuc2V0dGluZ3MuYnJvYWRjYXN0XG4gICAgKTtcbiAgfVxuXG4gIHJlcGx5KGhhbmRsZXI6IChyZXE6IFRSZXEpID0+IFRSZXAgfCBQcm9taXNlPFRSZXA+KSB7XG4gICAgcmV0dXJuIEJNQi5SZXBseTxUUmVxLCBUUmVwPihcbiAgICAgIHRoaXMubmFtZSxcbiAgICAgIGhhbmRsZXIsXG4gICAgICB0aGlzLnNldHRpbmdzLmJyb2FkY2FzdFxuICAgICkuZGlzcG9zZTtcbiAgfVxuXG4gIHJlYWRvbmx5IHR5cGU6IFwicmVxUmVwXCIgPSBcInJlcVJlcFwiO1xuXG4gIHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3MgPSB7fTtcblxuICBkaXNwb3NlKCkge1xuICAgIEJNQi5yZXF1ZXN0TGlzdGVuZXJzLmRlbGV0ZSh0aGlzLm5hbWUpO1xuICAgIHJlcVJlcENoYW5uZWxzLmRlbGV0ZSh0aGlzLm5hbWUpO1xuICB9XG5cbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nID0gXCJcIjtcblxuICBzdGF0aWMgZm9yPFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj4oXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHNldHRpbmdzPzogQ2hhbm5lbFNldHRpbmdzXG4gICk6IFJlcVJlcENoYW5uZWw8VFJlcSwgVFJlcD4ge1xuICAgIGlmICghc2V0dGluZ3MpIHtcbiAgICAgIGNvbnN0IGMgPSByZXFSZXBDaGFubmVscy5nZXQobmFtZSk7XG4gICAgICBpZiAoIWMpIHRocm93IEVycm9yKFwiQ2FuJ3QgZmluZCBjaGFubmVsIHNldHRpbmdzXCIpO1xuICAgICAgcmV0dXJuIGMgYXMgUmVxUmVwQ2hhbm5lbDxUUmVxLCBUUmVwPjtcbiAgICB9XG5cbiAgICBCTUIuQ29uZmlndXJlQ2hhbm5lbChcbiAgICAgIG5hbWUsXG4gICAgICBzZXR0aW5ncy5icm9hZGNhc3QgfHwgZmFsc2UsXG4gICAgICBzZXR0aW5ncy5jYWNoZSB8fCBmYWxzZSxcbiAgICAgIHNldHRpbmdzLnRyYWNlIHx8IGZhbHNlXG4gICAgKTtcbiAgICBjb25zdCBjaGFubmVsID0gbmV3IFJlcVJlcENoYW5uZWw8VFJlcSwgVFJlcD4oXG4gICAgICBuYW1lLFxuICAgICAgc2V0dGluZ3NcbiAgICApO1xuICAgIHJlcVJlcENoYW5uZWxzLnNldChuYW1lLCBjaGFubmVsKTtcbiAgICByZXR1cm4gY2hhbm5lbDtcbiAgfVxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBzZXR0aW5nczogQ2hhbm5lbFNldHRpbmdzXG4gICkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICB9XG59XG4iLCAiaW1wb3J0IHtcbiAgQ2hhbm5lbFR5cGUsXG4gIElCcm9hZGNhc3RFbnZlbG9wZSxcbiAgSUJyb2FkY2FzdFN5bmNFbnZlbG9wZSxcbiAgSUJyb2tlcixcbiAgSUJyb2tlclN0YXRlLFxuICBDaGFubmVsU2V0dGluZ3MsXG4gIFJlcVN1YnNjcmlwdGlvbixcbiAgU3Vic2NyaXB0aW9uLFxuICBUSGFuZGxlcixcbn0gZnJvbSBcIi4vVHlwZXNcIjtcblxuY29uc3QgQlJPQURDQVNUX1NZTkMgPSBcImJyb2FkY2FzdC1zeW5jXCI7XG5jb25zdCBCUk9XU0VSX01FU1NBR0VfQlJPS0VSID0gXCJicm93c2VyLW1lc3NhZ2UtYnJva2VyXCI7XG5cbmZ1bmN0aW9uIGlzQnJvYWRjYXN0U3luYyhcbiAgZTogSUJyb2FkY2FzdEVudmVsb3BlXG4pOiBlIGlzIElCcm9hZGNhc3RTeW5jRW52ZWxvcGUge1xuICByZXR1cm4gZS5jaGFubmVsTmFtZSA9PT0gQlJPQURDQVNUX1NZTkM7XG59XG5cbmZ1bmN0aW9uIGlzU3luY1JlcShlOiBJQnJvYWRjYXN0RW52ZWxvcGUpIHtcbiAgcmV0dXJuIGUuc2VuZGVySWQgIT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0SWQgPT0gdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gaXNTeW5jUmVzcChlOiBJQnJvYWRjYXN0RW52ZWxvcGUpIHtcbiAgcmV0dXJuIGUuc2VuZGVySWQgIT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0SWQgIT0gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgY29uc3Qgc2VuZGVySWQgPSBNYXRoLnJhbmRvbSgpXG4gIC50b1N0cmluZygzNilcbiAgLnN1YnN0cmluZygyLCA5KTtcblxuZnVuY3Rpb24gZGVib3VuY2U8VCBleHRlbmRzIEZ1bmN0aW9uPihcbiAgZnVuYzogVCxcbiAgdGltZW91dCA9IDFcbikge1xuICBsZXQgdGltZXI6IG51bWJlcjtcbiAgcmV0dXJuICguLi5hcmdzOiB1bmtub3duW10pID0+IHtcbiAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgIHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBmdW5jKC4uLmFyZ3MpO1xuICAgIH0sIHRpbWVvdXQpO1xuICB9O1xufVxuXG5jb25zdCBjaGFubmVsU2V0dGluZ3MgPSBuZXcgTWFwPHN0cmluZywgQ2hhbm5lbFNldHRpbmdzPigpO1xuXG5jbGFzcyBCcm9rZXIgaW1wbGVtZW50cyBJQnJva2VyIHtcbiAgdHJhY2U6IGJvb2xlYW4gPSBmYWxzZTtcbiAgc2VuZGVySWQgPSBzZW5kZXJJZDtcbiAgc3RhdGUgPSBuZXcgTWFwPHN0cmluZywgYW55PigpO1xuICBzdWJzY3JpYmVycyA9IG5ldyBNYXA8c3RyaW5nLCBUSGFuZGxlcltdPigpO1xuICBicmFvZGNhc3RzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIHByaXZhdGUgX19iY0NoYW5uZWwgPSBuZXcgQnJvYWRjYXN0Q2hhbm5lbChcbiAgICBCUk9XU0VSX01FU1NBR0VfQlJPS0VSXG4gICk7XG5cbiAgcHJpdmF0ZSBsb2coXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIGNoYW5uZWw6IHN0cmluZyxcbiAgICAuLi5kYXRhOiB1bmtub3duW11cbiAgKSB7XG4gICAgaWYgKHRoaXMudHJhY2UgfHwgY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsKT8udHJhY2UpXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYFske2dsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZX0oJHt0aGlzLnNlbmRlcklkfSktJHtjaGFubmVsfV0gJHttZXNzYWdlfWAsXG4gICAgICAgIGRhdGFcbiAgICAgICk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9fYmNDaGFubmVsLm9ubWVzc2FnZSA9XG4gICAgICB0aGlzLmhhbmRsZUJyb2FkY2FzdC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX19iY0NoYW5uZWwub25tZXNzYWdlZXJyb3IgPVxuICAgICAgdGhpcy5oYW5kbGVCcm9hZGNhc3RFcnJvci5iaW5kKHRoaXMpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLl9fc2VuZEJyb2tlclN0YXRlKHVuZGVmaW5lZCwgdW5kZWZpbmVkKTsgLy8gYWx3YXlzIHNlbmQgaW5pdGlhbCBzeW5jIHJlcXVlc3RcbiAgICB9LCAwKTtcblxuICAgIHRoaXMuc2VuZEJyb2tlclN0YXRlID0gZGVib3VuY2UoXG4gICAgICB0aGlzLl9fc2VuZEJyb2tlclN0YXRlLmJpbmQodGhpcyksXG4gICAgICAyXG4gICAgKTtcbiAgfVxuXG4gIENvbmZpZ3VyZUNoYW5uZWwoXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcbiAgICBicm9hZGNhc3Q6IGJvb2xlYW4sXG4gICAgY2FjaGU6IGJvb2xlYW4sXG4gICAgdHJhY2U6IGJvb2xlYW5cbiAgKTogdm9pZCB7XG4gICAgY2hhbm5lbFNldHRpbmdzLnNldChjaGFubmVsTmFtZSwge1xuICAgICAgYnJvYWRjYXN0OiBicm9hZGNhc3QsXG4gICAgICBjYWNoZTogY2FjaGUsXG4gICAgICB0cmFjZSxcbiAgICB9KTtcblxuICAgIGlmIChjYWNoZSkgdGhpcy5zdGF0ZS5zZXQoY2hhbm5lbE5hbWUsIHVuZGVmaW5lZCk7XG4gICAgaWYgKGJyb2FkY2FzdCkgdGhpcy5icmFvZGNhc3RzLmFkZChjaGFubmVsTmFtZSk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUJyb2FkY2FzdEVycm9yKFxuICAgIGV2OiBNZXNzYWdlRXZlbnQ8SUJyb2FkY2FzdEVudmVsb3BlPlxuICApIHtcbiAgICB0aHJvdyBFcnJvcihcIkJST0FEQ0FTVCBGQUlMRUQ6IFwiICsgZXYuZGF0YSk7XG4gIH1cblxuICBwcml2YXRlIHNlbmRCcm9rZXJTdGF0ZTogKFxuICAgIHRhcmdldElkPzogc3RyaW5nLFxuICAgIGZpbHRlckJyb2FkY2FzdHM/OiBzdHJpbmdbXVxuICApID0+IHZvaWQ7XG4gIHByaXZhdGUgX19zZW5kQnJva2VyU3RhdGUoXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmcsXG4gICAgZmlsdGVyQnJvYWRjYXN0cz86IHN0cmluZ1tdXG4gICkge1xuICAgIGxldCBjdXJyZW50QnJvYWRjYXN0cyA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLmJyYW9kY2FzdHMua2V5cygpXG4gICAgKTtcblxuICAgIGlmIChmaWx0ZXJCcm9hZGNhc3RzICYmIGZpbHRlckJyb2FkY2FzdHMubGVuZ3RoID4gMCkge1xuICAgICAgY3VycmVudEJyb2FkY2FzdHMgPSBjdXJyZW50QnJvYWRjYXN0cy5maWx0ZXIoKGspID0+XG4gICAgICAgIGZpbHRlckJyb2FkY2FzdHMuaW5jbHVkZXMoaylcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYXZhaWxhYmxlU3RhdGU6IHsgW3g6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgZm9yIChjb25zdCB4IG9mIHRoaXMuc3RhdGUpIHtcbiAgICAgIGlmICgheFsxXSkgY29udGludWU7XG4gICAgICBpZiAoIWN1cnJlbnRCcm9hZGNhc3RzLmluY2x1ZGVzKHhbMF0pKSBjb250aW51ZTtcbiAgICAgIGF2YWlsYWJsZVN0YXRlW3hbMF1dID0geFsxXTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0ZTogSUJyb2tlclN0YXRlID0ge1xuICAgICAgaWQ6IHNlbmRlcklkLFxuICAgICAgYXZhaWxhYmxlU3RhdGUsXG4gICAgICBicm9hZGNhc3RzOiBjdXJyZW50QnJvYWRjYXN0cyxcbiAgICB9O1xuXG4gICAgY29uc3QgZXY6IElCcm9hZGNhc3RTeW5jRW52ZWxvcGUgPSB7XG4gICAgICBjaGFubmVsTmFtZTogQlJPQURDQVNUX1NZTkMsXG4gICAgICBzZW5kZXJDdHg6IGdsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZSxcbiAgICAgIHNlbmRlcklkLFxuICAgICAgdGFyZ2V0SWQsXG4gICAgICBtc2c6IHN0YXRlLFxuICAgICAgY2hhbm5lbFR5cGU6IFwic3luY1wiLFxuICAgIH07XG5cbiAgICB0aGlzLl9fYmNDaGFubmVsLnBvc3RNZXNzYWdlKGV2KTtcblxuICAgIGlmICh0YXJnZXRJZCA9PSB1bmRlZmluZWQpXG4gICAgICB0aGlzLmxvZyhcIkJyb2FkY2FzdCBzeW5jIHJlcXVlc3RlZFwiLCBcIlwiLCB7XG4gICAgICAgIGJyb2tlclN0YXRlOiBzdGF0ZSxcbiAgICAgIH0pO1xuICAgIGVsc2VcbiAgICAgIHRoaXMubG9nKFwiQnJvYWRjYXN0IHN5bmMgcmVzcG9uZGVkXCIsIFwiXCIsIHtcbiAgICAgICAgdGFyZ2V0SWQsXG4gICAgICAgIGJyb2tlclN0YXRlOiBzdGF0ZSxcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVCcm9hZGNhc3RTeW5jKGV2OiBJQnJvYWRjYXN0U3luY0VudmVsb3BlKSB7XG4gICAgaWYgKGlzU3luY1JlcShldikpXG4gICAgICByZXR1cm4gdGhpcy5zZW5kQnJva2VyU3RhdGUoXG4gICAgICAgIGV2LnNlbmRlcklkLFxuICAgICAgICBldi5tc2cuYnJvYWRjYXN0c1xuICAgICAgKTtcbiAgICBpZiAoaXNTeW5jUmVzcChldikpIHtcbiAgICAgIGZvciAoY29uc3QgcyBvZiBPYmplY3QuZW50cmllcyhcbiAgICAgICAgZXYubXNnLmF2YWlsYWJsZVN0YXRlXG4gICAgICApKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aGlzLmJyYW9kY2FzdHMuaGFzKHNbMF0pICYmXG4gICAgICAgICAgdGhpcy5zdGF0ZS5oYXMoc1swXSkgJiZcbiAgICAgICAgICB0aGlzLnN0YXRlLmdldChzWzBdKSA9PSB1bmRlZmluZWRcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5fX25vdGlmeVN1YnNjcmliZXJzKHNbMF0sIHNbMV0sIGV2LnNlbmRlcklkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubG9nKFxuICAgICAgICAgIFwiQnJvYWRjYXN0IHN5bmMgcmVzcG9uY2UgaGFuZGxlZFwiLFxuICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgZXYubXNnXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVCcm9hZGNhc3QoXG4gICAgZXY6IE1lc3NhZ2VFdmVudDxJQnJvYWRjYXN0RW52ZWxvcGU+XG4gICkge1xuICAgIHRoaXMubG9nKFxuICAgICAgXCJCcm9hZGNhc3QgcmVjZWl2ZWRcIixcbiAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWUsXG4gICAgICBldi5kYXRhXG4gICAgKTtcblxuICAgIGlmIChcbiAgICAgIGV2LmRhdGEudGFyZ2V0SWQgIT0gdW5kZWZpbmVkICYmXG4gICAgICBldi5kYXRhLnRhcmdldElkICE9PSBzZW5kZXJJZFxuICAgICkge1xuICAgICAgdGhpcy5sb2coXG4gICAgICAgIFwiQnJvYWRjYXN0IGlnbm9yZWQgKGRpZmZlcmVudCB0YXJnZXRJZClcIixcbiAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZVxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoaXNCcm9hZGNhc3RTeW5jKGV2LmRhdGEpKVxuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlQnJvYWRjYXN0U3luYyhldi5kYXRhKTtcblxuICAgIHN3aXRjaCAoZXYuZGF0YS5jaGFubmVsVHlwZSkge1xuICAgICAgY2FzZSBcInB1YlN1YlwiOlxuICAgICAgICB0aGlzLl9fbm90aWZ5U3Vic2NyaWJlcnMoXG4gICAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZSxcbiAgICAgICAgICBldi5kYXRhLm1zZyxcbiAgICAgICAgICBldi5kYXRhLnNlbmRlcklkXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInJlcVwiOlxuICAgICAgICB0aGlzLmJyaWRnZVJlcXVlc3QoXG4gICAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZSxcbiAgICAgICAgICBldi5kYXRhLm1zZyxcbiAgICAgICAgICBldi5kYXRhLnNlbmRlcklkXG4gICAgICAgICk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInJlcFwiOlxuICAgICAgICBjb25zdCByZXEgPSB0aGlzLmJyb2FkY2FzdGVkUmVxdWVzdHMuZ2V0KFxuICAgICAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFyZXEpIHJldHVybjtcblxuICAgICAgICByZXEucmVzb2x2ZShldi5kYXRhLm1zZyk7XG4gICAgICAgIHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5kZWxldGUoXG4gICAgICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZVxuICAgICAgICApO1xuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHRoaXMubG9nKFxuICAgICAgXCJCcm9hZGNhc3QgaGFuZGxlZFwiLFxuICAgICAgZXYuZGF0YS5jaGFubmVsTmFtZSxcbiAgICAgIGV2LmRhdGFcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEJyaWRnZSBwdWIvc3ViIG1lc3NhZ2VzIHRvIGJyb2FkY2FzdCBjaGFubmVsXG4gICAqIEBwYXJhbSBzdWJzS2V5XG4gICAqIEByZXR1cm5zIHtTdWJzY3JpcHRpb259XG4gICAqL1xuICBwcml2YXRlIF9fY29uZmlndXJlQnJvYWRjYXN0KFxuICAgIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uPGFueT5cbiAgKTogdm9pZCB7XG4gICAgaWYgKCFzdWJzY3JpcHRpb24uY2hhbm5lbE5hbWUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBzdWJzY3JpcHRpb25gKTtcbiAgICB9XG4gICAgdGhpcy5icmFvZGNhc3RzLmFkZChzdWJzY3JpcHRpb24uY2hhbm5lbE5hbWUpO1xuICAgIGNvbnN0IG9yaWdpbmFsRGlzcG9zZSA9IHN1YnNjcmlwdGlvbi5kaXNwb3NlO1xuICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlID0gKCkgPT4ge1xuICAgICAgb3JpZ2luYWxEaXNwb3NlKCk7XG4gICAgICB0aGlzLmJyYW9kY2FzdHMuZGVsZXRlKHN1YnNjcmlwdGlvbi5jaGFubmVsTmFtZSk7XG4gICAgfTtcbiAgICBzdWJzY3JpcHRpb24uaXNCcm9hZGNhc3QgPSB0cnVlO1xuXG4gICAgdGhpcy5zZW5kQnJva2VyU3RhdGUoKTtcbiAgfVxuXG4gIEdldFN0YXRlPFQ+KHN1YnNLZXk6IHN0cmluZyk6IFQgfCB1bmRlZmluZWQge1xuICAgIGlmIChzdWJzS2V5KSB7XG4gICAgICByZXR1cm4gdGhpcy5zdGF0ZS5nZXQoc3Vic0tleSkgYXMgVDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBCcm9hZGNhc3QoXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcbiAgICBtc2c6IHVua25vd24sXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcbiAgKSB7XG4gICAgdGhpcy5fYnJvYWRjYXN0KGNoYW5uZWxOYW1lLCBtc2csIFwicHViU3ViXCIsIHRhcmdldElkKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgX2Jyb2FkY2FzdChcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxuICAgIG1zZzogdW5rbm93bixcbiAgICBjaGFubmVsVHlwZTogQ2hhbm5lbFR5cGUsXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcbiAgKSB7XG4gICAgY29uc3Qgc2V0dGluZ3MgPSBjaGFubmVsU2V0dGluZ3MuZ2V0KGNoYW5uZWxOYW1lKTtcblxuICAgIHRoaXMubG9nKFxuICAgICAgYE1lc3NhZ2UgYnJvYWRjYXN0ZWQgKCR7Y2hhbm5lbFR5cGV9KSB0byAke1xuICAgICAgICB0YXJnZXRJZCB8fCBcImFsbCBicm9rZXJzXCJcbiAgICAgIH1gLFxuICAgICAgY2hhbm5lbE5hbWUsXG4gICAgICBtc2dcbiAgICApO1xuXG4gICAgY29uc3QgX21zZyA9IGF3YWl0IFByb21pc2UucmVzb2x2ZShtc2cpO1xuICAgIGNvbnN0IGVudmVsb3BlOiBJQnJvYWRjYXN0RW52ZWxvcGUgPSB7XG4gICAgICBjaGFubmVsTmFtZTogY2hhbm5lbE5hbWUsXG4gICAgICBzZW5kZXJDdHg6IGdsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZSxcbiAgICAgIHNlbmRlcklkOiBzZW5kZXJJZCxcbiAgICAgIHRhcmdldElkOiB0YXJnZXRJZCxcbiAgICAgIG1zZzogX21zZyxcbiAgICAgIGNoYW5uZWxUeXBlLFxuICAgIH07XG5cbiAgICBpZiAoc2V0dGluZ3M/LmNhY2hlKSB0aGlzLnN0YXRlLnNldChjaGFubmVsTmFtZSwgbXNnKTtcblxuICAgIHRoaXMuX19iY0NoYW5uZWwucG9zdE1lc3NhZ2UoZW52ZWxvcGUpO1xuICB9XG5cbiAgYXN5bmMgUHVibGlzaChcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxuICAgIG1zZzogdW5rbm93bixcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xuICApIHtcbiAgICB0aGlzLmxvZyhgTWVzc2FnZSBwdWJsaXNoZWRgLCBjaGFubmVsTmFtZSwgbXNnKTtcbiAgICBhd2FpdCB0aGlzLl9fbm90aWZ5U3Vic2NyaWJlcnMoXG4gICAgICBjaGFubmVsTmFtZSxcbiAgICAgIG1zZyxcbiAgICAgIHNlbmRlcklkXG4gICAgKTtcblxuICAgIGlmICghdGhpcy5icmFvZGNhc3RzLmhhcyhjaGFubmVsTmFtZSkpIHJldHVybjtcblxuICAgIHRoaXMuX2Jyb2FkY2FzdChjaGFubmVsTmFtZSwgbXNnLCBcInB1YlN1YlwiLCB0YXJnZXRJZCk7XG4gIH1cblxuICBwcml2YXRlIF9fbmV4dE1lc3NhZ2VBd2F0ZXJzID0gbmV3IE1hcDxcbiAgICBzdHJpbmcsXG4gICAge1xuICAgICAgcHJvbWlzZTogUHJvbWlzZTx1bmtub3duPjtcbiAgICAgIHJlc29sdmU6IChtc2c6IHVua25vd24pID0+IHVua25vd247XG4gICAgfVxuICA+KCk7XG5cbiAgYXN5bmMgbmV4dE1lc3NhZ2U8VCA9IHVua25vd24+KFxuICAgIHN1YnNLZXk6IHN0cmluZ1xuICApOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCBhID0gdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5nZXQoc3Vic0tleSk7XG4gICAgaWYgKGEpIHJldHVybiBhLnByb21pc2UgYXMgUHJvbWlzZTxUPjtcblxuICAgIGNvbnN0IG5ld0F3YWl0ZXI6IHtcbiAgICAgIHByb21pc2U6IFByb21pc2U8dW5rbm93bj47XG4gICAgICByZXNvbHZlOiAobXNnOiB1bmtub3duKSA9PiB2b2lkO1xuICAgIH0gPSB7XG4gICAgICBwcm9taXNlOiB1bmRlZmluZWQgYXMgdW5rbm93biBhcyBQcm9taXNlPFQ+LFxuICAgICAgcmVzb2x2ZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgKFxuICAgICAgICBtc2c6IHVua25vd25cbiAgICAgICkgPT4gdm9pZCxcbiAgICB9O1xuICAgIG5ld0F3YWl0ZXIucHJvbWlzZSA9IG5ldyBQcm9taXNlKFxuICAgICAgKHJlczogKG1zZzogdW5rbm93bikgPT4gdm9pZCkgPT4ge1xuICAgICAgICBuZXdBd2FpdGVyLnJlc29sdmUgPSByZXM7XG4gICAgICB9XG4gICAgKTtcblxuICAgIHRoaXMuX19uZXh0TWVzc2FnZUF3YXRlcnMuc2V0KHN1YnNLZXksIG5ld0F3YWl0ZXIpO1xuXG4gICAgcmV0dXJuIG5ld0F3YWl0ZXIucHJvbWlzZSBhcyBQcm9taXNlPFQ+O1xuICB9XG5cbiAgU3Vic2NyaWJlPFQ+KFxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcj86IFRIYW5kbGVyPFQ+LFxuICAgIGJyb2FkY2FzdCA9IGZhbHNlLFxuICAgIGNhY2hlID0gdHJ1ZVxuICApOiBTdWJzY3JpcHRpb248VD4ge1xuICAgIGNvbnN0IHNldHRpbmdzID0gY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsTmFtZSk7XG4gICAgY29uc3Qgc2V0dGluZ3NPdmVycmlkZW4gPSBmYWxzZTtcbiAgICBpZiAoc2V0dGluZ3MpIHtcbiAgICAgIGJyb2FkY2FzdCA9IHNldHRpbmdzLmJyb2FkY2FzdCB8fCBmYWxzZTtcbiAgICAgIGNhY2hlID0gc2V0dGluZ3MuY2FjaGUgfHwgdHJ1ZTtcbiAgICAgIHNldHRpbmdzT3ZlcnJpZGVuO1xuICAgIH1cblxuICAgIGNvbnN0IHN1YnMgPSB0aGlzLnN1YnNjcmliZXJzLmdldChjaGFubmVsTmFtZSkgfHwgW107XG4gICAgY29uc3QgaGRsID0gaGFuZGxlciBhcyAobXNnOiB1bmtub3duKSA9PiB2b2lkO1xuICAgIHN1YnMucHVzaChoZGwpO1xuICAgIHRoaXMuc3Vic2NyaWJlcnMuc2V0KGNoYW5uZWxOYW1lLCBzdWJzKTtcblxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uPFQ+ID0ge1xuICAgICAgY2hhbm5lbE5hbWU6IGNoYW5uZWxOYW1lLFxuICAgICAgaXNDYWNoZWQ6IGZhbHNlLFxuICAgICAgZGlzcG9zZTogKCkgPT4ge1xuICAgICAgICBjb25zdCBfc3VicyA9IHRoaXMuc3Vic2NyaWJlcnMuZ2V0KGNoYW5uZWxOYW1lKTtcblxuICAgICAgICBpZiAoX3N1YnMgPT0gdW5kZWZpbmVkKSByZXR1cm47XG4gICAgICAgIGNvbnN0IGkgPSBfc3Vicy5pbmRleE9mKGhkbCk7XG5cbiAgICAgICAgaWYgKGkgPT09IC0xKSByZXR1cm47XG4gICAgICAgIF9zdWJzLnNwbGljZShpLCAxKTtcbiAgICAgIH0sXG4gICAgICBwdWJsaXNoOiAobXNnLCB0YXJnZXRJZD86IHN0cmluZykgPT5cbiAgICAgICAgdGhpcy5QdWJsaXNoKGNoYW5uZWxOYW1lLCBtc2csIHRhcmdldElkKSxcbiAgICAgIGlzRGlzcG9zZWQ6IGZhbHNlLFxuICAgIH07XG5cbiAgICBpZiAoYnJvYWRjYXN0KSB0aGlzLl9fY29uZmlndXJlQnJvYWRjYXN0KHN1YnNjcmlwdGlvbik7XG4gICAgaWYgKGNhY2hlKSB0aGlzLnN0YXRlLnNldChjaGFubmVsTmFtZSwgdW5kZWZpbmVkKTtcblxuICAgIHJldHVybiBzdWJzY3JpcHRpb247XG4gIH1cblxuICBwcml2YXRlIGJyaWRnZVJlcXVlc3QoXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcbiAgICByZXF1ZXN0RGF0YTogdW5rbm93bixcbiAgICBzZW5kZXJJZDogc3RyaW5nXG4gICkge1xuICAgIGNvbnN0IGxpc3RlbmVyID0gdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLmdldChjaGFubmVsTmFtZSk7XG5cbiAgICBpZiAoIWxpc3RlbmVyKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7XG5cbiAgICByZXR1cm4gbGlzdGVuZXIuaGFuZGxlcihcbiAgICAgIHJlcXVlc3REYXRhLFxuICAgICAgc2VuZGVySWRcbiAgICApIGFzIFByb21pc2U8dW5rbm93bj47XG4gIH1cblxuICBSZXF1ZXN0PFRSZXAgPSB1bmtub3duPihcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxuICAgIHJlcXVlc3REYXRhOiB1bmtub3duLFxuICAgIGJyb2FkY2FzdCA9IGZhbHNlLFxuICAgIHRhcmdldElkPzogc3RyaW5nXG4gICk6IFByb21pc2U8VFJlcD4gfCBQcm9taXNlPHVuZGVmaW5lZD4ge1xuICAgIGlmICghYnJvYWRjYXN0KSB7XG4gICAgICBjb25zdCBsaXN0ZW5lciA9XG4gICAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xuICAgICAgaWYgKCFsaXN0ZW5lcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgcmV0dXJuIGxpc3RlbmVyLmhhbmRsZXIocmVxdWVzdERhdGEpIGFzIFByb21pc2U8VFJlcD47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2Jyb2FkY2FzdChcbiAgICAgICAgY2hhbm5lbE5hbWUsXG4gICAgICAgIHJlcXVlc3REYXRhLFxuICAgICAgICBcInJlcVwiLFxuICAgICAgICB0YXJnZXRJZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJlcSA9IHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5nZXQoY2hhbm5lbE5hbWUpO1xuICAgICAgaWYgKHJlcSkgcmVxLnJlc29sdmUodW5kZWZpbmVkKTtcblxuICAgICAgbGV0IHJlc29sdmUgPSB1bmRlZmluZWQgYXMgdW5rbm93biBhcyAoXG4gICAgICAgIHI6IHVua25vd25cbiAgICAgICkgPT4gdm9pZDtcbiAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZTxUUmVwPihcbiAgICAgICAgKHJlcykgPT4gKHJlc29sdmUgPSByZXMgYXMgKHI6IHVua25vd24pID0+IHZvaWQpXG4gICAgICApO1xuICAgICAgY29uc3QgYnJlcSA9IHtcbiAgICAgICAgcHJvbWlzZSxcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgIH07XG4gICAgICB0aGlzLmJyb2FkY2FzdGVkUmVxdWVzdHMuc2V0KGNoYW5uZWxOYW1lLCBicmVxKTtcbiAgICAgIHJldHVybiBicmVxLnByb21pc2U7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgYnJvYWRjYXN0ZWRSZXF1ZXN0cyA9IG5ldyBNYXA8XG4gICAgc3RyaW5nLFxuICAgIHtcbiAgICAgIHByb21pc2U6IFByb21pc2U8dW5rbm93bj47XG4gICAgICByZXNvbHZlOiAocjogdW5rbm93bikgPT4gdm9pZDtcbiAgICB9XG4gID4oKTtcblxuICBSZXBseTxUUmVxID0gdW5rbm93biwgVFJlcCA9IHVua25vd24+KFxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcjogKHJlcTogVFJlcSkgPT4gVFJlcCxcbiAgICBicm9hZGNhc3QgPSBmYWxzZVxuICApIHtcbiAgICBpZiAoYnJvYWRjYXN0KSB7XG4gICAgICBjb25zdCBvcmlnSGFuZGxlciA9IGhhbmRsZXI7XG4gICAgICBoYW5kbGVyID0gKChtc2c6IFRSZXEsIHRhcmdldElkOiBzdHJpbmcpID0+XG4gICAgICAgIHRoaXMuX2Jyb2FkY2FzdChcbiAgICAgICAgICBjaGFubmVsTmFtZSxcbiAgICAgICAgICBvcmlnSGFuZGxlcihtc2cpLFxuICAgICAgICAgIFwicmVwXCIsXG4gICAgICAgICAgdGFyZ2V0SWRcbiAgICAgICAgKSkgYXMgdW5rbm93biBhcyAocmVxOiBUUmVxKSA9PiBUUmVwO1xuICAgIH1cbiAgICBjb25zdCByZXFMaXN0ZW5lcnMgPSB0aGlzLnJlcXVlc3RMaXN0ZW5lcnM7XG4gICAgY29uc3Qgc3ViczogUmVxU3Vic2NyaXB0aW9uID0ge1xuICAgICAgY2hhbm5lbE5hbWUsXG4gICAgICBnZXQgaXNEaXNwb3NlZCgpIHtcbiAgICAgICAgcmV0dXJuIHJlcUxpc3RlbmVycy5oYXMoY2hhbm5lbE5hbWUpO1xuICAgICAgfSxcbiAgICAgIGlzQnJvYWRjYXN0OiBicm9hZGNhc3QsXG4gICAgICBoYW5kbGVyOiBoYW5kbGVyIGFzIChyOiB1bmtub3duKSA9PiB1bmtub3duLFxuICAgICAgZGlzcG9zZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgKCkgPT4gdm9pZCxcbiAgICB9O1xuXG4gICAgc3Vicy5kaXNwb3NlID0gKCkgPT4ge1xuICAgICAgc3Vicy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5lciA9XG4gICAgICAgIHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xuICAgICAgaWYgKGN1cnJlbnRMaXN0ZW5lciA9PT0gc3VicylcbiAgICAgICAgdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLmRlbGV0ZShjaGFubmVsTmFtZSk7XG4gICAgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5lciA9XG4gICAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuZ2V0KGNoYW5uZWxOYW1lKTtcbiAgICBpZiAoY3VycmVudExpc3RlbmVyKSB7XG4gICAgICBjdXJyZW50TGlzdGVuZXIuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIFwiUmVxdWVzdCBsaXN0ZW5lciBoYXMgYmVlbiByZXBsYWNlZDogXCIgKyBjaGFubmVsTmFtZVxuICAgICAgKTtcbiAgICB9XG4gICAgdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLnNldChjaGFubmVsTmFtZSwgc3Vicyk7XG4gICAgcmV0dXJuIHN1YnM7XG4gIH1cblxuICByZXF1ZXN0TGlzdGVuZXJzID0gbmV3IE1hcDxzdHJpbmcsIFJlcVN1YnNjcmlwdGlvbj4oKTtcblxuICBwcml2YXRlIGFzeW5jIF9fbm90aWZ5U3Vic2NyaWJlcnMoXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcbiAgICBtc2c6IHVua25vd24sXG4gICAgc0lkOiBzdHJpbmdcbiAgKSB7XG4gICAgY29uc3QgaGFuZGxlcnMgPVxuICAgICAgdGhpcy5zdWJzY3JpYmVycy5nZXQoY2hhbm5lbE5hbWUpIHx8IFtdO1xuXG4gICAgY29uc3QgYWxsU3Vic2NyaWJlcnNQcm9taXNlczogUHJvbWlzZTx2b2lkPltdID0gW107XG4gICAgZm9yIChjb25zdCBoIG9mIGhhbmRsZXJzKSB7XG4gICAgICBpZiAoIWgpIGNvbnRpbnVlO1xuICAgICAgYWxsU3Vic2NyaWJlcnNQcm9taXNlcy5wdXNoKFxuICAgICAgICBQcm9taXNlLnJlc29sdmUoaChtc2csIHNJZCkpXG4gICAgICApO1xuICAgICAgdGhpcy5sb2coXCJIYW5kbGVyIGNhbGxlZFwiLCBjaGFubmVsTmFtZSwgaCk7XG4gICAgfVxuXG4gICAgYXdhaXQgUHJvbWlzZS5hbGwoYWxsU3Vic2NyaWJlcnNQcm9taXNlcyk7XG5cbiAgICBpZiAoY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsTmFtZSk/LmNhY2hlKVxuICAgICAgdGhpcy5zdGF0ZS5zZXQoY2hhbm5lbE5hbWUsIG1zZyk7XG5cbiAgICB0aGlzLl9faGFuZGxlQXdhaXRlcihjaGFubmVsTmFtZSwgbXNnKTtcblxuICAgIHRoaXMubG9nKFwiTWVzc2FnZSBoYW5kbGVkXCIsIGNoYW5uZWxOYW1lLCBtc2csIHRoaXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfX2hhbmRsZUF3YWl0ZXIoc3Vic0tleTogc3RyaW5nLCBtc2c6IHVua25vd24pIHtcbiAgICBjb25zdCBhd2FpdGVyID0gdGhpcy5fX25leHRNZXNzYWdlQXdhdGVycy5nZXQoc3Vic0tleSk7XG4gICAgaWYgKCFhd2FpdGVyKSByZXR1cm47XG5cbiAgICBhd2FpdGVyLnJlc29sdmUobXNnKTtcblxuICAgIHRoaXMuX19uZXh0TWVzc2FnZUF3YXRlcnMuZGVsZXRlKHN1YnNLZXkpO1xuICB9XG59XG5cbmdsb2JhbFRoaXMuQnJvd3Nlck1lc3NhZ2VCcm9rZXIgPVxuICBnbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyIHx8IG5ldyBCcm9rZXIoKTtcblxuZXhwb3J0IGNvbnN0IEJNQiA9IGdsb2JhbFRoaXMuQnJvd3Nlck1lc3NhZ2VCcm9rZXI7XG5leHBvcnQgKiBmcm9tIFwiLi9QdWJTdWJDaGFubmVsXCI7XG5leHBvcnQgKiBmcm9tIFwiLi9SZXFSZXBDaGFubmVsXCI7XG4iLCAiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XG5pbXBvcnQge1xuICBEaXNwb3NlcixcbiAgQ2hhbm5lbFNldHRpbmdzLFxuICBJUHViU3ViQ2hhbm5lbCxcbiAgVEhhbmRsZXIsXG59IGZyb20gXCIuL1R5cGVzXCI7XG5cbmNvbnN0IHB1YlN1YkNoYW5uZWxzID0gbmV3IE1hcDxzdHJpbmcsIFB1YlN1YkNoYW5uZWw+KCk7XG5cbmV4cG9ydCBjbGFzcyBQdWJTdWJDaGFubmVsPFRNc2cgPSBhbnk+XG4gIGltcGxlbWVudHMgSVB1YlN1YkNoYW5uZWw8VE1zZz5cbntcbiAgc3RhdGljIGZvcjxUTXNnPihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgc2V0dGluZ3M/OiBDaGFubmVsU2V0dGluZ3NcbiAgKTogUHViU3ViQ2hhbm5lbDxUTXNnPiB7XG4gICAgaWYgKCFzZXR0aW5ncykge1xuICAgICAgY29uc3QgYyA9IHB1YlN1YkNoYW5uZWxzLmdldChuYW1lKTtcbiAgICAgIGlmICghYykgdGhyb3cgRXJyb3IoXCJDYW4ndCBmaW5kIGNoYW5uZWwgc2V0dGluZ3NcIik7XG4gICAgICByZXR1cm4gYyBhcyBQdWJTdWJDaGFubmVsPFRNc2c+O1xuICAgIH1cblxuICAgIEJNQi5Db25maWd1cmVDaGFubmVsKFxuICAgICAgbmFtZSxcbiAgICAgIHNldHRpbmdzLmJyb2FkY2FzdCB8fCBmYWxzZSxcbiAgICAgIHNldHRpbmdzLmNhY2hlIHx8IGZhbHNlLFxuICAgICAgc2V0dGluZ3MudHJhY2UgfHwgZmFsc2VcbiAgICApO1xuICAgIGNvbnN0IGNoYW5uZWwgPSBuZXcgUHViU3ViQ2hhbm5lbDxUTXNnPihuYW1lLCBzZXR0aW5ncyk7XG4gICAgcHViU3ViQ2hhbm5lbHMuc2V0KG5hbWUsIGNoYW5uZWwpO1xuICAgIHJldHVybiBjaGFubmVsO1xuICB9XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgc2V0dGluZ3M6IENoYW5uZWxTZXR0aW5nc1xuICApIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgfVxuXG4gIGFzeW5jIHNlbmQobXNnOiBUTXNnLCB0YXJnZXRJZD86IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIEJNQi5QdWJsaXNoKHRoaXMubmFtZSwgbXNnLCB0YXJnZXRJZCk7XG4gIH1cbiAgc3RhdGljIGFzeW5jIHB1Ymxpc2g8VE1zZyA9IGFueT4oXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIG1zZzogVE1zZyxcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xuICApIHtcbiAgICBCTUIuUHVibGlzaChuYW1lLCBtc2csIHRhcmdldElkKTtcbiAgfVxuICBzdGF0aWMgYXN5bmMgYnJvYWRjYXN0PFRNc2cgPSBhbnk+KFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBtc2c6IFRNc2csXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcbiAgKSB7XG4gICAgQk1CLkJyb2FkY2FzdDxUTXNnPihuYW1lLCBtc2csIHRhcmdldElkKTtcbiAgfVxuXG4gIHN1YnNjcmliZShoYW5kbGVyOiBUSGFuZGxlcjxUTXNnPik6IERpc3Bvc2VyIHtcbiAgICBjb25zdCBzID0gQk1CLlN1YnNjcmliZShcbiAgICAgIHRoaXMubmFtZSxcbiAgICAgIGhhbmRsZXIsXG4gICAgICB0aGlzLnNldHRpbmdzLmJyb2FkY2FzdCxcbiAgICAgIHRoaXMuc2V0dGluZ3MuY2FjaGVcbiAgICApO1xuICAgIHJldHVybiBzLmRpc3Bvc2U7XG4gIH1cblxuICBnZXRTdGF0ZSgpOiBUTXNnIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gQk1CLkdldFN0YXRlKHRoaXMubmFtZSk7XG4gIH1cbiAgc3RhdGljIEdldFN0YXRlPFRNc2c+KG5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiBCTUIuR2V0U3RhdGU8VE1zZz4obmFtZSk7XG4gIH1cblxuICBuZXh0TWVzc2FnZSgpOiBQcm9taXNlPFRNc2c+IHtcbiAgICByZXR1cm4gQk1CLm5leHRNZXNzYWdlKHRoaXMubmFtZSk7XG4gIH1cblxuICBzdGF0aWMgbmV4dE1lc3NhZ2U8VE1zZz4obmFtZTogc3RyaW5nKTogUHJvbWlzZTxUTXNnPiB7XG4gICAgcmV0dXJuIEJNQi5uZXh0TWVzc2FnZShuYW1lKTtcbiAgfVxuXG4gIHJlYWRvbmx5IHR5cGUgPSBcInB1YlN1YlwiO1xuICByZWFkb25seSBkaXNwb3NlID0gKCkgPT4ge1xuICAgIEJNQi5zdWJzY3JpYmVycy5kZWxldGUodGhpcy5uYW1lKTtcbiAgICBwdWJTdWJDaGFubmVscy5kZWxldGUodGhpcy5uYW1lKTtcbiAgfTtcblxuICByZWFkb25seSBuYW1lOiBzdHJpbmcgPSBcIlwiO1xuICByZWFkb25seSBzZXR0aW5nczogQ2hhbm5lbFNldHRpbmdzID0ge307XG59XG4iLCAiZXhwb3J0IGNvbnN0IFBVQl9TVUJfUkVRVUVTVF9TVUJTQ1JJUFRJT05fS0VZID0gXCJ0ZXN0UmVxXCI7XG5leHBvcnQgY29uc3QgUFVCX1NVQl9SRVNQT05TRV9TVUJTQ1JJUFRJT05fS0VZID0gXCJ0ZXN0UmVzcFwiO1xuZXhwb3J0IGNvbnN0IFJFUV9SRVBfQ0hBTk5FTF9OQU1FID0gXCJyZXFSZXBDaGFubmVsXCI7XG4iLCAiaW1wb3J0IHtcbiAgUHViU3ViQ2hhbm5lbCxcbiAgUmVxUmVwQ2hhbm5lbCxcbn0gZnJvbSBcImJyb3dzZXItbWVzc2FnZS1icm9rZXJcIjtcbmltcG9ydCB7XG4gIFBVQl9TVUJfUkVRVUVTVF9TVUJTQ1JJUFRJT05fS0VZLFxuICBQVUJfU1VCX1JFU1BPTlNFX1NVQlNDUklQVElPTl9LRVksXG4gIFJFUV9SRVBfQ0hBTk5FTF9OQU1FLFxufSBmcm9tIFwiLi9jb25zdGFudHNcIjtcblxuUHViU3ViQ2hhbm5lbC5mb3IoUFVCX1NVQl9SRVFVRVNUX1NVQlNDUklQVElPTl9LRVksIHtcbiAgYnJvYWRjYXN0OiB0cnVlLFxufSkuc3Vic2NyaWJlKChfKSA9PiB7XG4gIFB1YlN1YkNoYW5uZWwuYnJvYWRjYXN0KFxuICAgIFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSxcbiAgICB7IHBheWxvYWQ6IFwicmVzcG9uc2VcIiB9XG4gICk7XG59KTtcblxuUmVxUmVwQ2hhbm5lbC5mb3I8eyBwYXlsb2FkOiBzdHJpbmcgfSwgeyBwYXlsb2FkOiBzdHJpbmcgfT4oXG4gIFJFUV9SRVBfQ0hBTk5FTF9OQU1FLFxuICB7XG4gICAgYnJvYWRjYXN0OiB0cnVlLFxuICB9XG4pLnJlcGx5KChyZXEpID0+IHtcbiAgcmV0dXJuIHsgcGF5bG9hZDogcmVxLnBheWxvYWQgKyBcInJlc3BvbnNlXCIgfTtcbn0pO1xuXG4vL2xldCB3aW5kb3cga25vdyB0aGF0IHdvcmtlciBpcyByZWFkeSBhbmQgZXhlY3V0ZSB0ZXN0XG5wb3N0TWVzc2FnZShcInJlYWR5XCIpO1xuIl0sCiAgIm1hcHBpbmdzIjogIjtBQUdBLElBQU1BLElBQWlCLG9CQUFJO0FBQTNCLElBRWFDLElBQU4sTUFBTUMsRUFF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QUFDM0IsV0FBT0csRUFBSSxZQUFZLEtBQUssSUFBSTtFQUNsQztFQUVBLE9BQU8sWUFBa0JILEdBQTZCO0FBQ3BELFdBQU9HLEVBQUksWUFBWUgsQ0FBSTtFQUM3QjtBQVVGOzs7QUM3Rk8sSUFBTSxtQ0FBbUM7QUFDekMsSUFBTSxvQ0FBb0M7QUFDMUMsSUFBTSx1QkFBdUI7OztBQ1FwQyxFQUFjLElBQUksa0NBQWtDO0FBQUEsRUFDbEQsV0FBVztBQUNiLENBQUMsRUFBRSxVQUFVLENBQUMsTUFBTTtBQUNsQixJQUFjO0FBQUEsSUFDWjtBQUFBLElBQ0EsRUFBRSxTQUFTLFdBQVc7QUFBQSxFQUN4QjtBQUNGLENBQUM7QUFFRCxFQUFjO0FBQUEsRUFDWjtBQUFBLEVBQ0E7QUFBQSxJQUNFLFdBQVc7QUFBQSxFQUNiO0FBQ0YsRUFBRSxNQUFNLENBQUMsUUFBUTtBQUNmLFNBQU8sRUFBRSxTQUFTLElBQUksVUFBVSxXQUFXO0FBQzdDLENBQUM7QUFHRCxZQUFZLE9BQU87IiwKICAibmFtZXMiOiBbInJlcVJlcENoYW5uZWxzIiwgIlJlcVJlcENoYW5uZWwiLCAiX1JlcVJlcENoYW5uZWwiLCAibmFtZSIsICJzZXR0aW5ncyIsICJtc2ciLCAiQk1CIiwgImhhbmRsZXIiLCAiYyIsICJjaGFubmVsIiwgIkJST0FEQ0FTVF9TWU5DIiwgIkJST1dTRVJfTUVTU0FHRV9CUk9LRVIiLCAiaXNCcm9hZGNhc3RTeW5jIiwgImUiLCAiaXNTeW5jUmVxIiwgImlzU3luY1Jlc3AiLCAic2VuZGVySWQiLCAiZGVib3VuY2UiLCAiZnVuYyIsICJ0aW1lb3V0IiwgInRpbWVyIiwgImFyZ3MiLCAiY2hhbm5lbFNldHRpbmdzIiwgIkJyb2tlciIsICJtZXNzYWdlIiwgImRhdGEiLCAiY2hhbm5lbE5hbWUiLCAiYnJvYWRjYXN0IiwgImNhY2hlIiwgInRyYWNlIiwgImV2IiwgInRhcmdldElkIiwgImZpbHRlckJyb2FkY2FzdHMiLCAiY3VycmVudEJyb2FkY2FzdHMiLCAiayIsICJhdmFpbGFibGVTdGF0ZSIsICJ4IiwgInN0YXRlIiwgInJlcSIsICJzdWJzY3JpcHRpb24iLCAib3JpZ2luYWxEaXNwb3NlIiwgInN1YnNLZXkiLCAiY2hhbm5lbFR5cGUiLCAiX21zZyIsICJlbnZlbG9wZSIsICJhIiwgIm5ld0F3YWl0ZXIiLCAicmVzIiwgInNldHRpbmdzT3ZlcnJpZGVuIiwgInN1YnMiLCAiaGRsIiwgIl9zdWJzIiwgImkiLCAicmVxdWVzdERhdGEiLCAibGlzdGVuZXIiLCAicmVzb2x2ZSIsICJicmVxIiwgIm9yaWdIYW5kbGVyIiwgInJlcUxpc3RlbmVycyIsICJjdXJyZW50TGlzdGVuZXIiLCAic0lkIiwgImhhbmRsZXJzIiwgImFsbFN1YnNjcmliZXJzUHJvbWlzZXMiLCAiaCIsICJhd2FpdGVyIiwgInB1YlN1YkNoYW5uZWxzIiwgIlB1YlN1YkNoYW5uZWwiLCAiX1B1YlN1YkNoYW5uZWwiXQp9Cg==
