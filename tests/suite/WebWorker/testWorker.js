// ../browser-message-broker/dist/Module.js
var b = /* @__PURE__ */ new Map();
var w = class d {
  constructor(e, s) {
    this.type = "reqRep";
    this.settings = {};
    this.name = "";
    this.name = e, this.settings = s;
  }
  async request(e) {
    return i.Request(this.name, e, this.settings.broadcast);
  }
  reply(e) {
    return i.Reply(this.name, e, this.settings.broadcast).dispose;
  }
  dispose() {
    i.requestListeners.delete(this.name), b.delete(this.name);
  }
  static for(e, s) {
    if (!s) {
      let n = b.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.broadcast || false, s.cache || false, s.trace || false);
    let t = new d(e, s);
    return b.set(e, t), t;
  }
};
var S = "broadcast-sync";
var R = "browser-message-broker";
function k(d3) {
  return d3.channelName === S;
}
function B(d3) {
  return d3.senderId != null && d3.targetId == null;
}
function q(d3) {
  return d3.senderId != null && d3.targetId != null;
}
var g = Math.random().toString(36).substring(2, 9);
function M(d3, e = 1) {
  let s;
  return (...t) => {
    clearTimeout(s), s = setTimeout(() => {
      d3(...t);
    }, e);
  };
}
var h = /* @__PURE__ */ new Map();
var f = class {
  constructor() {
    this.trace = false;
    this.traceBroadcasts = false;
    this.traceMessages = false;
    this.senderId = g;
    this.state = /* @__PURE__ */ new Map();
    this.subscribers = /* @__PURE__ */ new Map();
    this.broadcasts = /* @__PURE__ */ new Set();
    this.__bcChannel = new BroadcastChannel(R);
    this.__nextMessageAwaiters = /* @__PURE__ */ new Map();
    this.broadcastedRequests = /* @__PURE__ */ new Map();
    this.requestListeners = /* @__PURE__ */ new Map();
    this.__bcChannel.onmessage = this.handleBroadcast.bind(this), this.__bcChannel.onmessageerror = this.handleBroadcastError.bind(this), setTimeout(() => {
      this.__sendBrokerState(void 0, void 0);
    }, 0), this.sendBrokerState = M(this.__sendBrokerState.bind(this), 2);
  }
  log(e, s, t) {
    let n = h.get(s);
    (this.trace || n?.trace || n?.broadcast && this.traceBroadcasts || !n?.broadcast && this.traceMessages) && (console.groupCollapsed(`[${globalThis.constructor.name}(${this.senderId})-${s}] ${e}`), console.log(t), console.trace(), console.groupEnd());
  }
  ConfigureChannel(e, s, t, n) {
    h.set(e, { broadcast: s, cache: t, trace: n }), t && !this.state.has(e) && this.state.set(e, void 0), s && this.broadcasts.add(e);
  }
  handleBroadcastError(e) {
    throw Error("BROADCAST FAILED: " + e.data);
  }
  __sendBrokerState(e, s) {
    let t = Array.from(this.broadcasts.keys());
    s && s.length > 0 && (t = t.filter((o) => s.includes(o)));
    let n = {};
    for (let o of this.state)
      o[1] && t.includes(o[0]) && (n[o[0]] = o[1]);
    let r = { id: g, availableState: n, broadcasts: t }, a = { channelName: S, senderCtx: globalThis.constructor.name, senderId: g, targetId: e, msg: r, channelType: "sync" };
    this.__bcChannel.postMessage(a), e == null ? this.log("Broadcast sync requested", "", { brokerState: r }) : this.log("Broadcast sync responded", "", { targetId: e, brokerState: r });
  }
  handleBroadcastSync(e) {
    if (B(e))
      return this.sendBrokerState(e.senderId, e.msg.broadcasts);
    if (q(e))
      for (let s of Object.entries(e.msg.availableState))
        this.broadcasts.has(s[0]) && this.state.has(s[0]) && this.state.get(s[0]) == null && this.__notifySubscribers(s[0], s[1], e.senderId), this.log("Broadcast sync response handled", "", e.msg);
  }
  handleBroadcast(e) {
    if (this.log("Broadcast received", e.data.channelName, e.data), e.data.targetId != null && e.data.targetId !== g) {
      this.log("Broadcast ignored (different targetId)", e.data.channelName);
      return;
    }
    if (k(e.data))
      return this.handleBroadcastSync(e.data);
    switch (e.data.channelType) {
      case "pubSub":
        this.__notifySubscribers(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "req":
        this.bridgeRequest(e.data.channelName, e.data.msg, e.data.senderId);
        break;
      case "rep":
        let s = this.broadcastedRequests.get(e.data.channelName);
        if (!s)
          return;
        s.resolve(e.data.msg), this.broadcastedRequests.delete(e.data.channelName);
        break;
    }
    this.log("Broadcast handled", e.data.channelName, e.data);
  }
  __configureBroadcast(e) {
    if (!e.channelName)
      throw new Error("Invalid subscription");
    this.broadcasts.add(e.channelName);
    let s = e.dispose;
    e.dispose = () => {
      s(), this.broadcasts.delete(e.channelName);
    }, e.isBroadcast = true, this.sendBrokerState();
  }
  GetState(e) {
    if (e)
      return this.state.get(e);
  }
  async Broadcast(e, s, t) {
    this._broadcast(e, s, "pubSub", t);
  }
  async _broadcast(e, s, t, n) {
    let r = h.get(e);
    this.log(`Message broadcasted (${t}) to ${n || "all brokers"}`, e, { message: s });
    let a = await Promise.resolve(s), o = { channelName: e, senderCtx: globalThis.constructor.name, senderId: g, targetId: n, msg: a, channelType: t };
    r?.cache && this.state.set(e, s), this.__bcChannel.postMessage(o);
  }
  async Publish(e, s, t) {
    this.log("Message published", e, { message: s }), await this.__notifySubscribers(e, s, g), this.broadcasts.has(e) && this._broadcast(e, s, "pubSub", t);
  }
  async nextMessage(e) {
    let s = this.__nextMessageAwaiters.get(e);
    if (s)
      return s.promise;
    let t = { promise: void 0, resolve: void 0 };
    return t.promise = new Promise((n) => {
      t.resolve = n;
    }), this.__nextMessageAwaiters.set(e, t), t.promise;
  }
  Subscribe(e, s, t = false, n = true) {
    let r = h.get(e), a = false;
    r && (t = r.broadcast || false, n = r.cache || true);
    let o = this.subscribers.get(e) || [], c = s;
    o.push(c), this.subscribers.set(e, o);
    let l = { channelName: e, isCached: false, dispose: () => {
      let u = this.subscribers.get(e);
      if (u == null)
        return;
      let p = u.indexOf(c);
      p !== -1 && u.splice(p, 1);
    }, publish: (u, p) => this.Publish(e, u, p), isDisposed: false };
    if (t && this.__configureBroadcast(l), n) {
      this.state.has(e) || this.state.set(e, void 0);
      let u = this.state.get(e);
      u && c(u);
    }
    return l;
  }
  bridgeRequest(e, s, t) {
    let n = this.requestListeners.get(e);
    return n ? n.handler(s, t) : Promise.resolve(void 0);
  }
  Request(e, s, t = false, n) {
    if (t) {
      this._broadcast(e, s, "req", n);
      let r = this.broadcastedRequests.get(e);
      r && r.resolve(void 0);
      let a, c = { promise: new Promise((l) => a = l), resolve: a };
      return this.broadcastedRequests.set(e, c), c.promise;
    } else {
      let r = this.requestListeners.get(e);
      return r ? r.handler(s) : Promise.resolve(void 0);
    }
  }
  Reply(e, s, t = false) {
    if (t) {
      let o = s;
      s = (c, l) => this._broadcast(e, o(c), "rep", l);
    }
    let n = this.requestListeners, r = { channelName: e, get isDisposed() {
      return n.has(e);
    }, isBroadcast: t, handler: s, dispose: void 0 };
    r.dispose = () => {
      r.isDisposed = true, this.requestListeners.get(e) === r && this.requestListeners.delete(e);
    };
    let a = this.requestListeners.get(e);
    return a && (a.isDisposed = true, console.warn("Request listener has been replaced: " + e)), this.requestListeners.set(e, r), r;
  }
  async __notifySubscribers(e, s, t) {
    let n = this.subscribers.get(e) || [], r = [];
    for (let a of n)
      a && (r.push(Promise.resolve(a(s, t))), this.log("Handler called", e, { handler: a, message: s }));
    await Promise.all(r), h.get(e)?.cache && this.state.set(e, s), this.__handleAwaiter(e, s), this.log("Message handled", e, { message: s, handlers: n, broker: this });
  }
  __handleAwaiter(e, s) {
    let t = this.__nextMessageAwaiters.get(e);
    t && (t.resolve(s), this.__nextMessageAwaiters.delete(e));
  }
};
globalThis.BrowserMessageBroker ?? (globalThis.BrowserMessageBroker = new f());
var i = globalThis.BrowserMessageBroker;
var T = /* @__PURE__ */ new Map();
var m = class d2 {
  constructor(e, s) {
    this.type = "pubSub";
    this.dispose = () => {
      i.subscribers.delete(this.name), T.delete(this.name);
    };
    this.name = "";
    this.settings = {};
    this.name = e, this.settings = s;
  }
  static for(e, s) {
    if (!s) {
      let n = T.get(e);
      if (!n)
        throw Error("Can't find channel settings");
      return n;
    }
    i.ConfigureChannel(e, s.broadcast || false, s.cache || false, s.trace || false);
    let t = new d2(e, s);
    return T.set(e, t), t;
  }
  async send(e, s) {
    i.Publish(this.name, e, s);
  }
  static async publish(e, s, t) {
    i.Publish(e, s, t);
  }
  static async broadcast(e, s, t) {
    i.Broadcast(e, s, t);
  }
  subscribe(e) {
    return i.Subscribe(this.name, e, this.settings.broadcast, this.settings.cache).dispose;
  }
  getState() {
    return i.GetState(this.name);
  }
  static GetState(e) {
    return i.GetState(e);
  }
  nextMessage() {
    return i.nextMessage(this.name);
  }
  static nextMessage(e) {
    return i.nextMessage(e);
  }
};

// suite/WebWorker/constants.ts
var PUB_SUB_REQUEST_SUBSCRIPTION_KEY = "testReq";
var PUB_SUB_RESPONSE_SUBSCRIPTION_KEY = "testResp";
var REQ_REP_CHANNEL_NAME = "reqRepChannel";

// suite/WebWorker/testWorker.ts
m.for(PUB_SUB_REQUEST_SUBSCRIPTION_KEY, {
  broadcast: true
}).subscribe((_) => {
  m.broadcast(
    PUB_SUB_RESPONSE_SUBSCRIPTION_KEY,
    { payload: "response" }
  );
});
w.for(
  REQ_REP_CHANNEL_NAME,
  {
    broadcast: true
  }
).reply((req) => {
  return { payload: req.payload + "response" };
});
postMessage("ready");
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUmVxUmVwQ2hhbm5lbC50cyIsICIuLi8uLi8uLi9icm93c2VyLW1lc3NhZ2UtYnJva2VyL3NyYy9Ccm9rZXIudHMiLCAiLi4vLi4vLi4vYnJvd3Nlci1tZXNzYWdlLWJyb2tlci9zcmMvUHViU3ViQ2hhbm5lbC50cyIsICJjb25zdGFudHMudHMiLCAidGVzdFdvcmtlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQk1CIH0gZnJvbSBcIi4vQnJva2VyXCI7XG5pbXBvcnQgeyBDaGFubmVsU2V0dGluZ3MsIElSZXFSZXBDaGFubmVsIH0gZnJvbSBcIi4vVHlwZXNcIjtcblxuY29uc3QgcmVxUmVwQ2hhbm5lbHMgPSBuZXcgTWFwPHN0cmluZywgUmVxUmVwQ2hhbm5lbD4oKTtcblxuZXhwb3J0IGNsYXNzIFJlcVJlcENoYW5uZWw8VFJlcSA9IHVua25vd24sIFRSZXAgPSB1bmtub3duPlxuICBpbXBsZW1lbnRzIElSZXFSZXBDaGFubmVsPFRSZXEsIFRSZXA+XG57XG4gIGFzeW5jIHJlcXVlc3QobXNnPzogVFJlcSk6IFByb21pc2U8VFJlcCB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiBCTUIuUmVxdWVzdDxUUmVwPihcbiAgICAgIHRoaXMubmFtZSxcbiAgICAgIG1zZyxcbiAgICAgIHRoaXMuc2V0dGluZ3MuYnJvYWRjYXN0XG4gICAgKTtcbiAgfVxuXG4gIHJlcGx5KGhhbmRsZXI6IChyZXE6IFRSZXEpID0+IFRSZXAgfCBQcm9taXNlPFRSZXA+KSB7XG4gICAgcmV0dXJuIEJNQi5SZXBseTxUUmVxLCBUUmVwPihcbiAgICAgIHRoaXMubmFtZSxcbiAgICAgIGhhbmRsZXIsXG4gICAgICB0aGlzLnNldHRpbmdzLmJyb2FkY2FzdFxuICAgICkuZGlzcG9zZTtcbiAgfVxuXG4gIHJlYWRvbmx5IHR5cGU6IFwicmVxUmVwXCIgPSBcInJlcVJlcFwiO1xuXG4gIHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3MgPSB7fTtcblxuICBkaXNwb3NlKCkge1xuICAgIEJNQi5yZXF1ZXN0TGlzdGVuZXJzLmRlbGV0ZSh0aGlzLm5hbWUpO1xuICAgIHJlcVJlcENoYW5uZWxzLmRlbGV0ZSh0aGlzLm5hbWUpO1xuICB9XG5cbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nID0gXCJcIjtcblxuICBzdGF0aWMgZm9yPFRSZXEgPSB1bmtub3duLCBUUmVwID0gdW5rbm93bj4oXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHNldHRpbmdzPzogQ2hhbm5lbFNldHRpbmdzXG4gICk6IFJlcVJlcENoYW5uZWw8VFJlcSwgVFJlcD4ge1xuICAgIGlmICghc2V0dGluZ3MpIHtcbiAgICAgIGNvbnN0IGMgPSByZXFSZXBDaGFubmVscy5nZXQobmFtZSk7XG4gICAgICBpZiAoIWMpIHRocm93IEVycm9yKFwiQ2FuJ3QgZmluZCBjaGFubmVsIHNldHRpbmdzXCIpO1xuICAgICAgcmV0dXJuIGMgYXMgUmVxUmVwQ2hhbm5lbDxUUmVxLCBUUmVwPjtcbiAgICB9XG5cbiAgICBCTUIuQ29uZmlndXJlQ2hhbm5lbChcbiAgICAgIG5hbWUsXG4gICAgICBzZXR0aW5ncy5icm9hZGNhc3QgfHwgZmFsc2UsXG4gICAgICBzZXR0aW5ncy5jYWNoZSB8fCBmYWxzZSxcbiAgICAgIHNldHRpbmdzLnRyYWNlIHx8IGZhbHNlXG4gICAgKTtcbiAgICBjb25zdCBjaGFubmVsID0gbmV3IFJlcVJlcENoYW5uZWw8VFJlcSwgVFJlcD4oXG4gICAgICBuYW1lLFxuICAgICAgc2V0dGluZ3NcbiAgICApO1xuICAgIHJlcVJlcENoYW5uZWxzLnNldChuYW1lLCBjaGFubmVsKTtcbiAgICByZXR1cm4gY2hhbm5lbDtcbiAgfVxuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBzZXR0aW5nczogQ2hhbm5lbFNldHRpbmdzXG4gICkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuICB9XG59XG4iLCAiaW1wb3J0IHtcbiAgQ2hhbm5lbFR5cGUsXG4gIElCcm9hZGNhc3RFbnZlbG9wZSxcbiAgSUJyb2FkY2FzdFN5bmNFbnZlbG9wZSxcbiAgSUJyb2tlcixcbiAgSUJyb2tlclN0YXRlLFxuICBDaGFubmVsU2V0dGluZ3MsXG4gIFJlcVN1YnNjcmlwdGlvbixcbiAgU3Vic2NyaXB0aW9uLFxuICBUSGFuZGxlcixcbn0gZnJvbSBcIi4vVHlwZXNcIjtcblxuY29uc3QgQlJPQURDQVNUX1NZTkMgPSBcImJyb2FkY2FzdC1zeW5jXCI7XG5jb25zdCBCUk9XU0VSX01FU1NBR0VfQlJPS0VSID0gXCJicm93c2VyLW1lc3NhZ2UtYnJva2VyXCI7XG5cbmZ1bmN0aW9uIGlzQnJvYWRjYXN0U3luYyhlOiBJQnJvYWRjYXN0RW52ZWxvcGUpOiBlIGlzIElCcm9hZGNhc3RTeW5jRW52ZWxvcGUge1xuICByZXR1cm4gZS5jaGFubmVsTmFtZSA9PT0gQlJPQURDQVNUX1NZTkM7XG59XG5cbmZ1bmN0aW9uIGlzU3luY1JlcShlOiBJQnJvYWRjYXN0RW52ZWxvcGUpIHtcbiAgcmV0dXJuIGUuc2VuZGVySWQgIT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0SWQgPT0gdW5kZWZpbmVkO1xufVxuZnVuY3Rpb24gaXNTeW5jUmVzcChlOiBJQnJvYWRjYXN0RW52ZWxvcGUpIHtcbiAgcmV0dXJuIGUuc2VuZGVySWQgIT0gdW5kZWZpbmVkICYmIGUudGFyZ2V0SWQgIT0gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgY29uc3Qgc2VuZGVySWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOSk7XG5cbmZ1bmN0aW9uIGRlYm91bmNlPFQgZXh0ZW5kcyBGdW5jdGlvbj4oZnVuYzogVCwgdGltZW91dCA9IDEpIHtcbiAgbGV0IHRpbWVyOiBudW1iZXI7XG4gIHJldHVybiAoLi4uYXJnczogdW5rbm93bltdKSA9PiB7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgZnVuYyguLi5hcmdzKTtcbiAgICB9LCB0aW1lb3V0KTtcbiAgfTtcbn1cblxuY29uc3QgY2hhbm5lbFNldHRpbmdzID0gbmV3IE1hcDxzdHJpbmcsIENoYW5uZWxTZXR0aW5ncz4oKTtcblxuY2xhc3MgQnJva2VyIGltcGxlbWVudHMgSUJyb2tlciB7XG4gIHRyYWNlOiBib29sZWFuID0gZmFsc2U7XG4gIHRyYWNlQnJvYWRjYXN0czogYm9vbGVhbiA9IGZhbHNlO1xuICB0cmFjZU1lc3NhZ2VzOiBib29sZWFuID0gZmFsc2U7XG4gIHNlbmRlcklkID0gc2VuZGVySWQ7XG4gIHN0YXRlID0gbmV3IE1hcDxzdHJpbmcsIGFueT4oKTtcbiAgc3Vic2NyaWJlcnMgPSBuZXcgTWFwPHN0cmluZywgVEhhbmRsZXJbXT4oKTtcbiAgYnJvYWRjYXN0cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICBwcml2YXRlIF9fYmNDaGFubmVsID0gbmV3IEJyb2FkY2FzdENoYW5uZWwoQlJPV1NFUl9NRVNTQUdFX0JST0tFUik7XG5cbiAgcHJpdmF0ZSBsb2cobWVzc2FnZTogc3RyaW5nLCBjaGFubmVsOiBzdHJpbmcsIGRhdGE/OiB1bmtub3duKSB7XG4gICAgY29uc3QgYyA9IGNoYW5uZWxTZXR0aW5ncy5nZXQoY2hhbm5lbCk7XG4gICAgaWYgKFxuICAgICAgdGhpcy50cmFjZSB8fFxuICAgICAgYz8udHJhY2UgfHxcbiAgICAgIChjPy5icm9hZGNhc3QgJiYgdGhpcy50cmFjZUJyb2FkY2FzdHMpIHx8XG4gICAgICAoIWM/LmJyb2FkY2FzdCAmJiB0aGlzLnRyYWNlTWVzc2FnZXMpXG4gICAgKSB7XG4gICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKFxuICAgICAgICBgWyR7Z2xvYmFsVGhpcy5jb25zdHJ1Y3Rvci5uYW1lfSgke3RoaXMuc2VuZGVySWR9KS0ke2NoYW5uZWx9XSAke21lc3NhZ2V9YFxuICAgICAgKTtcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgICAgY29uc29sZS50cmFjZSgpO1xuICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX19iY0NoYW5uZWwub25tZXNzYWdlID0gdGhpcy5oYW5kbGVCcm9hZGNhc3QuYmluZCh0aGlzKTtcbiAgICB0aGlzLl9fYmNDaGFubmVsLm9ubWVzc2FnZWVycm9yID0gdGhpcy5oYW5kbGVCcm9hZGNhc3RFcnJvci5iaW5kKHRoaXMpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLl9fc2VuZEJyb2tlclN0YXRlKHVuZGVmaW5lZCwgdW5kZWZpbmVkKTsgLy8gYWx3YXlzIHNlbmQgaW5pdGlhbCBzeW5jIHJlcXVlc3RcbiAgICB9LCAwKTtcblxuICAgIHRoaXMuc2VuZEJyb2tlclN0YXRlID0gZGVib3VuY2UodGhpcy5fX3NlbmRCcm9rZXJTdGF0ZS5iaW5kKHRoaXMpLCAyKTtcbiAgfVxuXG4gIENvbmZpZ3VyZUNoYW5uZWwoXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcbiAgICBicm9hZGNhc3Q6IGJvb2xlYW4sXG4gICAgY2FjaGU6IGJvb2xlYW4sXG4gICAgdHJhY2U6IGJvb2xlYW5cbiAgKTogdm9pZCB7XG4gICAgY2hhbm5lbFNldHRpbmdzLnNldChjaGFubmVsTmFtZSwge1xuICAgICAgYnJvYWRjYXN0OiBicm9hZGNhc3QsXG4gICAgICBjYWNoZTogY2FjaGUsXG4gICAgICB0cmFjZSxcbiAgICB9KTtcblxuICAgIGlmIChjYWNoZSAmJiAhdGhpcy5zdGF0ZS5oYXMoY2hhbm5lbE5hbWUpKVxuICAgICAgdGhpcy5zdGF0ZS5zZXQoY2hhbm5lbE5hbWUsIHVuZGVmaW5lZCk7XG4gICAgaWYgKGJyb2FkY2FzdCkgdGhpcy5icm9hZGNhc3RzLmFkZChjaGFubmVsTmFtZSk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUJyb2FkY2FzdEVycm9yKGV2OiBNZXNzYWdlRXZlbnQ8SUJyb2FkY2FzdEVudmVsb3BlPikge1xuICAgIHRocm93IEVycm9yKFwiQlJPQURDQVNUIEZBSUxFRDogXCIgKyBldi5kYXRhKTtcbiAgfVxuXG4gIHByaXZhdGUgc2VuZEJyb2tlclN0YXRlOiAoXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmcsXG4gICAgZmlsdGVyQnJvYWRjYXN0cz86IHN0cmluZ1tdXG4gICkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBfX3NlbmRCcm9rZXJTdGF0ZSh0YXJnZXRJZD86IHN0cmluZywgZmlsdGVyQnJvYWRjYXN0cz86IHN0cmluZ1tdKSB7XG4gICAgbGV0IGN1cnJlbnRCcm9hZGNhc3RzID0gQXJyYXkuZnJvbSh0aGlzLmJyb2FkY2FzdHMua2V5cygpKTtcblxuICAgIGlmIChmaWx0ZXJCcm9hZGNhc3RzICYmIGZpbHRlckJyb2FkY2FzdHMubGVuZ3RoID4gMCkge1xuICAgICAgY3VycmVudEJyb2FkY2FzdHMgPSBjdXJyZW50QnJvYWRjYXN0cy5maWx0ZXIoKGspID0+XG4gICAgICAgIGZpbHRlckJyb2FkY2FzdHMuaW5jbHVkZXMoaylcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYXZhaWxhYmxlU3RhdGU6IHsgW3g6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgZm9yIChjb25zdCB4IG9mIHRoaXMuc3RhdGUpIHtcbiAgICAgIGlmICgheFsxXSkgY29udGludWU7XG4gICAgICBpZiAoIWN1cnJlbnRCcm9hZGNhc3RzLmluY2x1ZGVzKHhbMF0pKSBjb250aW51ZTtcbiAgICAgIGF2YWlsYWJsZVN0YXRlW3hbMF1dID0geFsxXTtcbiAgICB9XG5cbiAgICBjb25zdCBzdGF0ZTogSUJyb2tlclN0YXRlID0ge1xuICAgICAgaWQ6IHNlbmRlcklkLFxuICAgICAgYXZhaWxhYmxlU3RhdGUsXG4gICAgICBicm9hZGNhc3RzOiBjdXJyZW50QnJvYWRjYXN0cyxcbiAgICB9O1xuXG4gICAgY29uc3QgZXY6IElCcm9hZGNhc3RTeW5jRW52ZWxvcGUgPSB7XG4gICAgICBjaGFubmVsTmFtZTogQlJPQURDQVNUX1NZTkMsXG4gICAgICBzZW5kZXJDdHg6IGdsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZSxcbiAgICAgIHNlbmRlcklkLFxuICAgICAgdGFyZ2V0SWQsXG4gICAgICBtc2c6IHN0YXRlLFxuICAgICAgY2hhbm5lbFR5cGU6IFwic3luY1wiLFxuICAgIH07XG5cbiAgICB0aGlzLl9fYmNDaGFubmVsLnBvc3RNZXNzYWdlKGV2KTtcblxuICAgIGlmICh0YXJnZXRJZCA9PSB1bmRlZmluZWQpXG4gICAgICB0aGlzLmxvZyhcIkJyb2FkY2FzdCBzeW5jIHJlcXVlc3RlZFwiLCBcIlwiLCB7XG4gICAgICAgIGJyb2tlclN0YXRlOiBzdGF0ZSxcbiAgICAgIH0pO1xuICAgIGVsc2VcbiAgICAgIHRoaXMubG9nKFwiQnJvYWRjYXN0IHN5bmMgcmVzcG9uZGVkXCIsIFwiXCIsIHtcbiAgICAgICAgdGFyZ2V0SWQsXG4gICAgICAgIGJyb2tlclN0YXRlOiBzdGF0ZSxcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVCcm9hZGNhc3RTeW5jKGV2OiBJQnJvYWRjYXN0U3luY0VudmVsb3BlKSB7XG4gICAgaWYgKGlzU3luY1JlcShldikpXG4gICAgICByZXR1cm4gdGhpcy5zZW5kQnJva2VyU3RhdGUoZXYuc2VuZGVySWQsIGV2Lm1zZy5icm9hZGNhc3RzKTtcbiAgICBpZiAoaXNTeW5jUmVzcChldikpIHtcbiAgICAgIGZvciAoY29uc3QgcyBvZiBPYmplY3QuZW50cmllcyhldi5tc2cuYXZhaWxhYmxlU3RhdGUpKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aGlzLmJyb2FkY2FzdHMuaGFzKHNbMF0pICYmXG4gICAgICAgICAgdGhpcy5zdGF0ZS5oYXMoc1swXSkgJiZcbiAgICAgICAgICB0aGlzLnN0YXRlLmdldChzWzBdKSA9PSB1bmRlZmluZWRcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5fX25vdGlmeVN1YnNjcmliZXJzKHNbMF0sIHNbMV0sIGV2LnNlbmRlcklkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubG9nKFwiQnJvYWRjYXN0IHN5bmMgcmVzcG9uc2UgaGFuZGxlZFwiLCBcIlwiLCBldi5tc2cpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlQnJvYWRjYXN0KGV2OiBNZXNzYWdlRXZlbnQ8SUJyb2FkY2FzdEVudmVsb3BlPikge1xuICAgIHRoaXMubG9nKFwiQnJvYWRjYXN0IHJlY2VpdmVkXCIsIGV2LmRhdGEuY2hhbm5lbE5hbWUsIGV2LmRhdGEpO1xuXG4gICAgaWYgKGV2LmRhdGEudGFyZ2V0SWQgIT0gdW5kZWZpbmVkICYmIGV2LmRhdGEudGFyZ2V0SWQgIT09IHNlbmRlcklkKSB7XG4gICAgICB0aGlzLmxvZyhcIkJyb2FkY2FzdCBpZ25vcmVkIChkaWZmZXJlbnQgdGFyZ2V0SWQpXCIsIGV2LmRhdGEuY2hhbm5lbE5hbWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChpc0Jyb2FkY2FzdFN5bmMoZXYuZGF0YSkpIHJldHVybiB0aGlzLmhhbmRsZUJyb2FkY2FzdFN5bmMoZXYuZGF0YSk7XG5cbiAgICBzd2l0Y2ggKGV2LmRhdGEuY2hhbm5lbFR5cGUpIHtcbiAgICAgIGNhc2UgXCJwdWJTdWJcIjpcbiAgICAgICAgdGhpcy5fX25vdGlmeVN1YnNjcmliZXJzKFxuICAgICAgICAgIGV2LmRhdGEuY2hhbm5lbE5hbWUsXG4gICAgICAgICAgZXYuZGF0YS5tc2csXG4gICAgICAgICAgZXYuZGF0YS5zZW5kZXJJZFxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyZXFcIjpcbiAgICAgICAgdGhpcy5icmlkZ2VSZXF1ZXN0KGV2LmRhdGEuY2hhbm5lbE5hbWUsIGV2LmRhdGEubXNnLCBldi5kYXRhLnNlbmRlcklkKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmVwXCI6XG4gICAgICAgIGNvbnN0IHJlcSA9IHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5nZXQoZXYuZGF0YS5jaGFubmVsTmFtZSk7XG4gICAgICAgIGlmICghcmVxKSByZXR1cm47XG5cbiAgICAgICAgcmVxLnJlc29sdmUoZXYuZGF0YS5tc2cpO1xuICAgICAgICB0aGlzLmJyb2FkY2FzdGVkUmVxdWVzdHMuZGVsZXRlKGV2LmRhdGEuY2hhbm5lbE5hbWUpO1xuXG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHRoaXMubG9nKFwiQnJvYWRjYXN0IGhhbmRsZWRcIiwgZXYuZGF0YS5jaGFubmVsTmFtZSwgZXYuZGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogQnJpZGdlIHB1Yi9zdWIgbWVzc2FnZXMgdG8gYnJvYWRjYXN0IGNoYW5uZWxcbiAgICogQHBhcmFtIHN1YnNLZXlcbiAgICogQHJldHVybnMge1N1YnNjcmlwdGlvbn1cbiAgICovXG4gIHByaXZhdGUgX19jb25maWd1cmVCcm9hZGNhc3Qoc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb248YW55Pik6IHZvaWQge1xuICAgIGlmICghc3Vic2NyaXB0aW9uLmNoYW5uZWxOYW1lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgc3Vic2NyaXB0aW9uYCk7XG4gICAgfVxuICAgIHRoaXMuYnJvYWRjYXN0cy5hZGQoc3Vic2NyaXB0aW9uLmNoYW5uZWxOYW1lKTtcbiAgICBjb25zdCBvcmlnaW5hbERpc3Bvc2UgPSBzdWJzY3JpcHRpb24uZGlzcG9zZTtcbiAgICBzdWJzY3JpcHRpb24uZGlzcG9zZSA9ICgpID0+IHtcbiAgICAgIG9yaWdpbmFsRGlzcG9zZSgpO1xuICAgICAgdGhpcy5icm9hZGNhc3RzLmRlbGV0ZShzdWJzY3JpcHRpb24uY2hhbm5lbE5hbWUpO1xuICAgIH07XG4gICAgc3Vic2NyaXB0aW9uLmlzQnJvYWRjYXN0ID0gdHJ1ZTtcblxuICAgIHRoaXMuc2VuZEJyb2tlclN0YXRlKCk7XG4gIH1cblxuICBHZXRTdGF0ZTxUPihzdWJzS2V5OiBzdHJpbmcpOiBUIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoc3Vic0tleSkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuZ2V0KHN1YnNLZXkpIGFzIFQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgQnJvYWRjYXN0KGNoYW5uZWxOYW1lOiBzdHJpbmcsIG1zZzogdW5rbm93biwgdGFyZ2V0SWQ/OiBzdHJpbmcpIHtcbiAgICB0aGlzLl9icm9hZGNhc3QoY2hhbm5lbE5hbWUsIG1zZywgXCJwdWJTdWJcIiwgdGFyZ2V0SWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBfYnJvYWRjYXN0KFxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXG4gICAgbXNnOiB1bmtub3duLFxuICAgIGNoYW5uZWxUeXBlOiBDaGFubmVsVHlwZSxcbiAgICB0YXJnZXRJZD86IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCBzZXR0aW5ncyA9IGNoYW5uZWxTZXR0aW5ncy5nZXQoY2hhbm5lbE5hbWUpO1xuXG4gICAgdGhpcy5sb2coXG4gICAgICBgTWVzc2FnZSBicm9hZGNhc3RlZCAoJHtjaGFubmVsVHlwZX0pIHRvICR7dGFyZ2V0SWQgfHwgXCJhbGwgYnJva2Vyc1wifWAsXG4gICAgICBjaGFubmVsTmFtZSxcbiAgICAgIHsgbWVzc2FnZTogbXNnIH1cbiAgICApO1xuXG4gICAgY29uc3QgX21zZyA9IGF3YWl0IFByb21pc2UucmVzb2x2ZShtc2cpO1xuICAgIGNvbnN0IGVudmVsb3BlOiBJQnJvYWRjYXN0RW52ZWxvcGUgPSB7XG4gICAgICBjaGFubmVsTmFtZTogY2hhbm5lbE5hbWUsXG4gICAgICBzZW5kZXJDdHg6IGdsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZSxcbiAgICAgIHNlbmRlcklkOiBzZW5kZXJJZCxcbiAgICAgIHRhcmdldElkOiB0YXJnZXRJZCxcbiAgICAgIG1zZzogX21zZyxcbiAgICAgIGNoYW5uZWxUeXBlLFxuICAgIH07XG5cbiAgICBpZiAoc2V0dGluZ3M/LmNhY2hlKSB0aGlzLnN0YXRlLnNldChjaGFubmVsTmFtZSwgbXNnKTtcblxuICAgIHRoaXMuX19iY0NoYW5uZWwucG9zdE1lc3NhZ2UoZW52ZWxvcGUpO1xuICB9XG5cbiAgYXN5bmMgUHVibGlzaChjaGFubmVsTmFtZTogc3RyaW5nLCBtc2c6IHVua25vd24sIHRhcmdldElkPzogc3RyaW5nKSB7XG4gICAgdGhpcy5sb2coYE1lc3NhZ2UgcHVibGlzaGVkYCwgY2hhbm5lbE5hbWUsIHsgbWVzc2FnZTogbXNnIH0pO1xuICAgIGF3YWl0IHRoaXMuX19ub3RpZnlTdWJzY3JpYmVycyhjaGFubmVsTmFtZSwgbXNnLCBzZW5kZXJJZCk7XG5cbiAgICBpZiAoIXRoaXMuYnJvYWRjYXN0cy5oYXMoY2hhbm5lbE5hbWUpKSByZXR1cm47XG5cbiAgICB0aGlzLl9icm9hZGNhc3QoY2hhbm5lbE5hbWUsIG1zZywgXCJwdWJTdWJcIiwgdGFyZ2V0SWQpO1xuICB9XG5cbiAgcHJpdmF0ZSBfX25leHRNZXNzYWdlQXdhaXRlcnMgPSBuZXcgTWFwPFxuICAgIHN0cmluZyxcbiAgICB7XG4gICAgICBwcm9taXNlOiBQcm9taXNlPHVua25vd24+O1xuICAgICAgcmVzb2x2ZTogKG1zZzogdW5rbm93bikgPT4gdW5rbm93bjtcbiAgICB9XG4gID4oKTtcblxuICBhc3luYyBuZXh0TWVzc2FnZTxUID0gdW5rbm93bj4oc3Vic0tleTogc3RyaW5nKTogUHJvbWlzZTxUPiB7XG4gICAgY29uc3QgYSA9IHRoaXMuX19uZXh0TWVzc2FnZUF3YWl0ZXJzLmdldChzdWJzS2V5KTtcbiAgICBpZiAoYSkgcmV0dXJuIGEucHJvbWlzZSBhcyBQcm9taXNlPFQ+O1xuXG4gICAgY29uc3QgbmV3QXdhaXRlcjoge1xuICAgICAgcHJvbWlzZTogUHJvbWlzZTx1bmtub3duPjtcbiAgICAgIHJlc29sdmU6IChtc2c6IHVua25vd24pID0+IHZvaWQ7XG4gICAgfSA9IHtcbiAgICAgIHByb21pc2U6IHVuZGVmaW5lZCBhcyB1bmtub3duIGFzIFByb21pc2U8VD4sXG4gICAgICByZXNvbHZlOiB1bmRlZmluZWQgYXMgdW5rbm93biBhcyAobXNnOiB1bmtub3duKSA9PiB2b2lkLFxuICAgIH07XG4gICAgbmV3QXdhaXRlci5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlczogKG1zZzogdW5rbm93bikgPT4gdm9pZCkgPT4ge1xuICAgICAgbmV3QXdhaXRlci5yZXNvbHZlID0gcmVzO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fX25leHRNZXNzYWdlQXdhaXRlcnMuc2V0KHN1YnNLZXksIG5ld0F3YWl0ZXIpO1xuXG4gICAgcmV0dXJuIG5ld0F3YWl0ZXIucHJvbWlzZSBhcyBQcm9taXNlPFQ+O1xuICB9XG5cbiAgU3Vic2NyaWJlPFQ+KFxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcj86IFRIYW5kbGVyPFQ+LFxuICAgIGJyb2FkY2FzdCA9IGZhbHNlLFxuICAgIGNhY2hlID0gdHJ1ZVxuICApOiBTdWJzY3JpcHRpb248VD4ge1xuICAgIGNvbnN0IHNldHRpbmdzID0gY2hhbm5lbFNldHRpbmdzLmdldChjaGFubmVsTmFtZSk7XG4gICAgY29uc3Qgc2V0dGluZ3NPdmVycmlkZGVuID0gZmFsc2U7XG4gICAgaWYgKHNldHRpbmdzKSB7XG4gICAgICBicm9hZGNhc3QgPSBzZXR0aW5ncy5icm9hZGNhc3QgfHwgZmFsc2U7XG4gICAgICBjYWNoZSA9IHNldHRpbmdzLmNhY2hlIHx8IHRydWU7XG4gICAgICBzZXR0aW5nc092ZXJyaWRkZW47XG4gICAgfVxuXG4gICAgY29uc3Qgc3VicyA9IHRoaXMuc3Vic2NyaWJlcnMuZ2V0KGNoYW5uZWxOYW1lKSB8fCBbXTtcbiAgICBjb25zdCBoZGwgPSBoYW5kbGVyIGFzIChtc2c6IHVua25vd24pID0+IHZvaWQ7XG4gICAgc3Vicy5wdXNoKGhkbCk7XG4gICAgdGhpcy5zdWJzY3JpYmVycy5zZXQoY2hhbm5lbE5hbWUsIHN1YnMpO1xuXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb248VD4gPSB7XG4gICAgICBjaGFubmVsTmFtZTogY2hhbm5lbE5hbWUsXG4gICAgICBpc0NhY2hlZDogZmFsc2UsXG4gICAgICBkaXNwb3NlOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IF9zdWJzID0gdGhpcy5zdWJzY3JpYmVycy5nZXQoY2hhbm5lbE5hbWUpO1xuXG4gICAgICAgIGlmIChfc3VicyA9PSB1bmRlZmluZWQpIHJldHVybjtcbiAgICAgICAgY29uc3QgaSA9IF9zdWJzLmluZGV4T2YoaGRsKTtcblxuICAgICAgICBpZiAoaSA9PT0gLTEpIHJldHVybjtcbiAgICAgICAgX3N1YnMuc3BsaWNlKGksIDEpO1xuICAgICAgfSxcbiAgICAgIHB1Ymxpc2g6IChtc2csIHRhcmdldElkPzogc3RyaW5nKSA9PlxuICAgICAgICB0aGlzLlB1Ymxpc2goY2hhbm5lbE5hbWUsIG1zZywgdGFyZ2V0SWQpLFxuICAgICAgaXNEaXNwb3NlZDogZmFsc2UsXG4gICAgfTtcblxuICAgIGlmIChicm9hZGNhc3QpIHRoaXMuX19jb25maWd1cmVCcm9hZGNhc3Qoc3Vic2NyaXB0aW9uKTtcbiAgICBpZiAoY2FjaGUpIHtcbiAgICAgIGlmICghdGhpcy5zdGF0ZS5oYXMoY2hhbm5lbE5hbWUpKSB0aGlzLnN0YXRlLnNldChjaGFubmVsTmFtZSwgdW5kZWZpbmVkKTtcbiAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5zdGF0ZS5nZXQoY2hhbm5lbE5hbWUpO1xuICAgICAgaWYgKHN0YXRlKSBoZGwoc3RhdGUpO1xuICAgIH1cblxuICAgIHJldHVybiBzdWJzY3JpcHRpb247XG4gIH1cblxuICBwcml2YXRlIGJyaWRnZVJlcXVlc3QoXG4gICAgY2hhbm5lbE5hbWU6IHN0cmluZyxcbiAgICByZXF1ZXN0RGF0YTogdW5rbm93bixcbiAgICBzZW5kZXJJZDogc3RyaW5nXG4gICkge1xuICAgIGNvbnN0IGxpc3RlbmVyID0gdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLmdldChjaGFubmVsTmFtZSk7XG5cbiAgICBpZiAoIWxpc3RlbmVyKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7XG5cbiAgICByZXR1cm4gbGlzdGVuZXIuaGFuZGxlcihyZXF1ZXN0RGF0YSwgc2VuZGVySWQpIGFzIFByb21pc2U8dW5rbm93bj47XG4gIH1cblxuICBSZXF1ZXN0PFRSZXAgPSB1bmtub3duPihcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxuICAgIHJlcXVlc3REYXRhOiB1bmtub3duLFxuICAgIGJyb2FkY2FzdCA9IGZhbHNlLFxuICAgIHRhcmdldElkPzogc3RyaW5nXG4gICk6IFByb21pc2U8VFJlcD4gfCBQcm9taXNlPHVuZGVmaW5lZD4ge1xuICAgIGlmICghYnJvYWRjYXN0KSB7XG4gICAgICBjb25zdCBsaXN0ZW5lciA9IHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xuICAgICAgaWYgKCFsaXN0ZW5lcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgICAgcmV0dXJuIGxpc3RlbmVyLmhhbmRsZXIocmVxdWVzdERhdGEpIGFzIFByb21pc2U8VFJlcD47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2Jyb2FkY2FzdChjaGFubmVsTmFtZSwgcmVxdWVzdERhdGEsIFwicmVxXCIsIHRhcmdldElkKTtcbiAgICAgIGNvbnN0IHJlcSA9IHRoaXMuYnJvYWRjYXN0ZWRSZXF1ZXN0cy5nZXQoY2hhbm5lbE5hbWUpO1xuICAgICAgaWYgKHJlcSkgcmVxLnJlc29sdmUodW5kZWZpbmVkKTtcblxuICAgICAgbGV0IHJlc29sdmUgPSB1bmRlZmluZWQgYXMgdW5rbm93biBhcyAocjogdW5rbm93bikgPT4gdm9pZDtcbiAgICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZTxUUmVwPihcbiAgICAgICAgKHJlcykgPT4gKHJlc29sdmUgPSByZXMgYXMgKHI6IHVua25vd24pID0+IHZvaWQpXG4gICAgICApO1xuICAgICAgY29uc3QgYnJlcSA9IHtcbiAgICAgICAgcHJvbWlzZSxcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgIH07XG4gICAgICB0aGlzLmJyb2FkY2FzdGVkUmVxdWVzdHMuc2V0KGNoYW5uZWxOYW1lLCBicmVxKTtcbiAgICAgIHJldHVybiBicmVxLnByb21pc2U7XG4gICAgfVxuICB9XG4gIHByaXZhdGUgYnJvYWRjYXN0ZWRSZXF1ZXN0cyA9IG5ldyBNYXA8XG4gICAgc3RyaW5nLFxuICAgIHtcbiAgICAgIHByb21pc2U6IFByb21pc2U8dW5rbm93bj47XG4gICAgICByZXNvbHZlOiAocjogdW5rbm93bikgPT4gdm9pZDtcbiAgICB9XG4gID4oKTtcblxuICBSZXBseTxUUmVxID0gdW5rbm93biwgVFJlcCA9IHVua25vd24+KFxuICAgIGNoYW5uZWxOYW1lOiBzdHJpbmcsXG4gICAgaGFuZGxlcjogKHJlcTogVFJlcSkgPT4gVFJlcCxcbiAgICBicm9hZGNhc3QgPSBmYWxzZVxuICApIHtcbiAgICBpZiAoYnJvYWRjYXN0KSB7XG4gICAgICBjb25zdCBvcmlnSGFuZGxlciA9IGhhbmRsZXI7XG4gICAgICBoYW5kbGVyID0gKChtc2c6IFRSZXEsIHRhcmdldElkOiBzdHJpbmcpID0+XG4gICAgICAgIHRoaXMuX2Jyb2FkY2FzdChcbiAgICAgICAgICBjaGFubmVsTmFtZSxcbiAgICAgICAgICBvcmlnSGFuZGxlcihtc2cpLFxuICAgICAgICAgIFwicmVwXCIsXG4gICAgICAgICAgdGFyZ2V0SWRcbiAgICAgICAgKSkgYXMgdW5rbm93biBhcyAocmVxOiBUUmVxKSA9PiBUUmVwO1xuICAgIH1cbiAgICBjb25zdCByZXFMaXN0ZW5lcnMgPSB0aGlzLnJlcXVlc3RMaXN0ZW5lcnM7XG4gICAgY29uc3Qgc3ViczogUmVxU3Vic2NyaXB0aW9uID0ge1xuICAgICAgY2hhbm5lbE5hbWUsXG4gICAgICBnZXQgaXNEaXNwb3NlZCgpIHtcbiAgICAgICAgcmV0dXJuIHJlcUxpc3RlbmVycy5oYXMoY2hhbm5lbE5hbWUpO1xuICAgICAgfSxcbiAgICAgIGlzQnJvYWRjYXN0OiBicm9hZGNhc3QsXG4gICAgICBoYW5kbGVyOiBoYW5kbGVyIGFzIChyOiB1bmtub3duKSA9PiB1bmtub3duLFxuICAgICAgZGlzcG9zZTogdW5kZWZpbmVkIGFzIHVua25vd24gYXMgKCkgPT4gdm9pZCxcbiAgICB9O1xuXG4gICAgc3Vicy5kaXNwb3NlID0gKCkgPT4ge1xuICAgICAgc3Vicy5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5lciA9IHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xuICAgICAgaWYgKGN1cnJlbnRMaXN0ZW5lciA9PT0gc3VicykgdGhpcy5yZXF1ZXN0TGlzdGVuZXJzLmRlbGV0ZShjaGFubmVsTmFtZSk7XG4gICAgfTtcblxuICAgIGNvbnN0IGN1cnJlbnRMaXN0ZW5lciA9IHRoaXMucmVxdWVzdExpc3RlbmVycy5nZXQoY2hhbm5lbE5hbWUpO1xuICAgIGlmIChjdXJyZW50TGlzdGVuZXIpIHtcbiAgICAgIGN1cnJlbnRMaXN0ZW5lci5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUud2FybihcIlJlcXVlc3QgbGlzdGVuZXIgaGFzIGJlZW4gcmVwbGFjZWQ6IFwiICsgY2hhbm5lbE5hbWUpO1xuICAgIH1cbiAgICB0aGlzLnJlcXVlc3RMaXN0ZW5lcnMuc2V0KGNoYW5uZWxOYW1lLCBzdWJzKTtcbiAgICByZXR1cm4gc3VicztcbiAgfVxuXG4gIHJlcXVlc3RMaXN0ZW5lcnMgPSBuZXcgTWFwPHN0cmluZywgUmVxU3Vic2NyaXB0aW9uPigpO1xuXG4gIHByaXZhdGUgYXN5bmMgX19ub3RpZnlTdWJzY3JpYmVycyhcbiAgICBjaGFubmVsTmFtZTogc3RyaW5nLFxuICAgIG1zZzogdW5rbm93bixcbiAgICBzSWQ6IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCBoYW5kbGVycyA9IHRoaXMuc3Vic2NyaWJlcnMuZ2V0KGNoYW5uZWxOYW1lKSB8fCBbXTtcblxuICAgIGNvbnN0IGFsbFN1YnNjcmliZXJzUHJvbWlzZXM6IFByb21pc2U8dm9pZD5bXSA9IFtdO1xuICAgIGZvciAoY29uc3QgaCBvZiBoYW5kbGVycykge1xuICAgICAgaWYgKCFoKSBjb250aW51ZTtcbiAgICAgIGFsbFN1YnNjcmliZXJzUHJvbWlzZXMucHVzaChQcm9taXNlLnJlc29sdmUoaChtc2csIHNJZCkpKTtcbiAgICAgIHRoaXMubG9nKFwiSGFuZGxlciBjYWxsZWRcIiwgY2hhbm5lbE5hbWUsIHsgaGFuZGxlcjogaCwgbWVzc2FnZTogbXNnIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IFByb21pc2UuYWxsKGFsbFN1YnNjcmliZXJzUHJvbWlzZXMpO1xuXG4gICAgaWYgKGNoYW5uZWxTZXR0aW5ncy5nZXQoY2hhbm5lbE5hbWUpPy5jYWNoZSlcbiAgICAgIHRoaXMuc3RhdGUuc2V0KGNoYW5uZWxOYW1lLCBtc2cpO1xuXG4gICAgdGhpcy5fX2hhbmRsZUF3YWl0ZXIoY2hhbm5lbE5hbWUsIG1zZyk7XG5cbiAgICB0aGlzLmxvZyhcIk1lc3NhZ2UgaGFuZGxlZFwiLCBjaGFubmVsTmFtZSwge1xuICAgICAgbWVzc2FnZTogbXNnLFxuICAgICAgaGFuZGxlcnMsXG4gICAgICBicm9rZXI6IHRoaXMsXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9faGFuZGxlQXdhaXRlcihzdWJzS2V5OiBzdHJpbmcsIG1zZzogdW5rbm93bikge1xuICAgIGNvbnN0IGF3YWl0ZXIgPSB0aGlzLl9fbmV4dE1lc3NhZ2VBd2FpdGVycy5nZXQoc3Vic0tleSk7XG4gICAgaWYgKCFhd2FpdGVyKSByZXR1cm47XG5cbiAgICBhd2FpdGVyLnJlc29sdmUobXNnKTtcblxuICAgIHRoaXMuX19uZXh0TWVzc2FnZUF3YWl0ZXJzLmRlbGV0ZShzdWJzS2V5KTtcbiAgfVxufVxuXG5nbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyID8/PSBuZXcgQnJva2VyKCk7XG5cbmV4cG9ydCBjb25zdCBCTUIgPSBnbG9iYWxUaGlzLkJyb3dzZXJNZXNzYWdlQnJva2VyO1xuZXhwb3J0ICogZnJvbSBcIi4vUHViU3ViQ2hhbm5lbFwiO1xuZXhwb3J0ICogZnJvbSBcIi4vUmVxUmVwQ2hhbm5lbFwiO1xuIiwgImltcG9ydCB7IEJNQiB9IGZyb20gXCIuL0Jyb2tlclwiO1xuaW1wb3J0IHtcbiAgRGlzcG9zZXIsXG4gIENoYW5uZWxTZXR0aW5ncyxcbiAgSVB1YlN1YkNoYW5uZWwsXG4gIFRIYW5kbGVyLFxufSBmcm9tIFwiLi9UeXBlc1wiO1xuXG5jb25zdCBwdWJTdWJDaGFubmVscyA9IG5ldyBNYXA8c3RyaW5nLCBQdWJTdWJDaGFubmVsPigpO1xuXG5leHBvcnQgY2xhc3MgUHViU3ViQ2hhbm5lbDxUTXNnID0gYW55PlxuICBpbXBsZW1lbnRzIElQdWJTdWJDaGFubmVsPFRNc2c+XG57XG4gIHN0YXRpYyBmb3I8VE1zZz4oXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHNldHRpbmdzPzogQ2hhbm5lbFNldHRpbmdzXG4gICk6IFB1YlN1YkNoYW5uZWw8VE1zZz4ge1xuICAgIGlmICghc2V0dGluZ3MpIHtcbiAgICAgIGNvbnN0IGMgPSBwdWJTdWJDaGFubmVscy5nZXQobmFtZSk7XG4gICAgICBpZiAoIWMpIHRocm93IEVycm9yKFwiQ2FuJ3QgZmluZCBjaGFubmVsIHNldHRpbmdzXCIpO1xuICAgICAgcmV0dXJuIGMgYXMgUHViU3ViQ2hhbm5lbDxUTXNnPjtcbiAgICB9XG5cbiAgICBCTUIuQ29uZmlndXJlQ2hhbm5lbChcbiAgICAgIG5hbWUsXG4gICAgICBzZXR0aW5ncy5icm9hZGNhc3QgfHwgZmFsc2UsXG4gICAgICBzZXR0aW5ncy5jYWNoZSB8fCBmYWxzZSxcbiAgICAgIHNldHRpbmdzLnRyYWNlIHx8IGZhbHNlXG4gICAgKTtcbiAgICBjb25zdCBjaGFubmVsID0gbmV3IFB1YlN1YkNoYW5uZWw8VE1zZz4obmFtZSwgc2V0dGluZ3MpO1xuICAgIHB1YlN1YkNoYW5uZWxzLnNldChuYW1lLCBjaGFubmVsKTtcbiAgICByZXR1cm4gY2hhbm5lbDtcbiAgfVxuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHNldHRpbmdzOiBDaGFubmVsU2V0dGluZ3NcbiAgKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnNldHRpbmdzID0gc2V0dGluZ3M7XG4gIH1cblxuICBhc3luYyBzZW5kKG1zZzogVE1zZywgdGFyZ2V0SWQ/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBCTUIuUHVibGlzaCh0aGlzLm5hbWUsIG1zZywgdGFyZ2V0SWQpO1xuICB9XG4gIHN0YXRpYyBhc3luYyBwdWJsaXNoPFRNc2cgPSBhbnk+KFxuICAgIG5hbWU6IHN0cmluZyxcbiAgICBtc2c6IFRNc2csXG4gICAgdGFyZ2V0SWQ/OiBzdHJpbmdcbiAgKSB7XG4gICAgQk1CLlB1Ymxpc2gobmFtZSwgbXNnLCB0YXJnZXRJZCk7XG4gIH1cbiAgc3RhdGljIGFzeW5jIGJyb2FkY2FzdDxUTXNnID0gYW55PihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgbXNnOiBUTXNnLFxuICAgIHRhcmdldElkPzogc3RyaW5nXG4gICkge1xuICAgIEJNQi5Ccm9hZGNhc3Q8VE1zZz4obmFtZSwgbXNnLCB0YXJnZXRJZCk7XG4gIH1cblxuICBzdWJzY3JpYmUoaGFuZGxlcjogVEhhbmRsZXI8VE1zZz4pOiBEaXNwb3NlciB7XG4gICAgY29uc3QgcyA9IEJNQi5TdWJzY3JpYmUoXG4gICAgICB0aGlzLm5hbWUsXG4gICAgICBoYW5kbGVyLFxuICAgICAgdGhpcy5zZXR0aW5ncy5icm9hZGNhc3QsXG4gICAgICB0aGlzLnNldHRpbmdzLmNhY2hlXG4gICAgKTtcbiAgICByZXR1cm4gcy5kaXNwb3NlO1xuICB9XG5cbiAgZ2V0U3RhdGUoKTogVE1zZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIEJNQi5HZXRTdGF0ZSh0aGlzLm5hbWUpO1xuICB9XG4gIHN0YXRpYyBHZXRTdGF0ZTxUTXNnPihuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gQk1CLkdldFN0YXRlPFRNc2c+KG5hbWUpO1xuICB9XG5cbiAgbmV4dE1lc3NhZ2UoKTogUHJvbWlzZTxUTXNnPiB7XG4gICAgcmV0dXJuIEJNQi5uZXh0TWVzc2FnZSh0aGlzLm5hbWUpO1xuICB9XG5cbiAgc3RhdGljIG5leHRNZXNzYWdlPFRNc2c+KG5hbWU6IHN0cmluZyk6IFByb21pc2U8VE1zZz4ge1xuICAgIHJldHVybiBCTUIubmV4dE1lc3NhZ2UobmFtZSk7XG4gIH1cblxuICByZWFkb25seSB0eXBlID0gXCJwdWJTdWJcIjtcbiAgcmVhZG9ubHkgZGlzcG9zZSA9ICgpID0+IHtcbiAgICBCTUIuc3Vic2NyaWJlcnMuZGVsZXRlKHRoaXMubmFtZSk7XG4gICAgcHViU3ViQ2hhbm5lbHMuZGVsZXRlKHRoaXMubmFtZSk7XG4gIH07XG5cbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nID0gXCJcIjtcbiAgcmVhZG9ubHkgc2V0dGluZ3M6IENoYW5uZWxTZXR0aW5ncyA9IHt9O1xufVxuIiwgImV4cG9ydCBjb25zdCBQVUJfU1VCX1JFUVVFU1RfU1VCU0NSSVBUSU9OX0tFWSA9IFwidGVzdFJlcVwiO1xuZXhwb3J0IGNvbnN0IFBVQl9TVUJfUkVTUE9OU0VfU1VCU0NSSVBUSU9OX0tFWSA9IFwidGVzdFJlc3BcIjtcbmV4cG9ydCBjb25zdCBSRVFfUkVQX0NIQU5ORUxfTkFNRSA9IFwicmVxUmVwQ2hhbm5lbFwiO1xuIiwgImltcG9ydCB7XG4gIFB1YlN1YkNoYW5uZWwsXG4gIFJlcVJlcENoYW5uZWwsXG59IGZyb20gXCJicm93c2VyLW1lc3NhZ2UtYnJva2VyXCI7XG5pbXBvcnQge1xuICBQVUJfU1VCX1JFUVVFU1RfU1VCU0NSSVBUSU9OX0tFWSxcbiAgUFVCX1NVQl9SRVNQT05TRV9TVUJTQ1JJUFRJT05fS0VZLFxuICBSRVFfUkVQX0NIQU5ORUxfTkFNRSxcbn0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5cblB1YlN1YkNoYW5uZWwuZm9yKFBVQl9TVUJfUkVRVUVTVF9TVUJTQ1JJUFRJT05fS0VZLCB7XG4gIGJyb2FkY2FzdDogdHJ1ZSxcbn0pLnN1YnNjcmliZSgoXykgPT4ge1xuICBQdWJTdWJDaGFubmVsLmJyb2FkY2FzdChcbiAgICBQVUJfU1VCX1JFU1BPTlNFX1NVQlNDUklQVElPTl9LRVksXG4gICAgeyBwYXlsb2FkOiBcInJlc3BvbnNlXCIgfVxuICApO1xufSk7XG5cblJlcVJlcENoYW5uZWwuZm9yPHsgcGF5bG9hZDogc3RyaW5nIH0sIHsgcGF5bG9hZDogc3RyaW5nIH0+KFxuICBSRVFfUkVQX0NIQU5ORUxfTkFNRSxcbiAge1xuICAgIGJyb2FkY2FzdDogdHJ1ZSxcbiAgfVxuKS5yZXBseSgocmVxKSA9PiB7XG4gIHJldHVybiB7IHBheWxvYWQ6IHJlcS5wYXlsb2FkICsgXCJyZXNwb25zZVwiIH07XG59KTtcblxuLy9sZXQgd2luZG93IGtub3cgdGhhdCB3b3JrZXIgaXMgcmVhZHkgYW5kIGV4ZWN1dGUgdGVzdFxucG9zdE1lc3NhZ2UoXCJyZWFkeVwiKTtcbiJdLAogICJtYXBwaW5ncyI6ICI7QUFHQSxJQUFNQSxJQUFpQixvQkFBSTtBQUEzQixJQUVhQyxJQUFOLE1BQU1DLEVBRWI7RUFtRFUsWUFDTkMsR0FDQUMsR0FDQTtBQXJDRixTQUFTLE9BQWlCO0FBRTFCLFNBQUEsV0FBNEIsQ0FBQztBQU83QixTQUFTLE9BQWU7QUE2QnRCLFNBQUssT0FBT0QsR0FDWixLQUFLLFdBQVdDO0VBQ2xCO0VBeERBLE1BQU0sUUFBUUMsR0FBdUM7QUFDbkQsV0FBT0MsRUFBSSxRQUNULEtBQUssTUFDTEQsR0FDQSxLQUFLLFNBQVMsU0FDaEI7RUFDRjtFQUVBLE1BQU1FLEdBQThDO0FBQ2xELFdBQU9ELEVBQUksTUFDVCxLQUFLLE1BQ0xDLEdBQ0EsS0FBSyxTQUFTLFNBQ2hCLEVBQUU7RUFDSjtFQU1BLFVBQVU7QUFDUkQsTUFBSSxpQkFBaUIsT0FBTyxLQUFLLElBQUksR0FDckNOLEVBQWUsT0FBTyxLQUFLLElBQUk7RUFDakM7RUFJQSxP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R0FBYztBQUNsQyxXQUFPRyxFQUFJLFNBQWVILENBQUk7RUFDaEM7RUFFQSxjQUE2QjtBQUMzQixXQUFPRyxFQUFJLFlBQVksS0FBSyxJQUFJO0VBQ2xDO0VBRUEsT0FBTyxZQUFrQkgsR0FBNkI7QUFDcEQsV0FBT0csRUFBSSxZQUFZSCxDQUFJO0VBQzdCO0FBVUY7OztBQzdGTyxJQUFNLG1DQUFtQztBQUN6QyxJQUFNLG9DQUFvQztBQUMxQyxJQUFNLHVCQUF1Qjs7O0FDUXBDLEVBQWMsSUFBSSxrQ0FBa0M7QUFBQSxFQUNsRCxXQUFXO0FBQ2IsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxNQUFNO0FBQ2xCLElBQWM7QUFBQSxJQUNaO0FBQUEsSUFDQSxFQUFFLFNBQVMsV0FBVztBQUFBLEVBQ3hCO0FBQ0YsQ0FBQztBQUVELEVBQWM7QUFBQSxFQUNaO0FBQUEsRUFDQTtBQUFBLElBQ0UsV0FBVztBQUFBLEVBQ2I7QUFDRixFQUFFLE1BQU0sQ0FBQyxRQUFRO0FBQ2YsU0FBTyxFQUFFLFNBQVMsSUFBSSxVQUFVLFdBQVc7QUFDN0MsQ0FBQztBQUdELFlBQVksT0FBTzsiLAogICJuYW1lcyI6IFsicmVxUmVwQ2hhbm5lbHMiLCAiUmVxUmVwQ2hhbm5lbCIsICJfUmVxUmVwQ2hhbm5lbCIsICJuYW1lIiwgInNldHRpbmdzIiwgIm1zZyIsICJCTUIiLCAiaGFuZGxlciIsICJjIiwgImNoYW5uZWwiLCAiQlJPQURDQVNUX1NZTkMiLCAiQlJPV1NFUl9NRVNTQUdFX0JST0tFUiIsICJpc0Jyb2FkY2FzdFN5bmMiLCAiZSIsICJpc1N5bmNSZXEiLCAiaXNTeW5jUmVzcCIsICJzZW5kZXJJZCIsICJkZWJvdW5jZSIsICJmdW5jIiwgInRpbWVvdXQiLCAidGltZXIiLCAiYXJncyIsICJjaGFubmVsU2V0dGluZ3MiLCAiQnJva2VyIiwgIm1lc3NhZ2UiLCAiZGF0YSIsICJjaGFubmVsTmFtZSIsICJicm9hZGNhc3QiLCAiY2FjaGUiLCAidHJhY2UiLCAiZXYiLCAidGFyZ2V0SWQiLCAiZmlsdGVyQnJvYWRjYXN0cyIsICJjdXJyZW50QnJvYWRjYXN0cyIsICJrIiwgImF2YWlsYWJsZVN0YXRlIiwgIngiLCAic3RhdGUiLCAicmVxIiwgInN1YnNjcmlwdGlvbiIsICJvcmlnaW5hbERpc3Bvc2UiLCAic3Vic0tleSIsICJjaGFubmVsVHlwZSIsICJfbXNnIiwgImVudmVsb3BlIiwgImEiLCAibmV3QXdhaXRlciIsICJyZXMiLCAic2V0dGluZ3NPdmVycmlkZGVuIiwgInN1YnMiLCAiaGRsIiwgIl9zdWJzIiwgImkiLCAicmVxdWVzdERhdGEiLCAibGlzdGVuZXIiLCAicmVzb2x2ZSIsICJicmVxIiwgIm9yaWdIYW5kbGVyIiwgInJlcUxpc3RlbmVycyIsICJjdXJyZW50TGlzdGVuZXIiLCAic0lkIiwgImhhbmRsZXJzIiwgImFsbFN1YnNjcmliZXJzUHJvbWlzZXMiLCAiaCIsICJhd2FpdGVyIiwgInB1YlN1YkNoYW5uZWxzIiwgIlB1YlN1YkNoYW5uZWwiLCAiX1B1YlN1YkNoYW5uZWwiXQp9Cg==
